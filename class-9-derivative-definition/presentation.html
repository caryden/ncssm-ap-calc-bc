<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 9: Definition of the Derivative | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --theme-color: #7c3aed;
            --theme-color-light: #8b5cf6;
        }

        /* Difference quotient diagram */
        .dq-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            margin: 2rem 0;
        }

        .dq-visual {
            width: 450px;
            height: 350px;
        }

        .dq-formula {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            border-left: 4px solid var(--theme-color);
        }

        /* Definition box styling */
        .definition-box {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-secondary);
            padding: 2rem 2.5rem;
            border-radius: 12px;
            margin: 1.5rem auto;
            max-width: 800px;
            text-align: center;
        }

        .definition-box .label {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--accent-secondary);
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .definition-box .math-content {
            font-size: 2rem;
        }

        /* Annotated formula */
        .annotated-formula {
            position: relative;
            padding: 3rem 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .formula-main {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
        }

        .annotations {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .annotation {
            text-align: center;
            max-width: 200px;
        }

        .annotation .symbol {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--theme-color);
            margin-bottom: 0.5rem;
        }

        .annotation .meaning {
            font-size: 1.25rem;
            color: var(--text-secondary);
        }

        /* Slider controls */
        .slider-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1.5rem;
            padding: 1rem 2rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .slider-control label {
            font-size: 1.25rem;
            font-family: var(--font-display);
            color: var(--text-primary);
        }

        .slider-control input[type="range"] {
            width: 300px;
            height: 8px;
            -webkit-appearance: none;
            background: var(--bg-tertiary);
            border-radius: 4px;
            cursor: pointer;
        }

        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--theme-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .slope-display {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--accent-secondary);
            min-width: 200px;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }

        /* Step display for worked examples */
        .example-steps {
            text-align: left;
            max-width: 800px;
            margin: 0 auto;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .step-number {
            background: var(--theme-color);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-family: var(--font-display);
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content .description {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .step-content .math {
            font-size: 1.5rem;
        }

        /* Result highlight */
        .result-box {
            background: linear-gradient(135deg, var(--theme-color), var(--accent-secondary));
            padding: 1.5rem 2rem;
            border-radius: 12px;
            margin: 2rem auto;
            max-width: 400px;
            text-align: center;
        }

        .result-box .math {
            font-size: 2rem;
            color: white;
        }

        /* Notation list */
        .notation-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 1rem 2rem;
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
        }

        .notation-symbol {
            font-size: 1.75rem;
            font-family: var(--font-mono);
            color: var(--theme-color);
        }

        .notation-name {
            font-size: 1.25rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="The Derivative">
            <div class="slide-content">
                <div class="unit-badge">Unit 2: Differentiation Fundamentals</div>
                <h1>The Derivative</h1>
                <p class="subtitle">The Mathematics of Instantaneous Change</p>
                <p class="meta">Class 9 | CED 2.1 | NCSSM</p>
            </div>
        </div>

        <!-- Slide 1: The Big Question -->
        <div class="slide slide-statement" data-slide="1" data-section="Opening" data-title="The Big Question">
            <div class="slide-content">
                <p class="statement">How do we find the <em>exact</em> slope of a curve at a single point?</p>
            </div>
        </div>

        <!-- Slide 2: Recall Secant Lines -->
        <div class="slide slide-visual" data-slide="2" data-section="From Secant to Tangent" data-title="The Secant Line">
            <div class="slide-content">
                <h2>The Secant Line</h2>
                <div id="secant-viz" class="visualization"></div>
                <p class="caption">The secant line connects two points on a curve. Its slope is the average rate of change.</p>
            </div>
        </div>

        <!-- Slide 3: Difference Quotient -->
        <div class="slide slide-visual" data-slide="3" data-section="From Secant to Tangent" data-title="The Difference Quotient">
            <div class="slide-content">
                <h2>The Difference Quotient</h2>
                <div class="dq-diagram">
                    <div id="dq-visual" class="dq-visual"></div>
                    <div class="dq-formula">
                        <p style="font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 1rem;">Slope of the secant line:</p>
                        <p style="font-size: 2rem;">\[\frac{f(x+h) - f(x)}{h}\]</p>
                        <p style="font-size: 1.25rem; color: var(--text-tertiary); margin-top: 1rem;">This is called the <strong>difference quotient</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Interactive h Slider -->
        <div class="slide slide-visual" data-slide="4" data-section="From Secant to Tangent" data-title="As h Approaches Zero">
            <div class="slide-content">
                <h2>As \(h\) Approaches Zero...</h2>
                <div id="h-slider-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>\(h =\)</label>
                    <input type="range" id="h-slider" min="-2" max="2" step="0.01" value="1.5">
                    <div class="slope-display">
                        <span id="h-value">h = 1.50</span> | <span id="slope-value">Slope = 4.50</span>
                    </div>
                </div>
                <p class="caption">Watch the secant line approach the tangent line as h approaches 0</p>
            </div>
        </div>

        <!-- Slide 5: Tangent Emerges -->
        <div class="slide slide-statement" data-slide="5" data-section="From Secant to Tangent" data-title="The Tangent Line Emerges">
            <div class="slide-content">
                <p class="statement">As the second point approaches the first, the secant line becomes the <em>tangent</em> line.</p>
            </div>
        </div>

        <!-- Slide 6: The Definition -->
        <div class="slide slide-visual" data-slide="6" data-section="The Definition" data-title="Definition of the Derivative">
            <div class="slide-content">
                <h2>The Derivative at a Point</h2>
                <div class="definition-box">
                    <div class="label">Definition</div>
                    <div class="math-content">
                        \[f'(a) = \lim_{h \to 0} \frac{f(a+h) - f(a)}{h}\]
                    </div>
                </div>
                <p style="font-size: 1.5rem; margin-top: 1.5rem;">Read as: "<em>f prime of a</em>"</p>
                <p class="caption">The derivative is the limit of the difference quotient as h approaches 0</p>
            </div>
        </div>

        <!-- Slide 7: Breaking Down the Definition -->
        <div class="slide slide-visual" data-slide="7" data-section="The Definition" data-title="Understanding the Parts">
            <div class="slide-content">
                <h2>Understanding Each Part</h2>
                <div class="annotated-formula">
                    <div class="formula-main">\[f'(a) = \lim_{h \to 0} \frac{f(a+h) - f(a)}{h}\]</div>
                    <div class="annotations">
                        <div class="annotation">
                            <div class="symbol">\(f'(a)\)</div>
                            <div class="meaning">The derivative of f at a</div>
                        </div>
                        <div class="annotation">
                            <div class="symbol">\(\lim_{h \to 0}\)</div>
                            <div class="meaning">As h approaches 0</div>
                        </div>
                        <div class="annotation">
                            <div class="symbol">\(f(a+h) - f(a)\)</div>
                            <div class="meaning">Change in output (rise)</div>
                        </div>
                        <div class="annotation">
                            <div class="symbol">\(h\)</div>
                            <div class="meaning">Change in input (run)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 8: The Derivative Function -->
        <div class="slide slide-visual" data-slide="8" data-section="The Definition" data-title="The Derivative Function">
            <div class="slide-content">
                <h2>The Derivative Function</h2>
                <div class="definition-box">
                    <div class="label">General Definition</div>
                    <div class="math-content">
                        \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
                </div>
                <p style="font-size: 1.5rem; margin-top: 1.5rem;">Using \(x\) instead of \(a\) gives us a formula that works for <em>any</em> input.</p>
                <p class="caption">This defines \(f'(x)\) as a new function - the derivative of \(f\)</p>
            </div>
        </div>

        <!-- Slide 9: Alternative Form -->
        <div class="slide slide-visual" data-slide="9" data-section="The Definition" data-title="Alternative Form">
            <div class="slide-content">
                <h2>Alternative Form</h2>
                <div class="definition-box" style="border-color: var(--theme-color);">
                    <div class="label" style="color: var(--theme-color);">Equivalent Definition</div>
                    <div class="math-content">
                        \[f'(a) = \lim_{x \to a} \frac{f(x) - f(a)}{x - a}\]
                    </div>
                </div>
                <p style="font-size: 1.5rem; margin-top: 1.5rem;">Instead of \(x\) and \(x+h\), we use \(a\) and \(x\) (where \(x\) approaches \(a\))</p>
                <p class="caption">Both forms are equivalent - use whichever is more convenient</p>
            </div>
        </div>

        <!-- Slide 10: Two Interpretations -->
        <div class="slide slide-comparison" data-slide="10" data-section="The Definition" data-title="Two Interpretations">
            <div class="slide-content">
                <h2>What the Derivative Means</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--color-tangent);">Geometric</h3>
                        <p style="font-size: 2rem; margin: 1.5rem 0;">Slope of Tangent Line</p>
                        <p>\(f'(a)\) is the slope of the line tangent to the graph at \(x = a\)</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--color-derivative);">Physical</h3>
                        <p style="font-size: 2rem; margin: 1.5rem 0;">Instantaneous Rate</p>
                        <p>\(f'(a)\) is the instantaneous rate of change of \(f\) at \(x = a\)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 11: Notation -->
        <div class="slide slide-visual" data-slide="11" data-section="The Definition" data-title="Derivative Notations">
            <div class="slide-content">
                <h2>Derivative Notations</h2>
                <div class="notation-grid" style="margin-top: 2rem;">
                    <div class="notation-symbol">\(f'(x)\)</div>
                    <div class="notation-name">"f prime of x" (Lagrange)</div>

                    <div class="notation-symbol">\(\frac{dy}{dx}\)</div>
                    <div class="notation-name">"dy dx" (Leibniz)</div>

                    <div class="notation-symbol">\(\frac{d}{dx}[f(x)]\)</div>
                    <div class="notation-name">"d dx of f(x)" (Operator)</div>

                    <div class="notation-symbol">\(y'\)</div>
                    <div class="notation-name">"y prime"</div>
                </div>
                <p class="caption" style="margin-top: 2rem;">All mean the same thing - know them all for the AP exam!</p>
            </div>
        </div>

        <!-- Slide 12: Example Setup -->
        <div class="slide slide-visual" data-slide="12" data-section="Worked Example" data-title="Example: x squared">
            <div class="slide-content">
                <h2>Example: \(f(x) = x^2\)</h2>
                <div style="background: var(--bg-secondary); padding: 1.5rem 2rem; border-radius: 8px; border-left: 4px solid var(--theme-color); max-width: 700px; margin: 0 auto;">
                    <p style="font-size: 1.5rem;">Find \(f'(x)\) using the limit definition.</p>
                </div>
                <div class="example-steps" style="margin-top: 2rem;">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="description">Write the difference quotient:</div>
                            <div class="math">\[\frac{f(x+h) - f(x)}{h} = \frac{(x+h)^2 - x^2}{h}\]</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Example Expanding -->
        <div class="slide slide-visual" data-slide="13" data-section="Worked Example" data-title="Expanding">
            <div class="slide-content">
                <h2>Example: \(f(x) = x^2\) (continued)</h2>
                <div class="example-steps">
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="description">Expand \((x+h)^2\):</div>
                            <div class="math">\[= \frac{x^2 + 2xh + h^2 - x^2}{h}\]</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="description">Simplify the numerator:</div>
                            <div class="math">\[= \frac{2xh + h^2}{h}\]</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 14: Example Simplifying -->
        <div class="slide slide-visual" data-slide="14" data-section="Worked Example" data-title="Simplifying">
            <div class="slide-content">
                <h2>Example: \(f(x) = x^2\) (continued)</h2>
                <div class="example-steps">
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="description">Factor out \(h\):</div>
                            <div class="math">\[= \frac{h(2x + h)}{h}\]</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <div class="description">Cancel \(h\) (valid since \(h \neq 0\) in the limit process):</div>
                            <div class="math">\[= 2x + h\]</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 15: Example Taking Limit -->
        <div class="slide slide-visual" data-slide="15" data-section="Worked Example" data-title="Taking the Limit">
            <div class="slide-content">
                <h2>Example: \(f(x) = x^2\) (completed)</h2>
                <div class="example-steps">
                    <div class="step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <div class="description">Take the limit as \(h \to 0\):</div>
                            <div class="math">\[f'(x) = \lim_{h \to 0}(2x + h) = 2x\]</div>
                        </div>
                    </div>
                </div>
                <div class="result-box">
                    <div class="math">\[f'(x) = 2x\]</div>
                </div>
                <p class="caption">The derivative of \(x^2\) is \(2x\)</p>
            </div>
        </div>

        <!-- Slide 16: Visual Verification -->
        <div class="slide slide-visual" data-slide="16" data-section="Worked Example" data-title="Visual Verification">
            <div class="slide-content">
                <h2>Visual Verification</h2>
                <div id="verification-viz" class="visualization"></div>
                <p class="caption">At \(x = 1\), slope = 2. At \(x = 2\), slope = 4. At \(x = 3\), slope = 6. The formula \(f'(x) = 2x\) works!</p>
            </div>
        </div>

        <!-- Slide 17: Practice 1 -->
        <div class="slide slide-exercise" data-slide="17" data-section="Practice" data-title="Practice: Linear Function">
            <div class="slide-content">
                <h2>Your Turn: Linear Function</h2>
                <div class="prompt">
                    <p>Find \(f'(x)\) for \(f(x) = 3x + 1\) using the limit definition.</p>
                    <p style="margin-top: 1rem; color: var(--text-tertiary); font-size: 1.25rem;">Hint: What should the derivative of a linear function be?</p>
                </div>
                <p style="margin-top: 2rem; color: var(--accent-secondary);">2 minutes</p>
            </div>
        </div>

        <!-- Slide 18: Practice 1 Solution -->
        <div class="slide slide-visual" data-slide="18" data-section="Practice" data-title="Solution: Linear">
            <div class="slide-content">
                <h2>Solution: \(f(x) = 3x + 1\)</h2>
                <div style="text-align: left; max-width: 700px; margin: 0 auto; font-size: 1.5rem;">
                    <p>\[\frac{(3(x+h) + 1) - (3x + 1)}{h}\]</p>
                    <p style="margin-top: 1rem;">\[= \frac{3x + 3h + 1 - 3x - 1}{h}\]</p>
                    <p style="margin-top: 1rem;">\[= \frac{3h}{h} = 3\]</p>
                </div>
                <div class="result-box">
                    <div class="math">\[f'(x) = 3\]</div>
                </div>
                <p class="caption">The derivative of a linear function is its slope!</p>
            </div>
        </div>

        <!-- Slide 19: Practice 2 -->
        <div class="slide slide-exercise" data-slide="19" data-section="Practice" data-title="Challenge: Cubic">
            <div class="slide-content">
                <h2>Challenge: Cubic Function</h2>
                <div class="prompt">
                    <p>Find \(f'(x)\) for \(f(x) = x^3\) using the limit definition.</p>
                    <p style="margin-top: 1rem; color: var(--text-tertiary); font-size: 1.25rem;">Hint: \((a+b)^3 = a^3 + 3a^2b + 3ab^2 + b^3\)</p>
                </div>
                <p style="margin-top: 2rem; color: var(--accent-secondary);">4 minutes</p>
            </div>
        </div>

        <!-- Slide 20: Practice 2 Solution -->
        <div class="slide slide-visual" data-slide="20" data-section="Practice" data-title="Solution: Cubic">
            <div class="slide-content">
                <h2>Solution: \(f(x) = x^3\)</h2>
                <div style="text-align: left; max-width: 800px; margin: 0 auto; font-size: 1.25rem;">
                    <p>\[\frac{(x+h)^3 - x^3}{h} = \frac{x^3 + 3x^2h + 3xh^2 + h^3 - x^3}{h}\]</p>
                    <p style="margin-top: 1rem;">\[= \frac{3x^2h + 3xh^2 + h^3}{h} = \frac{h(3x^2 + 3xh + h^2)}{h}\]</p>
                    <p style="margin-top: 1rem;">\[= 3x^2 + 3xh + h^2\]</p>
                    <p style="margin-top: 1rem;">\[\lim_{h \to 0}(3x^2 + 3xh + h^2) = 3x^2\]</p>
                </div>
                <div class="result-box">
                    <div class="math">\[f'(x) = 3x^2\]</div>
                </div>
            </div>
        </div>

        <!-- Slide 21: Key Takeaways -->
        <div class="slide slide-list" data-slide="21" data-section="Summary" data-title="Key Takeaways">
            <div class="slide-content">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>The derivative is the <strong>limit of the difference quotient</strong></li>
                    <li><strong>Geometrically:</strong> slope of the tangent line</li>
                    <li><strong>Physically:</strong> instantaneous rate of change</li>
                    <li>The limit process gives us <em>exact</em> values, not approximations</li>
                    <li>Strategy: simplify, cancel \(h\), then take the limit</li>
                </ul>
            </div>
        </div>

        <!-- Slide 22: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="22" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p>In your own words, explain what \(f'(3) = 7\) means:</p>
                    <p style="margin-top: 1.5rem; color: var(--theme-color);">1. Geometrically</p>
                    <p style="margin-top: 0.5rem; color: var(--color-derivative);">2. In terms of rates of change</p>
                </div>
            </div>
        </div>

        <!-- Slide 23: Coming Up -->
        <div class="slide slide-statement" data-slide="23" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement" style="font-size: 2.5rem;">Next: The derivative as a <em>function</em></p>
                <p style="font-size: 1.5rem; color: var(--text-secondary); margin-top: 1.5rem;">What does \(f'(x)\) tell us about \(f(x)\)?</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 24</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>←</kbd> <kbd>→</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 9: Definition of the Derivative</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">← Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">← Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next →</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // ===== Secant Line Visualization (Slide 2) =====
        function drawSecantViz() {
            const container = document.getElementById('secant-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 400;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const f = x => x * x;
            const xScale = d3.scaleLinear().domain([-1, 4]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-1, 10]).range([plotHeight, 0]);

            // Grid
            for (let i = -1; i <= 10; i++) {
                g.append('line')
                    .attr('x1', 0).attr('x2', plotWidth)
                    .attr('y1', yScale(i)).attr('y2', yScale(i))
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }
            for (let i = -1; i <= 4; i++) {
                g.append('line')
                    .attr('x1', xScale(i)).attr('x2', xScale(i))
                    .attr('y1', 0).attr('y2', plotHeight)
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotHeight})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(5))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');

            // Curve
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)))
                .curve(d3.curveCatmullRom);

            g.append('path')
                .datum(d3.range(-0.5, 3.5, 0.1))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Two points
            const x1 = 1, x2 = 2.5;
            const y1 = f(x1), y2 = f(x2);

            // Secant line
            const slope = (y2 - y1) / (x2 - x1);
            const lineX1 = -0.5, lineX2 = 3.5;
            const lineY1 = y1 + slope * (lineX1 - x1);
            const lineY2 = y1 + slope * (lineX2 - x1);

            g.append('line')
                .attr('x1', xScale(lineX1)).attr('y1', yScale(lineY1))
                .attr('x2', xScale(lineX2)).attr('y2', yScale(lineY2))
                .attr('stroke', '#a78bfa')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4');

            // Points
            g.append('circle')
                .attr('cx', xScale(x1)).attr('cy', yScale(y1))
                .attr('r', 8).attr('fill', '#f97316');
            g.append('circle')
                .attr('cx', xScale(x2)).attr('cy', yScale(y2))
                .attr('r', 8).attr('fill', '#f97316');

            // Labels
            g.append('text')
                .attr('x', xScale(x1) - 10).attr('y', yScale(y1) - 15)
                .attr('font-size', '1.25rem').attr('fill', '#f97316')
                .text('A');
            g.append('text')
                .attr('x', xScale(x2) + 10).attr('y', yScale(y2) - 15)
                .attr('font-size', '1.25rem').attr('fill', '#f97316')
                .text('B');

            // Slope label
            g.append('text')
                .attr('x', xScale(2.8)).attr('y', yScale(7))
                .attr('font-size', '1.25rem').attr('fill', '#a78bfa')
                .text(`Slope = ${slope.toFixed(2)}`);
        }

        // ===== Difference Quotient Diagram (Slide 3) =====
        function drawDQVisual() {
            const container = document.getElementById('dq-visual');
            if (!container || container.querySelector('svg')) return;

            const width = 400;
            const height = 320;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const f = x => 0.4 * x * x + 0.5;
            const xScale = d3.scaleLinear().domain([0, 5]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([0, 8]).range([plotHeight, 0]);

            // Curve
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)))
                .curve(d3.curveCatmullRom);

            g.append('path')
                .datum(d3.range(0.5, 4.5, 0.1))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            const x = 1.5, h = 1.5;
            const y1 = f(x), y2 = f(x + h);

            // Vertical dashed line for h
            g.append('line')
                .attr('x1', xScale(x)).attr('y1', yScale(0))
                .attr('x2', xScale(x)).attr('y2', yScale(y1))
                .attr('stroke', '#6b7a94').attr('stroke-dasharray', '4,2');
            g.append('line')
                .attr('x1', xScale(x + h)).attr('y1', yScale(0))
                .attr('x2', xScale(x + h)).attr('y2', yScale(y2))
                .attr('stroke', '#6b7a94').attr('stroke-dasharray', '4,2');

            // Horizontal arrow for h
            g.append('line')
                .attr('x1', xScale(x)).attr('y1', yScale(-0.3))
                .attr('x2', xScale(x + h)).attr('y2', yScale(-0.3))
                .attr('stroke', '#22c55e').attr('stroke-width', 2)
                .attr('marker-end', 'url(#arrowhead)');

            // Vertical arrow for rise
            g.append('line')
                .attr('x1', xScale(x + h) + 10).attr('y1', yScale(y1))
                .attr('x2', xScale(x + h) + 10).attr('y2', yScale(y2))
                .attr('stroke', '#f97316').attr('stroke-width', 2);

            // Points
            g.append('circle')
                .attr('cx', xScale(x)).attr('cy', yScale(y1))
                .attr('r', 6).attr('fill', '#f97316');
            g.append('circle')
                .attr('cx', xScale(x + h)).attr('cy', yScale(y2))
                .attr('r', 6).attr('fill', '#f97316');

            // Labels
            g.append('text')
                .attr('x', xScale(x + h/2)).attr('y', yScale(-0.8))
                .attr('text-anchor', 'middle')
                .attr('font-size', '1.25rem').attr('fill', '#22c55e')
                .text('h');

            g.append('text')
                .attr('x', xScale(x + h) + 25).attr('y', yScale((y1 + y2)/2))
                .attr('font-size', '1rem').attr('fill', '#f97316')
                .text('f(x+h) - f(x)');

            g.append('text')
                .attr('x', xScale(x) - 5).attr('y', yScale(y1) + 20)
                .attr('text-anchor', 'end')
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('(x, f(x))');

            g.append('text')
                .attr('x', xScale(x + h) + 5).attr('y', yScale(y2) - 10)
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('(x+h, f(x+h))');

            // Secant line
            const slope = (y2 - y1) / h;
            g.append('line')
                .attr('x1', xScale(0.5)).attr('y1', yScale(y1 + slope * (0.5 - x)))
                .attr('x2', xScale(4)).attr('y2', yScale(y1 + slope * (4 - x)))
                .attr('stroke', '#a78bfa')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '6,3');
        }

        // ===== Interactive h Slider Visualization (Slide 4) =====
        function drawHSliderViz() {
            const container = document.getElementById('h-slider-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 380;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const f = x => x * x;
            const a = 1.5; // Fixed point
            const xScale = d3.scaleLinear().domain([-1, 4]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-1, 10]).range([plotHeight, 0]);

            // Grid
            for (let i = -1; i <= 10; i++) {
                g.append('line')
                    .attr('x1', 0).attr('x2', plotWidth)
                    .attr('y1', yScale(i)).attr('y2', yScale(i))
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }
            for (let i = -1; i <= 4; i++) {
                g.append('line')
                    .attr('x1', xScale(i)).attr('x2', xScale(i))
                    .attr('y1', 0).attr('y2', plotHeight)
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotHeight})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(5))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');

            // Curve
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)))
                .curve(d3.curveCatmullRom);

            g.append('path')
                .datum(d3.range(-0.5, 3.8, 0.1))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Function label
            g.append('text')
                .attr('x', xScale(3.5)).attr('y', yScale(f(3.3)))
                .attr('font-size', '1.25rem').attr('fill', '#60a5fa')
                .text('f(x) = x²');

            // Tangent line (shown faintly)
            const tangentSlope = 2 * a;
            const tangentLine = g.append('line')
                .attr('stroke', '#fbbf24')
                .attr('stroke-width', 3)
                .attr('opacity', 0);

            // Secant line
            const secantLine = g.append('line')
                .attr('stroke', '#a78bfa')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4');

            // Fixed point A
            g.append('circle')
                .attr('cx', xScale(a)).attr('cy', yScale(f(a)))
                .attr('r', 8).attr('fill', '#f97316');
            g.append('text')
                .attr('x', xScale(a) - 20).attr('y', yScale(f(a)) - 15)
                .attr('font-size', '1.25rem').attr('fill', '#f97316')
                .text('A');

            // Moving point B
            const pointB = g.append('circle')
                .attr('r', 8).attr('fill', '#a78bfa');
            const labelB = g.append('text')
                .attr('font-size', '1.25rem').attr('fill', '#a78bfa');

            function update(h) {
                if (Math.abs(h) < 0.05) h = h >= 0 ? 0.05 : -0.05;

                const bX = a + h;
                const bY = f(bX);
                const slope = (bY - f(a)) / h;

                // Update point B
                pointB.attr('cx', xScale(bX)).attr('cy', yScale(bY));
                labelB.attr('x', xScale(bX) + 10).attr('y', yScale(bY) - 10).text('B');

                // Update secant line
                const lineX1 = -0.5, lineX2 = 3.8;
                const lineY1 = f(a) + slope * (lineX1 - a);
                const lineY2 = f(a) + slope * (lineX2 - a);
                secantLine
                    .attr('x1', xScale(lineX1)).attr('y1', yScale(lineY1))
                    .attr('x2', xScale(lineX2)).attr('y2', yScale(lineY2));

                // Update tangent line visibility
                const showTangent = Math.abs(h) < 0.3;
                const tY1 = f(a) + tangentSlope * (lineX1 - a);
                const tY2 = f(a) + tangentSlope * (lineX2 - a);
                tangentLine
                    .attr('x1', xScale(lineX1)).attr('y1', yScale(tY1))
                    .attr('x2', xScale(lineX2)).attr('y2', yScale(tY2))
                    .attr('opacity', showTangent ? 0.5 : 0);

                // Update displays
                document.getElementById('h-value').textContent = `h = ${h.toFixed(2)}`;
                document.getElementById('slope-value').textContent = `Slope = ${slope.toFixed(3)}`;
            }

            // Initialize
            update(1.5);

            // Slider event
            document.getElementById('h-slider').addEventListener('input', function(e) {
                update(parseFloat(e.target.value));
            });
        }

        // ===== Verification Visualization (Slide 16) =====
        function drawVerificationViz() {
            const container = document.getElementById('verification-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 400;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const f = x => x * x;
            const fPrime = x => 2 * x;
            const xScale = d3.scaleLinear().domain([-1, 4]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-2, 12]).range([plotHeight, 0]);

            // Grid
            for (let i = -2; i <= 12; i += 2) {
                g.append('line')
                    .attr('x1', 0).attr('x2', plotWidth)
                    .attr('y1', yScale(i)).attr('y2', yScale(i))
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }
            for (let i = -1; i <= 4; i++) {
                g.append('line')
                    .attr('x1', xScale(i)).attr('x2', xScale(i))
                    .attr('y1', 0).attr('y2', plotHeight)
                    .attr('stroke', '#1c2640').attr('stroke-width', 1);
            }

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotHeight})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(6))
                .selectAll('text').attr('font-size', '1.25rem').attr('fill', '#b8c4d6');

            // Curve
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)))
                .curve(d3.curveCatmullRom);

            g.append('path')
                .datum(d3.range(-0.5, 3.6, 0.1))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Draw tangent lines at x = 1, 2, 3
            [1, 2, 3].forEach(x => {
                const y = f(x);
                const slope = fPrime(x);
                const dx = 0.8;

                g.append('line')
                    .attr('x1', xScale(x - dx)).attr('y1', yScale(y - slope * dx))
                    .attr('x2', xScale(x + dx)).attr('y2', yScale(y + slope * dx))
                    .attr('stroke', '#fbbf24')
                    .attr('stroke-width', 2);

                g.append('circle')
                    .attr('cx', xScale(x)).attr('cy', yScale(y))
                    .attr('r', 6).attr('fill', '#f97316');

                g.append('text')
                    .attr('x', xScale(x)).attr('y', yScale(y) - 15)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1rem').attr('fill', '#fbbf24')
                    .text(`slope = ${slope}`);
            });

            // Formula display
            svg.append('text')
                .attr('x', width - 30).attr('y', 40)
                .attr('text-anchor', 'end')
                .attr('font-size', '1.5rem').attr('fill', '#22c55e')
                .text("f'(x) = 2x ✓");
        }

        // ===== Trigger Visualizations on Slide Entry =====
        const visualizationSlides = {
            2: drawSecantViz,
            3: drawDQVisual,
            4: drawHSliderViz,
            16: drawVerificationViz
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;

            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        // Check periodically for slide changes
        setInterval(checkAndDrawVisualization, 200);

        // Also check on hash changes
        window.addEventListener('hashchange', () => {
            setTimeout(checkAndDrawVisualization, 100);
        });

        // Initial check after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkAndDrawVisualization, 200);
            });
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }
    </script>
</body>
</html>
