<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parametric Equations and Derivatives | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <style>
        :root {
            --theme-color: #06b6d4;
            --theme-color-light: #22d3ee;
            --theme-color-dark: #0891b2;
            --param-x: #06b6d4;
            --param-y: #ec4899;
            --param-curve: #8b5cf6;
            --tangent: #f59e0b;
        }

        .unit-badge {
            background: var(--theme-color);
        }

        .bc-badge {
            background: linear-gradient(135deg, var(--theme-color), var(--theme-color-dark));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .slide-title h1 {
            color: var(--theme-color);
        }

        .viz-container {
            width: 100%;
            height: 450px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .viz-container svg {
            max-width: 100%;
            max-height: 100%;
        }

        .definition-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--theme-color);
            padding: 1.5rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .definition-box h3 {
            color: var(--theme-color-dark);
            margin: 0 0 0.5rem 0;
        }

        .formula-box {
            background: var(--bg-secondary);
            border: 2px solid var(--theme-color);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin: 1rem 0;
            box-shadow: 0 4px 6px rgba(6, 182, 212, 0.1);
        }

        .example-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .example-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            border-left: 4px solid var(--theme-color);
        }

        .example-card h4 {
            color: var(--theme-color-dark);
            margin: 0 0 0.5rem 0;
        }

        .step-list {
            counter-reset: step;
            list-style: none;
            padding: 0;
        }

        .step-list li {
            counter-increment: step;
            margin: 0.75rem 0;
            padding-left: 2.5rem;
            position: relative;
        }

        .step-list li::before {
            content: counter(step);
            position: absolute;
            left: 0;
            width: 1.75rem;
            height: 1.75rem;
            background: var(--theme-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .controls-container {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--theme-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }

        .control-btn:hover {
            background: var(--theme-color-dark);
        }

        .control-btn.active {
            background: var(--theme-color-dark);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .slider-container input[type="range"] {
            width: 200px;
            accent-color: var(--theme-color);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 0.5rem;
            font-size: 1.1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 24px;
            height: 4px;
            border-radius: 2px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: start;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid var(--bg-tertiary);
        }

        .comparison-table th {
            background: var(--theme-color);
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background: var(--bg-tertiary);
        }

        .error-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1rem 0;
        }

        .error-box h4 {
            color: #ef4444;
            font-size: 1.25rem;
            margin: 0 0 0.5rem 0;
        }

        .correct-box {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1rem 0;
        }

        .correct-box h4 {
            color: #22c55e;
            font-size: 1.25rem;
            margin: 0 0 0.5rem 0;
        }

        .table-method-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 2rem;
            align-items: start;
        }

        .param-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.25rem;
        }

        .param-table th,
        .param-table td {
            padding: 0.5rem 1rem;
            text-align: center;
            border: 1px solid var(--bg-tertiary);
        }

        .param-table th {
            background: var(--theme-color);
            color: white;
        }

        .param-table tr.highlight td {
            background: rgba(6, 182, 212, 0.2);
            font-weight: bold;
        }

        .velocity-viz-container {
            position: relative;
        }

        .velocity-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            font-size: 1.1rem;
        }

        .velocity-info span {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background: var(--bg-tertiary);
        }

        .key-takeaway-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border-left: 4px solid var(--theme-color);
        }

        .key-takeaway-item .number {
            background: var(--theme-color);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .key-takeaway-item .content {
            font-size: 1.2rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="presentation">

        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Parametric Equations">
            <div class="slide-content">
                <div class="unit-badge">Unit 9: Parametric, Polar, and Vectors</div>
                <span class="bc-badge">BC Only</span>
                <h1>Parametric Equations</h1>
                <p class="subtitle">Describing Motion Through Space</p>
                <p class="meta">Class 49 | CED Topics 9.1, 9.2 | NCSSM</p>
            </div>
        </div>

        <!-- Slide 1: The Big Question -->
        <div class="slide slide-statement" data-slide="1" data-section="Opening" data-title="The Big Question">
            <div class="slide-content">
                <p class="statement">How do we describe the path of a ball thrown in the air?</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">Position depends on time: x(t) = horizontal, y(t) = vertical</p>
            </div>
        </div>

        <!-- Slide 2: What is a Parametric Curve? -->
        <div class="slide slide-two-part" data-slide="2" data-section="Understanding Parametric Equations" data-title="What is a Parametric Curve?">
            <div class="slide-content">
                <p class="primary">A curve described by \(x = f(t)\) and \(y = g(t)\)</p>
                <p class="secondary" style="margin-top: 1.5rem;">As \(t\) varies, the point \((x, y)\) traces a curve</p>
                <div style="margin-top: 2rem; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <ul style="font-size: 1.3rem; line-height: 2;">
                        <li>The curve has <strong>direction</strong> (orientation)</li>
                        <li>\(t\) is called the <strong>parameter</strong> (often represents time)</li>
                        <li>Same curve can have different parametrizations</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 3: Parametric Curve Animation -->
        <div class="slide slide-visual" data-slide="3" data-section="Understanding Parametric Equations" data-title="Parametric Curve Animation">
            <div class="slide-content">
                <h2>Tracing a Parametric Curve</h2>
                <div id="param-intro-viz" class="viz-container"></div>
                <div class="slider-container">
                    <span style="font-size: 1.25rem;">t = </span>
                    <input type="range" id="param-t-slider" min="-2" max="2" step="0.1" value="-2">
                    <span id="param-t-value" style="font-size: 1.25rem; min-width: 3rem;">-2</span>
                </div>
                <p class="caption" style="margin-top: 1rem;">Watch the point move as t increases from -2 to 2</p>
            </div>
        </div>

        <!-- Slide 4: Example Gallery -->
        <div class="slide slide-comparison" data-slide="4" data-section="Understanding Parametric Equations" data-title="Common Parametric Curves">
            <div class="slide-content">
                <h2>Common Parametric Curves</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Simple Examples</h3>
                        <div class="example-card" style="margin: 1rem 0;">
                            <h4>Line</h4>
                            <p>\(x = 1 + 2t, \quad y = 3 - t\)</p>
                        </div>
                        <div class="example-card" style="margin: 1rem 0;">
                            <h4>Parabola</h4>
                            <p>\(x = t, \quad y = t^2\)</p>
                        </div>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Trigonometric Examples</h3>
                        <div class="example-card" style="margin: 1rem 0;">
                            <h4>Circle</h4>
                            <p>\(x = \cos t, \quad y = \sin t\)</p>
                        </div>
                        <div class="example-card" style="margin: 1rem 0;">
                            <h4>Ellipse</h4>
                            <p>\(x = 3\cos t, \quad y = 2\sin t\)</p>
                        </div>
                    </div>
                </div>
                <p class="caption" style="margin-top: 1rem;">Parametric form can represent curves that fail the vertical line test</p>
            </div>
        </div>

        <!-- Slide 5: Plotting Parametric Curves - Table Method -->
        <div class="slide slide-visual" data-slide="5" data-section="Understanding Parametric Equations" data-title="Plotting Parametric Curves">
            <div class="slide-content">
                <h2>The Table Method</h2>
                <div id="table-method-viz" class="viz-container" style="height: 400px;"></div>
                <div class="controls-container">
                    <button class="control-btn" id="table-step-btn">Step Through</button>
                    <button class="control-btn" id="table-reset-btn">Reset</button>
                </div>
                <p class="caption">Plot points in order, then connect with arrows to show direction</p>
            </div>
        </div>

        <!-- Slide 6: Eliminating the Parameter -->
        <div class="slide slide-example" data-slide="6" data-section="Understanding Parametric Equations" data-title="Eliminating the Parameter">
            <div class="slide-content">
                <h2>Converting to Cartesian Form</h2>
                <div class="definition-box">
                    <p><strong>Example:</strong> \(x = t, \quad y = t^2\)</p>
                </div>
                <ul class="step-list" style="margin-top: 1.5rem; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <li style="font-size: 1.3rem;">From \(x = t\), we get \(t = x\)</li>
                    <li style="font-size: 1.3rem;">Substitute into \(y\): \(y = x^2\)</li>
                    <li style="font-size: 1.3rem;">Result: Familiar parabola \(y = x^2\)</li>
                </ul>
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; border-radius: 0 8px 8px 0;">
                    <p style="font-size: 1.2rem; color: #ef4444;"><strong>Warning:</strong> Not always possible! Circles, spirals, etc. cannot be eliminated easily.</p>
                </div>
            </div>
        </div>

        <!-- Slide 7: Why Parametrics Matter -->
        <div class="slide slide-list" data-slide="7" data-section="Understanding Parametric Equations" data-title="Why Parametrics Matter">
            <div class="slide-content">
                <h2>The Power of Parametric Form</h2>
                <ul>
                    <li><strong>Motion description:</strong> Natural for physics (position vs. time)</li>
                    <li><strong>Complex curves:</strong> Represent curves that fail vertical line test</li>
                    <li><strong>Direction information:</strong> Know which way the curve is traced</li>
                    <li><strong>Multiple traversals:</strong> Curve can be traced more than once</li>
                </ul>
            </div>
        </div>

        <!-- Slide 8: The Key Question -->
        <div class="slide slide-statement" data-slide="8" data-section="Derivatives of Parametric Equations" data-title="The Key Question">
            <div class="slide-content">
                <p class="statement">What's the slope of the tangent line at a point on a parametric curve?</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">We want \(\frac{dy}{dx}\), but \(y\) isn't given as a function of \(x\)!</p>
            </div>
        </div>

        <!-- Slide 9: The Chain Rule Approach -->
        <div class="slide slide-visual" data-slide="9" data-section="Derivatives of Parametric Equations" data-title="Deriving the Slope Formula">
            <div class="slide-content">
                <h2>Deriving the Slope Formula</h2>
                <div style="text-align: center; margin: 1rem 0;">
                    <p style="font-size: 1.3rem;">Both \(x\) and \(y\) are functions of \(t\)</p>
                    <p style="font-size: 1.3rem; margin-top: 0.5rem;">By the chain rule: \(\frac{dy}{dt} = \frac{dy}{dx} \cdot \frac{dx}{dt}\)</p>
                    <p style="font-size: 1.3rem; margin-top: 0.5rem;">Solving for slope:</p>
                </div>
                <div class="formula-box" style="max-width: 500px; margin: 1.5rem auto;">
                    <p class="math-display" style="font-size: 2rem;">\[\frac{dy}{dx} = \frac{dy/dt}{dx/dt} = \frac{y'(t)}{x'(t)}\]</p>
                </div>
                <p class="caption" style="color: var(--theme-color);">It's NOT just fraction cancellation - it's the chain rule!</p>
            </div>
        </div>

        <!-- Slide 10: Velocity Interpretation -->
        <div class="slide slide-visual" data-slide="10" data-section="Derivatives of Parametric Equations" data-title="Velocity Interpretation">
            <div class="slide-content">
                <h2>Understanding the Formula</h2>
                <div id="velocity-decomp-viz" class="viz-container" style="height: 380px;"></div>
                <div class="slider-container">
                    <span style="font-size: 1.25rem;">t = </span>
                    <input type="range" id="velocity-t-slider" min="0" max="6.28" step="0.05" value="0.785">
                    <span id="velocity-t-value" style="font-size: 1.25rem;">0.79</span>
                </div>
                <p class="caption">Slope = (vertical velocity) / (horizontal velocity) = \(\frac{dy/dt}{dx/dt}\)</p>
            </div>
        </div>

        <!-- Slide 11: Example 1 - Parabola -->
        <div class="slide slide-example" data-slide="11" data-section="Derivatives of Parametric Equations" data-title="Example: Parabola">
            <div class="slide-content">
                <h2>Example: Parabola</h2>
                <div class="two-column">
                    <div>
                        <p style="font-size: 1.3rem;"><strong>Given:</strong> \(x = t, \quad y = t^2\)</p>
                        <ul class="step-list" style="margin-top: 1.5rem;">
                            <li style="font-size: 1.2rem;">\(\dfrac{dx}{dt} = 1\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{dy}{dt} = 2t\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{dy}{dx} = \dfrac{2t}{1} = 2t = 2x\)</li>
                        </ul>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(34, 197, 94, 0.1); border: 2px solid #22c55e; border-radius: 8px;">
                            <p style="font-size: 1.2rem; color: #22c55e;"><strong>Verification:</strong> Matches derivative of \(y = x^2\)!</p>
                        </div>
                    </div>
                    <div id="example1-viz" class="viz-container" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 12: Example 2 - Circle -->
        <div class="slide slide-example" data-slide="12" data-section="Derivatives of Parametric Equations" data-title="Example: Circle">
            <div class="slide-content">
                <h2>Example: Unit Circle</h2>
                <div class="two-column">
                    <div>
                        <p style="font-size: 1.3rem;"><strong>Given:</strong> \(x = \cos t, \quad y = \sin t\)</p>
                        <ul class="step-list" style="margin-top: 1.5rem;">
                            <li style="font-size: 1.2rem;">\(\dfrac{dx}{dt} = -\sin t\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{dy}{dt} = \cos t\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{dy}{dx} = \dfrac{\cos t}{-\sin t} = -\cot t\)</li>
                        </ul>
                        <p style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 4px; font-size: 1.2rem;">
                            At \(t = \frac{\pi}{4}\): \(\frac{dy}{dx} = -\cot(\frac{\pi}{4}) = -1\)
                        </p>
                    </div>
                    <div id="circle-deriv-viz" class="viz-container" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Interactive Tangent Explorer -->
        <div class="slide slide-visual" data-slide="13" data-section="Derivatives of Parametric Equations" data-title="Interactive Tangent Explorer">
            <div class="slide-content">
                <h2>Tangent Lines on Parametric Curves</h2>
                <div id="tangent-viz" class="viz-container"></div>
                <div class="slider-container">
                    <span style="font-size: 1.25rem;">t = </span>
                    <input type="range" id="tangent-t-slider" min="0" max="6.28" step="0.05" value="0.785">
                    <span id="tangent-t-value" style="font-size: 1.25rem;">0.79</span>
                    <span style="margin-left: 2rem; font-size: 1.25rem;">Slope: </span>
                    <span id="tangent-slope-value" style="font-size: 1.25rem; color: var(--theme-color); font-weight: bold;">-1.00</span>
                </div>
                <p class="caption">Drag to see how the slope changes around the curve</p>
            </div>
        </div>

        <!-- Slide 14: Tangent Line Equation -->
        <div class="slide slide-two-part" data-slide="14" data-section="Derivatives of Parametric Equations" data-title="Tangent Line Equation">
            <div class="slide-content">
                <p class="primary">Tangent Line Equation</p>
                <div class="columns" style="margin-top: 2rem;">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Formula</h3>
                        <p style="font-size: 1.2rem; margin-top: 1rem;">Point: \((x(t_0), y(t_0))\)</p>
                        <p style="font-size: 1.2rem;">Slope: \(m = \frac{dy}{dx}\) at \(t = t_0\)</p>
                        <p style="font-size: 1.2rem;">Line: \(y - y(t_0) = m(x - x(t_0))\)</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Example</h3>
                        <p style="font-size: 1.1rem; margin-top: 1rem;">For \(x = t^2, y = t^3\) at \(t = 1\):</p>
                        <p style="font-size: 1.1rem;">Point: \((1, 1)\)</p>
                        <p style="font-size: 1.1rem;">\(m = \frac{3t^2}{2t}\big|_{t=1} = \frac{3}{2}\)</p>
                        <p style="font-size: 1.1rem;">Line: \(y - 1 = \frac{3}{2}(x - 1)\)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 15: The Second Derivative -->
        <div class="slide slide-statement" data-slide="15" data-section="Second Derivatives" data-title="The Second Derivative">
            <div class="slide-content">
                <p class="statement">Finding \(\frac{d^2y}{dx^2}\) requires extra care!</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">The most common error on parametric problems...</p>
            </div>
        </div>

        <!-- Slide 16: Second Derivative Formula with Error Boxes -->
        <div class="slide slide-visual" data-slide="16" data-section="Second Derivatives" data-title="Second Derivative Formula">
            <div class="slide-content">
                <h2>The Second Derivative</h2>
                <div class="example-grid" style="max-width: 900px; margin: 1.5rem auto;">
                    <div class="error-box">
                        <h4>WRONG</h4>
                        <p style="font-size: 1.4rem;">\[\frac{d^2y}{dx^2} = \frac{d^2y/dt^2}{d^2x/dt^2}\]</p>
                    </div>
                    <div class="correct-box">
                        <h4>RIGHT</h4>
                        <p style="font-size: 1.4rem;">\[\frac{d^2y}{dx^2} = \frac{\frac{d}{dt}\left(\frac{dy}{dx}\right)}{\frac{dx}{dt}}\]</p>
                    </div>
                </div>
                <div class="definition-box" style="margin-top: 1.5rem; max-width: 700px; margin-left: auto; margin-right: auto;">
                    <p style="font-size: 1.2rem;">Take derivative of \(\frac{dy}{dx}\) with respect to \(t\), then divide by \(\frac{dx}{dt}\)</p>
                </div>
                <p class="caption" style="margin-top: 1rem; color: var(--theme-color); font-weight: bold;">Memorize the correct formula - this appears frequently on the AP exam!</p>
            </div>
        </div>

        <!-- Slide 17: Second Derivative Example -->
        <div class="slide slide-example" data-slide="17" data-section="Second Derivatives" data-title="Second Derivative Example">
            <div class="slide-content">
                <h2>Example: \(x = t^2, y = t^3\)</h2>
                <div class="two-column">
                    <div>
                        <ul class="step-list" style="margin-top: 1rem;">
                            <li style="font-size: 1.2rem;">\(\dfrac{dy}{dx} = \dfrac{3t^2}{2t} = \dfrac{3t}{2}\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{d}{dt}\left(\dfrac{dy}{dx}\right) = \dfrac{d}{dt}\left(\dfrac{3t}{2}\right) = \dfrac{3}{2}\)</li>
                            <li style="font-size: 1.2rem;">\(\dfrac{d^2y}{dx^2} = \dfrac{3/2}{2t} = \dfrac{3}{4t}\)</li>
                        </ul>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                            <p style="font-size: 1.15rem;"><strong>Verification:</strong></p>
                            <p style="font-size: 1.15rem;">At \(t = 1\): \(\frac{d^2y}{dx^2} = \frac{3}{4} > 0\) (concave up)</p>
                        </div>
                    </div>
                    <div id="second-deriv-viz" class="viz-container" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 18: Horizontal Tangents -->
        <div class="slide slide-two-part" data-slide="18" data-section="Horizontal and Vertical Tangents" data-title="Horizontal Tangents">
            <div class="slide-content">
                <p class="primary">Horizontal Tangent</p>
                <div class="columns" style="margin-top: 2rem;">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Condition</h3>
                        <p style="font-size: 1.3rem; margin-top: 1rem;">\(\frac{dy}{dx} = 0\)</p>
                        <p style="font-size: 1.2rem; margin-top: 0.5rem;">This means \(\frac{dy}{dt} = 0\) AND \(\frac{dx}{dt} \neq 0\)</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Meaning</h3>
                        <p style="font-size: 1.2rem; margin-top: 1rem;">The curve has a horizontal tangent line</p>
                        <p style="font-size: 1.2rem; margin-top: 0.5rem;">The vertical velocity is zero</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 19: Vertical Tangents -->
        <div class="slide slide-two-part" data-slide="19" data-section="Horizontal and Vertical Tangents" data-title="Vertical Tangents">
            <div class="slide-content">
                <p class="primary">Vertical Tangent</p>
                <div class="columns" style="margin-top: 2rem;">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Condition</h3>
                        <p style="font-size: 1.3rem; margin-top: 1rem;">\(\frac{dy}{dx}\) is undefined</p>
                        <p style="font-size: 1.2rem; margin-top: 0.5rem;">This means \(\frac{dx}{dt} = 0\) AND \(\frac{dy}{dt} \neq 0\)</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Special Case</h3>
                        <p style="font-size: 1.2rem; margin-top: 1rem;">If both \(\frac{dy}{dt} = 0\) AND \(\frac{dx}{dt} = 0\):</p>
                        <p style="font-size: 1.2rem; margin-top: 0.5rem;">Need further analysis - could be a cusp, corner, or self-intersection</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 20: Tangent Analysis Example -->
        <div class="slide slide-visual" data-slide="20" data-section="Horizontal and Vertical Tangents" data-title="Tangent Analysis Example">
            <div class="slide-content">
                <h2>Finding All Tangents</h2>
                <div class="two-column">
                    <div>
                        <p style="font-size: 1.2rem;"><strong>Given:</strong> \(x = t^2 - 4, \quad y = t^3 - 3t\)</p>
                        <p style="margin-top: 1rem; font-size: 1.1rem;">\(\dfrac{dx}{dt} = 2t = 0\) at \(t = 0\)</p>
                        <p style="font-size: 1.1rem;">\(\dfrac{dy}{dt} = 3t^2 - 3 = 0\) at \(t = \pm 1\)</p>
                        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; border-radius: 0 4px 4px 0;">
                            <strong style="color: #ef4444;">Vertical tangent:</strong> \(t = 0\): point \((-4, 0)\)
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; border-radius: 0 4px 4px 0;">
                            <strong style="color: #22c55e;">Horizontal tangents:</strong> \(t = \pm 1\): points \((-3, -2)\) and \((-3, 2)\)
                        </div>
                    </div>
                    <div id="special-points-viz" class="viz-container" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 21: Practice Problem -->
        <div class="slide slide-exercise" data-slide="21" data-section="Practice" data-title="Practice Problem">
            <div class="slide-content">
                <h2>Your Turn</h2>
                <div class="prompt">
                    <p style="font-size: 1.3rem;">For \(x = \cos t, \quad y = \sin 2t\), find:</p>
                </div>
                <div class="instructions" style="text-align: left; max-width: 600px; margin: 1.5rem auto 0;">
                    <ol style="font-size: 1.25rem; line-height: 2.2;">
                        <li>\(\frac{dy}{dx}\)</li>
                        <li>The slope at \(t = \frac{\pi}{3}\)</li>
                        <li>All values of \(t\) where tangent is horizontal</li>
                    </ol>
                </div>
                <p class="caption" style="margin-top: 2rem; font-size: 1.2rem;">Time: 4 minutes</p>
            </div>
        </div>

        <!-- Slide 22: Practice Solution -->
        <div class="slide slide-example" data-slide="22" data-section="Practice" data-title="Practice Solution">
            <div class="slide-content">
                <h2>Solution</h2>
                <div style="max-width: 800px; margin: 0 auto; text-align: left;">
                    <p style="font-size: 1.2rem; margin: 1rem 0;"><strong>a)</strong> \(\frac{dy}{dx} = \frac{2\cos 2t}{-\sin t}\)</p>
                    <p style="font-size: 1.2rem; margin: 1rem 0;"><strong>b)</strong> At \(t = \frac{\pi}{3}\): \(\frac{dy}{dx} = \frac{2\cos(\frac{2\pi}{3})}{-\sin(\frac{\pi}{3})} = \frac{2(-\frac{1}{2})}{-\frac{\sqrt{3}}{2}} = \frac{2}{\sqrt{3}} = \frac{2\sqrt{3}}{3}\)</p>
                    <p style="font-size: 1.2rem; margin: 1rem 0;"><strong>c)</strong> Horizontal: \(2\cos 2t = 0\), so \(2t = \frac{\pi}{2}, \frac{3\pi}{2}, ...\)</p>
                    <p style="font-size: 1.2rem; margin-left: 2rem;">giving \(t = \frac{\pi}{4}, \frac{3\pi}{4}, ...\)</p>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border: 2px solid #22c55e; border-radius: 8px;">
                        <p style="font-size: 1.1rem; color: #22c55e;"><strong>Check:</strong> \(\sin t \neq 0\) at these values (confirmed!)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 23: Key Takeaways -->
        <div class="slide slide-list" data-slide="23" data-section="Summary" data-title="Key Takeaways">
            <div class="slide-content">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Parametric equations describe curves with \(x(t)\) and \(y(t)\)</li>
                    <li>Slope formula: \(\frac{dy}{dx} = \frac{dy/dt}{dx/dt}\) - the chain rule!</li>
                    <li>Second derivative: \(\frac{d^2y}{dx^2} = \frac{d/dt(dy/dx)}{dx/dt}\)</li>
                    <li>Horizontal tangent: \(\frac{dy}{dt} = 0\) (with \(\frac{dx}{dt} \neq 0\))</li>
                    <li>Vertical tangent: \(\frac{dx}{dt} = 0\) (with \(\frac{dy}{dt} \neq 0\))</li>
                </ul>
            </div>
        </div>

        <!-- Slide 24: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="24" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p style="font-size: 1.3rem;">For \(x = e^t, \quad y = e^{2t}\), find \(\frac{dy}{dx}\) and simplify.</p>
                </div>
                <p class="caption" style="margin-top: 2rem; color: var(--theme-color);">Hint: This should simplify to a familiar form...</p>
            </div>
        </div>

        <!-- Slide 25: Coming Up -->
        <div class="slide slide-statement" data-slide="25" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement">Next: Arc Length of Parametric Curves</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">How far does a particle travel along its path?</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 26</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>&#8592;</kbd> <kbd>&#8594;</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 49: Parametric Equations and Derivatives</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">&#8592; Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">&#8592; Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next &#8594;</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <script src="../shared/presentation.js"></script>

    <script>
        // Visualization functions mapping
        const visualizationSlides = {
            3: drawParamIntroViz,
            5: drawTableMethodViz,
            10: drawVelocityDecompViz,
            11: drawExample1Viz,
            12: drawCircleDerivViz,
            13: drawTangentViz,
            17: drawSecondDerivViz,
            20: drawSpecialPointsViz
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;
            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        setInterval(checkAndDrawVisualization, 200);

        // Also check on hash changes
        window.addEventListener('hashchange', () => {
            setTimeout(checkAndDrawVisualization, 100);
        });

        // Initial check after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkAndDrawVisualization, 200);
            });
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }

        // Visualization: Table Method (Slide 5)
        function drawTableMethodViz() {
            const container = d3.select('#table-method-viz');
            container.selectAll('*').remove();

            const width = 800;
            const height = 380;

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Example curve: x = t^2 - 1, y = 2t
            const tValues = [-2, -1, 0, 1, 2];
            const tableData = tValues.map(t => ({
                t: t,
                x: t * t - 1,
                y: 2 * t,
                shown: false
            }));

            let currentStep = 0;

            // Left side: Table
            const tableX = 50;
            const tableY = 40;
            const cellWidth = 80;
            const cellHeight = 40;

            // Table headers
            ['t', 'x(t)', 'y(t)'].forEach((header, i) => {
                svg.append('rect')
                    .attr('x', tableX + i * cellWidth)
                    .attr('y', tableY)
                    .attr('width', cellWidth)
                    .attr('height', cellHeight)
                    .attr('fill', '#0891b2')
                    .attr('stroke', '#065f73');
                svg.append('text')
                    .attr('x', tableX + i * cellWidth + cellWidth / 2)
                    .attr('y', tableY + cellHeight / 2 + 6)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1.25rem')
                    .attr('font-weight', 'bold')
                    .attr('fill', 'white')
                    .text(header);
            });

            // Table rows (initially empty)
            const tableRows = tableData.map((d, i) => {
                const row = svg.append('g').attr('class', 'table-row').attr('opacity', 0.3);
                [d.t, d.x, d.y].forEach((val, j) => {
                    row.append('rect')
                        .attr('x', tableX + j * cellWidth)
                        .attr('y', tableY + (i + 1) * cellHeight)
                        .attr('width', cellWidth)
                        .attr('height', cellHeight)
                        .attr('fill', i % 2 === 0 ? '#1e293b' : '#0f172a')
                        .attr('stroke', '#334155');
                    row.append('text')
                        .attr('x', tableX + j * cellWidth + cellWidth / 2)
                        .attr('y', tableY + (i + 1) * cellHeight + cellHeight / 2 + 6)
                        .attr('text-anchor', 'middle')
                        .attr('font-size', '1.25rem')
                        .attr('fill', '#e2e8f0')
                        .text(val);
                });
                return row;
            });

            // Right side: Graph
            const graphX = 350;
            const graphWidth = 400;
            const graphHeight = 340;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const xScale = d3.scaleLinear()
                .domain([-2, 4])
                .range([graphX + margin.left, graphX + graphWidth - margin.right]);
            const yScale = d3.scaleLinear()
                .domain([-5, 5])
                .range([graphHeight - margin.bottom, margin.top]);

            // Grid lines
            svg.append('g').selectAll('line.h').data(d3.range(-5, 6)).enter().append('line')
                .attr('x1', graphX + margin.left).attr('x2', graphX + graphWidth - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#334155').attr('stroke-width', 1);

            svg.append('g').selectAll('line.v').data(d3.range(-2, 5)).enter().append('line')
                .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))
                .attr('y1', margin.top).attr('y2', graphHeight - margin.bottom)
                .attr('stroke', '#334155').attr('stroke-width', 1);

            // Axes
            svg.append('line')
                .attr('x1', graphX + margin.left).attr('x2', graphX + graphWidth - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#64748b').attr('stroke-width', 2);
            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', graphHeight - margin.bottom)
                .attr('stroke', '#64748b').attr('stroke-width', 2);

            // Axis labels
            svg.append('text')
                .attr('x', graphX + graphWidth - margin.right + 10)
                .attr('y', yScale(0) + 5)
                .attr('font-size', '1.25rem')
                .attr('fill', '#94a3b8')
                .text('x');
            svg.append('text')
                .attr('x', xScale(0) - 5)
                .attr('y', margin.top - 5)
                .attr('font-size', '1.25rem')
                .attr('fill', '#94a3b8')
                .text('y');

            // Points group
            const pointsGroup = svg.append('g');
            const arrowsGroup = svg.append('g');

            function updateVisualization() {
                // Update table rows
                tableRows.forEach((row, i) => {
                    row.attr('opacity', i < currentStep ? 1 : 0.3);
                });

                // Update points
                pointsGroup.selectAll('circle').remove();
                for (let i = 0; i < currentStep && i < tableData.length; i++) {
                    const d = tableData[i];
                    pointsGroup.append('circle')
                        .attr('cx', xScale(d.x))
                        .attr('cy', yScale(d.y))
                        .attr('r', 8)
                        .attr('fill', '#0891b2')
                        .attr('stroke', 'white')
                        .attr('stroke-width', 2);

                    // Label
                    pointsGroup.append('text')
                        .attr('x', xScale(d.x) + 12)
                        .attr('y', yScale(d.y) - 8)
                        .attr('font-size', '1.25rem')
                        .attr('fill', '#94a3b8')
                        .text(`t=${d.t}`);
                }

                // Draw arrows between consecutive points
                arrowsGroup.selectAll('*').remove();
                for (let i = 0; i < currentStep - 1 && i < tableData.length - 1; i++) {
                    const d1 = tableData[i];
                    const d2 = tableData[i + 1];
                    const x1 = xScale(d1.x);
                    const y1 = yScale(d1.y);
                    const x2 = xScale(d2.x);
                    const y2 = yScale(d2.y);

                    // Draw arrow
                    const dx = x2 - x1;
                    const dy = y2 - y1;
                    const len = Math.sqrt(dx * dx + dy * dy);
                    const nx = dx / len;
                    const ny = dy / len;

                    arrowsGroup.append('line')
                        .attr('x1', x1 + nx * 12)
                        .attr('y1', y1 + ny * 12)
                        .attr('x2', x2 - nx * 12)
                        .attr('y2', y2 - ny * 12)
                        .attr('stroke', '#f59e0b')
                        .attr('stroke-width', 2)
                        .attr('marker-end', 'url(#table-arrow)');
                }
            }

            // Arrow marker
            svg.append('defs').append('marker')
                .attr('id', 'table-arrow')
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 9)
                .attr('refY', 5)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', '#f59e0b');

            // Button handlers
            const stepBtn = document.getElementById('table-step-btn');
            const resetBtn = document.getElementById('table-reset-btn');

            if (stepBtn) {
                stepBtn.onclick = function() {
                    if (currentStep < tableData.length) {
                        currentStep++;
                        updateVisualization();
                    }
                };
            }

            if (resetBtn) {
                resetBtn.onclick = function() {
                    currentStep = 0;
                    updateVisualization();
                };
            }

            updateVisualization();
        }

        // Visualization: Velocity Decomposition (Slide 10)
        function drawVelocityDecompViz() {
            const container = d3.select('#velocity-decomp-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 360;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Ellipse: x = 2cos(t), y = sin(t)
            const a = 2; // x semi-axis
            const b = 1; // y semi-axis

            const xScale = d3.scaleLinear().domain([-3, 3]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-2, 2]).range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g').selectAll('line.h').data([-1, 0, 1]).enter().append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#334155').attr('stroke-width', 1);

            svg.append('g').selectAll('line.v').data([-2, -1, 0, 1, 2]).enter().append('line')
                .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#334155').attr('stroke-width', 1);

            // Axes
            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#64748b').attr('stroke-width', 2);
            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#64748b').attr('stroke-width', 2);

            // Draw ellipse
            const tValues = d3.range(0, 2 * Math.PI + 0.01, 0.05);
            const ellipseData = tValues.map(t => ({ x: a * Math.cos(t), y: b * Math.sin(t) }));
            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveLinearClosed);

            svg.append('path')
                .datum(ellipseData)
                .attr('fill', 'none')
                .attr('stroke', '#8b5cf6')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Arrow markers
            const defs = svg.append('defs');

            defs.append('marker')
                .attr('id', 'vel-arrow-h')
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 9)
                .attr('refY', 5)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', '#10b981');

            defs.append('marker')
                .attr('id', 'vel-arrow-v')
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 9)
                .attr('refY', 5)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', '#f59e0b');

            defs.append('marker')
                .attr('id', 'vel-arrow-total')
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 9)
                .attr('refY', 5)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', '#f97316');

            // Velocity components
            const hComponent = svg.append('line')
                .attr('stroke', '#10b981')
                .attr('stroke-width', 3)
                .attr('marker-end', 'url(#vel-arrow-h)');

            const vComponent = svg.append('line')
                .attr('stroke', '#f59e0b')
                .attr('stroke-width', 3)
                .attr('marker-end', 'url(#vel-arrow-v)');

            const totalVel = svg.append('line')
                .attr('stroke', '#f97316')
                .attr('stroke-width', 4)
                .attr('marker-end', 'url(#vel-arrow-total)');

            const point = svg.append('circle')
                .attr('r', 10)
                .attr('fill', '#0891b2')
                .attr('stroke', 'white')
                .attr('stroke-width', 2);

            // Info display
            const infoGroup = svg.append('g');
            const dxdtText = infoGroup.append('text')
                .attr('x', width - 180)
                .attr('y', 50)
                .attr('font-size', '1.25rem')
                .attr('fill', '#10b981');

            const dydtText = infoGroup.append('text')
                .attr('x', width - 180)
                .attr('y', 80)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f59e0b');

            const slopeText = infoGroup.append('text')
                .attr('x', width - 180)
                .attr('y', 110)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .attr('font-weight', 'bold');

            // Legend
            svg.append('rect').attr('x', margin.left + 10).attr('y', 10).attr('width', 20).attr('height', 4).attr('fill', '#10b981');
            svg.append('text').attr('x', margin.left + 35).attr('y', 18).attr('font-size', '1.25rem').attr('fill', '#10b981').text('dx/dt (horizontal)');

            svg.append('rect').attr('x', margin.left + 10).attr('y', 35).attr('width', 20).attr('height', 4).attr('fill', '#f59e0b');
            svg.append('text').attr('x', margin.left + 35).attr('y', 43).attr('font-size', '1.25rem').attr('fill', '#f59e0b').text('dy/dt (vertical)');

            svg.append('rect').attr('x', margin.left + 10).attr('y', 60).attr('width', 20).attr('height', 4).attr('fill', '#f97316');
            svg.append('text').attr('x', margin.left + 35).attr('y', 68).attr('font-size', '1.25rem').attr('fill', '#f97316').text('velocity vector');

            const slider = document.getElementById('velocity-t-slider');
            const tDisplay = document.getElementById('velocity-t-value');

            function updateVelocity() {
                const t = parseFloat(slider.value);
                const x = a * Math.cos(t);
                const y = b * Math.sin(t);
                const dxdt = -a * Math.sin(t);
                const dydt = b * Math.cos(t);

                // Scale velocity vectors for visibility
                const scale = 0.5;
                const vx = dxdt * scale;
                const vy = dydt * scale;

                point.attr('cx', xScale(x)).attr('cy', yScale(y));

                // Horizontal component
                hComponent
                    .attr('x1', xScale(x))
                    .attr('y1', yScale(y))
                    .attr('x2', xScale(x + vx))
                    .attr('y2', yScale(y));

                // Vertical component
                vComponent
                    .attr('x1', xScale(x + vx))
                    .attr('y1', yScale(y))
                    .attr('x2', xScale(x + vx))
                    .attr('y2', yScale(y + vy));

                // Total velocity
                totalVel
                    .attr('x1', xScale(x))
                    .attr('y1', yScale(y))
                    .attr('x2', xScale(x + vx))
                    .attr('y2', yScale(y + vy));

                // Update info
                tDisplay.textContent = t.toFixed(2);
                dxdtText.text(`dx/dt = ${dxdt.toFixed(2)}`);
                dydtText.text(`dy/dt = ${dydt.toFixed(2)}`);

                const slope = Math.abs(dxdt) > 0.01 ? dydt / dxdt : (dydt > 0 ? Infinity : -Infinity);
                slopeText.text(`dy/dx = ${isFinite(slope) ? slope.toFixed(2) : 'undef'}`);
            }

            if (slider) {
                slider.oninput = updateVelocity;
                updateVelocity();
            }
        }

        // Visualization 1: Parametric Introduction
        function drawParamIntroViz() {
            const container = d3.select('#param-intro-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 400;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-2, 4]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-5, 5]).range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g').selectAll('line.h').data(d3.range(-5, 6)).enter().append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            svg.append('g').selectAll('line.v').data(d3.range(-2, 5)).enter().append('line')
                .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 2);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 2);

            // Parametric curve
            const tValues = d3.range(-2, 2.01, 0.05);
            const curveData = tValues.map(t => ({ x: t * t - 1, y: 2 * t, t }));

            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            svg.append('path').datum(curveData).attr('fill', 'none')
                .attr('stroke', '#8b5cf6').attr('stroke-width', 3).attr('d', line);

            // Animate point
            const point = svg.append('circle').attr('r', 10).attr('fill', '#06b6d4');
            const slider = document.getElementById('param-t-slider');
            const tDisplay = document.getElementById('param-t-value');

            function updatePoint() {
                const t = parseFloat(slider.value);
                const x = t * t - 1;
                const y = 2 * t;
                point.attr('cx', xScale(x)).attr('cy', yScale(y));
                tDisplay.textContent = t.toFixed(1);
            }

            slider.oninput = updatePoint;
            updatePoint();

            // Direction arrows
            const arrowData = [{ t: -1.5 }, { t: -0.5 }, { t: 0.5 }, { t: 1.5 }];
            arrowData.forEach(d => {
                const t = d.t;
                const x = t * t - 1;
                const y = 2 * t;
                const dx = 2 * t * 0.1;
                const dy = 2 * 0.1;
                svg.append('line')
                    .attr('x1', xScale(x)).attr('y1', yScale(y))
                    .attr('x2', xScale(x + dx)).attr('y2', yScale(y + dy))
                    .attr('stroke', '#f59e0b').attr('stroke-width', 2)
                    .attr('marker-end', 'url(#arrowhead)');
            });

            svg.append('defs').append('marker').attr('id', 'arrowhead').attr('viewBox', '0 0 10 10')
                .attr('refX', 9).attr('refY', 5).attr('markerWidth', 6).attr('markerHeight', 6)
                .attr('orient', 'auto').append('path').attr('d', 'M 0 0 L 10 5 L 0 10 z').attr('fill', '#f59e0b');
        }

        // Visualization 2: Common Curves
        let currentCurve = 'circle';
        function drawCommonCurvesViz() {
            const container = d3.select('#common-curves-viz');
            container.selectAll('svg').remove();

            const width = 700;
            const height = 380;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const curves = {
                circle: { fn: t => ({ x: Math.cos(t), y: Math.sin(t) }), domain: [0, 2 * Math.PI], label: 'x = cos t, y = sin t' },
                ellipse: { fn: t => ({ x: 2 * Math.cos(t), y: Math.sin(t) }), domain: [0, 2 * Math.PI], label: 'x = 2cos t, y = sin t' },
                cycloid: { fn: t => ({ x: t - Math.sin(t), y: 1 - Math.cos(t) }), domain: [0, 4 * Math.PI], label: 'x = t - sin t, y = 1 - cos t' },
                lissajous: { fn: t => ({ x: Math.sin(3 * t), y: Math.sin(2 * t) }), domain: [0, 2 * Math.PI], label: 'x = sin 3t, y = sin 2t' }
            };

            const curve = curves[currentCurve];
            const tValues = d3.range(curve.domain[0], curve.domain[1] + 0.01, 0.05);
            const data = tValues.map(t => curve.fn(t));

            const xExtent = d3.extent(data, d => d.x);
            const yExtent = d3.extent(data, d => d.y);
            const xPad = (xExtent[1] - xExtent[0]) * 0.2 || 1;
            const yPad = (yExtent[1] - yExtent[0]) * 0.2 || 1;

            const xScale = d3.scaleLinear().domain([xExtent[0] - xPad, xExtent[1] + xPad]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([yExtent[0] - yPad, yExtent[1] + yPad]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#ccc').attr('stroke-width', 1);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#ccc').attr('stroke-width', 1);

            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            svg.append('path').datum(data).attr('fill', 'none')
                .attr('stroke', '#06b6d4').attr('stroke-width', 3).attr('d', line);

            svg.append('text').attr('x', width / 2).attr('y', height - 5)
                .attr('text-anchor', 'middle').attr('font-size', '1.25rem').text(curve.label);

            document.querySelectorAll('.control-btn[data-curve]').forEach(btn => {
                btn.onclick = function() {
                    currentCurve = this.dataset.curve;
                    document.querySelectorAll('.control-btn[data-curve]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    drawCommonCurvesViz();
                };
            });
        }

        // Visualization 3: Example 1
        function drawExample1Viz() {
            const container = d3.select('#example1-viz');
            container.selectAll('*').remove();

            const width = 350;
            const height = 280;
            const margin = { top: 10, right: 20, bottom: 30, left: 40 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-2, 4]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-5, 5]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 1);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 1);

            const tValues = d3.range(-2, 2.01, 0.05);
            const curveData = tValues.map(t => ({ x: t * t - 1, y: 2 * t }));
            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            svg.append('path').datum(curveData).attr('fill', 'none')
                .attr('stroke', '#8b5cf6').attr('stroke-width', 2).attr('d', line);

            // Points with tangent lines
            [1, 2].forEach(t => {
                const x = t * t - 1;
                const y = 2 * t;
                const slope = 1 / t;
                svg.append('circle').attr('cx', xScale(x)).attr('cy', yScale(y)).attr('r', 6).attr('fill', '#06b6d4');
                svg.append('line')
                    .attr('x1', xScale(x - 1)).attr('y1', yScale(y - slope))
                    .attr('x2', xScale(x + 1)).attr('y2', yScale(y + slope))
                    .attr('stroke', '#f59e0b').attr('stroke-width', 2);
            });
        }

        // Visualization 4: Circle Derivative
        function drawCircleDerivViz() {
            const container = d3.select('#circle-deriv-viz');
            container.selectAll('*').remove();

            const width = 300;
            const height = 280;
            const margin = { top: 10, right: 20, bottom: 30, left: 40 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-1.5, 1.5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-1.5, 1.5]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 1);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 1);

            // Circle
            const tValues = d3.range(0, 2 * Math.PI + 0.01, 0.05);
            const circleData = tValues.map(t => ({ x: Math.cos(t), y: Math.sin(t) }));
            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveLinearClosed);

            svg.append('path').datum(circleData).attr('fill', 'none')
                .attr('stroke', '#8b5cf6').attr('stroke-width', 2).attr('d', line);

            // Points
            [Math.PI / 4, Math.PI / 2].forEach(t => {
                const x = Math.cos(t);
                const y = Math.sin(t);
                const slope = -Math.cos(t) / Math.sin(t);
                svg.append('circle').attr('cx', xScale(x)).attr('cy', yScale(y)).attr('r', 6).attr('fill', '#06b6d4');
                if (Math.abs(slope) < 10) {
                    const dx = 0.5;
                    svg.append('line')
                        .attr('x1', xScale(x - dx)).attr('y1', yScale(y - slope * dx))
                        .attr('x2', xScale(x + dx)).attr('y2', yScale(y + slope * dx))
                        .attr('stroke', '#f59e0b').attr('stroke-width', 2);
                } else {
                    svg.append('line')
                        .attr('x1', xScale(x)).attr('y1', yScale(y - 0.5))
                        .attr('x2', xScale(x)).attr('y2', yScale(y + 0.5))
                        .attr('stroke', '#f59e0b').attr('stroke-width', 2);
                }
            });
        }

        // Visualization 5: Interactive Tangent
        function drawTangentViz() {
            const container = d3.select('#tangent-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 380;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-1.5, 1.5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-1.5, 1.5]).range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g').selectAll('line.h').data([-1, 0, 1]).enter().append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            svg.append('g').selectAll('line.v').data([-1, 0, 1]).enter().append('line')
                .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 2);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 2);

            // Circle
            const tValues = d3.range(0, 2 * Math.PI + 0.01, 0.05);
            const circleData = tValues.map(t => ({ x: Math.cos(t), y: Math.sin(t) }));
            const lineFn = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveLinearClosed);

            svg.append('path').datum(circleData).attr('fill', 'none')
                .attr('stroke', '#8b5cf6').attr('stroke-width', 3).attr('d', lineFn);

            const tangentLine = svg.append('line').attr('stroke', '#f59e0b').attr('stroke-width', 2);
            const point = svg.append('circle').attr('r', 10).attr('fill', '#06b6d4');

            const slider = document.getElementById('tangent-t-slider');
            const tDisplay = document.getElementById('tangent-t-value');
            const slopeDisplay = document.getElementById('tangent-slope-value');

            function updateTangent() {
                const t = parseFloat(slider.value);
                const x = Math.cos(t);
                const y = Math.sin(t);
                const slope = Math.sin(t) !== 0 ? -Math.cos(t) / Math.sin(t) : Infinity;

                point.attr('cx', xScale(x)).attr('cy', yScale(y));
                tDisplay.textContent = t.toFixed(2);
                slopeDisplay.textContent = isFinite(slope) ? slope.toFixed(2) : 'undef';

                if (Math.abs(slope) < 20) {
                    const dx = 0.8;
                    tangentLine
                        .attr('x1', xScale(x - dx)).attr('y1', yScale(y - slope * dx))
                        .attr('x2', xScale(x + dx)).attr('y2', yScale(y + slope * dx))
                        .attr('opacity', 1);
                } else {
                    tangentLine
                        .attr('x1', xScale(x)).attr('y1', yScale(y - 0.8))
                        .attr('x2', xScale(x)).attr('y2', yScale(y + 0.8))
                        .attr('opacity', 1);
                }
            }

            slider.oninput = updateTangent;
            updateTangent();
        }

        // Visualization 6: Special Points
        function drawSpecialPointsViz() {
            const container = d3.select('#special-points-viz');
            container.selectAll('*').remove();

            const width = 350;
            const height = 280;
            const margin = { top: 10, right: 20, bottom: 30, left: 40 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-3, 3]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-5, 2]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 1);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 1);

            // Curve: x = t^3 - 3t, y = t^2 - 4
            const tValues = d3.range(-2, 2.01, 0.05);
            const curveData = tValues.map(t => ({ x: t * t * t - 3 * t, y: t * t - 4 }));
            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            svg.append('path').datum(curveData).attr('fill', 'none')
                .attr('stroke', '#8b5cf6').attr('stroke-width', 2).attr('d', line);

            // Vertical tangent points (t = 1 and t = -1)
            [-1, 1].forEach(t => {
                const x = t * t * t - 3 * t;
                const y = t * t - 4;
                svg.append('circle').attr('cx', xScale(x)).attr('cy', yScale(y)).attr('r', 6).attr('fill', '#f59e0b');
                svg.append('line')
                    .attr('x1', xScale(x)).attr('y1', yScale(y - 1))
                    .attr('x2', xScale(x)).attr('y2', yScale(y + 1))
                    .attr('stroke', '#f59e0b').attr('stroke-width', 2);
            });

            // Horizontal tangent point (t = 0)
            svg.append('circle').attr('cx', xScale(0)).attr('cy', yScale(-4)).attr('r', 6).attr('fill', '#10b981');
            svg.append('line')
                .attr('x1', xScale(-1)).attr('y1', yScale(-4))
                .attr('x2', xScale(1)).attr('y2', yScale(-4))
                .attr('stroke', '#10b981').attr('stroke-width', 2);
        }

        // Visualization 7: Second Derivative
        function drawSecondDerivViz() {
            const container = d3.select('#second-deriv-viz');
            container.selectAll('*').remove();

            const width = 350;
            const height = 280;
            const margin = { top: 10, right: 20, bottom: 30, left: 40 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-1, 5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-3, 3]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 1);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 1);

            // Curve: x = t^2, y = t^3
            const tValuesNeg = d3.range(-1.5, 0, 0.05);
            const tValuesPos = d3.range(0, 1.8, 0.05);

            const curveDataNeg = tValuesNeg.map(t => ({ x: t * t, y: t * t * t }));
            const curveDataPos = tValuesPos.map(t => ({ x: t * t, y: t * t * t }));

            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            svg.append('path').datum(curveDataNeg).attr('fill', 'none')
                .attr('stroke', '#ef4444').attr('stroke-width', 3).attr('d', line);

            svg.append('path').datum(curveDataPos).attr('fill', 'none')
                .attr('stroke', '#10b981').attr('stroke-width', 3).attr('d', line);

            // Origin point
            svg.append('circle').attr('cx', xScale(0)).attr('cy', yScale(0)).attr('r', 6).attr('fill', '#06b6d4');
        }

        // Visualization 8: Concavity
        function drawConcavityViz() {
            const container = d3.select('#concavity-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 380;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-1, 5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-4, 4]).range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g').selectAll('line.h').data(d3.range(-4, 5)).enter().append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            svg.append('g').selectAll('line.v').data(d3.range(-1, 6)).enter().append('line')
                .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#e5e7eb').attr('stroke-width', 1);

            // Axes
            svg.append('line').attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0)).attr('stroke', '#333').attr('stroke-width', 2);
            svg.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom).attr('stroke', '#333').attr('stroke-width', 2);

            // Curve: x = t^2, y = t^3
            const tValuesNeg = d3.range(-1.6, 0, 0.05);
            const tValuesPos = d3.range(0, 2.1, 0.05);

            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);

            // Concave down (t < 0)
            const curveDataNeg = tValuesNeg.map(t => ({ x: t * t, y: t * t * t }));
            svg.append('path').datum(curveDataNeg).attr('fill', 'none')
                .attr('stroke', '#ef4444').attr('stroke-width', 4).attr('d', line);

            // Concave up (t > 0)
            const curveDataPos = tValuesPos.map(t => ({ x: t * t, y: t * t * t }));
            svg.append('path').datum(curveDataPos).attr('fill', 'none')
                .attr('stroke', '#10b981').attr('stroke-width', 4).attr('d', line);

            // Inflection point
            svg.append('circle').attr('cx', xScale(0)).attr('cy', yScale(0)).attr('r', 8).attr('fill', '#06b6d4');
            svg.append('text').attr('x', xScale(0) + 15).attr('y', yScale(0) + 5)
                .attr('font-size', '1.25rem').text('Inflection');

            // Labels
            svg.append('text').attr('x', xScale(2)).attr('y', yScale(-3))
                .attr('font-size', '1.25rem').attr('fill', '#ef4444').text('t < 0: Concave Down');
            svg.append('text').attr('x', xScale(2)).attr('y', yScale(3))
                .attr('font-size', '1.25rem').attr('fill', '#10b981').text('t > 0: Concave Up');
        }
    </script>
</body>
</html>
