<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 17: Inverse Trig Derivatives | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --theme-color: #8b5cf6;
            --theme-color-light: #a78bfa;
        }

        .formula-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            max-width: 1000px;
            margin: 1.5rem auto;
        }

        .formula-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border-top: 4px solid var(--theme-color);
        }

        .formula-card .function {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--theme-color);
        }

        .formula-card .derivative {
            font-size: 1.25rem;
        }

        .derivation-box {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            max-width: 800px;
            margin: 1.5rem auto;
        }

        .deriv-step {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .deriv-step .num {
            width: 28px;
            height: 28px;
            background: var(--theme-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .result-box {
            background: linear-gradient(135deg, var(--theme-color) 0%, #6d28d9 100%);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            max-width: 600px;
            margin: 1.5rem auto;
        }

        .result-box .formula {
            font-size: 2rem;
            color: white;
        }

        .triangle-diagram {
            max-width: 350px;
            margin: 1.5rem auto;
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
        }

        .example-solution {
            background: var(--bg-secondary);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            max-width: 700px;
            margin: 1.5rem auto;
            text-align: left;
        }

        .example-solution .problem {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .example-solution .work {
            font-size: 1.25rem;
            line-height: 2;
        }

        .example-solution .answer {
            font-size: 1.5rem;
            color: var(--success);
            margin-top: 1rem;
        }

        .practice-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-width: 800px;
            margin: 1.5rem auto;
        }

        .practice-item {
            background: var(--bg-secondary);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .practice-item .num {
            width: 28px;
            height: 28px;
            background: var(--theme-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .memory-tip {
            background: rgba(212, 160, 40, 0.1);
            border-left: 4px solid var(--accent-secondary);
            padding: 1rem 1.5rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1.5rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .memory-tip .label {
            color: var(--accent-secondary);
            font-weight: 600;
            font-family: var(--font-display);
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Inverse Trig Derivatives">
            <div class="slide-content">
                <div class="unit-badge">Unit 3: Advanced Differentiation</div>
                <h1>Inverse Trig Derivatives</h1>
                <p class="subtitle">The Calculus of Angles</p>
                <p class="meta">Class 17 | March 4, 2026 | CED 3.4</p>
            </div>
        </div>

        <!-- Slide 1: Warm-Up -->
        <div class="slide slide-exercise" data-slide="1" data-section="Opening" data-title="Warm-Up">
            <div class="slide-content">
                <h2>Warm-Up</h2>
                <div class="prompt">
                    <p>Using the inverse function derivative formula:</p>
                    <p style="font-size: 1.5rem; margin: 1.5rem 0;">\((f^{-1})'(a) = \frac{1}{f'(f^{-1}(a))}\)</p>
                    <p style="font-size: 1.5rem; color: var(--accent-secondary);">If \(f(x) = \sin(x)\), what is \((f^{-1})'(x)\)?</p>
                </div>
            </div>
        </div>

        <!-- Slide 2: Arcsin Review -->
        <div class="slide slide-visual" data-slide="2" data-section="Arcsin" data-title="Arcsin Review">
            <div class="slide-content">
                <h2>The Arcsine Function</h2>
                <div id="arcsin-graph-viz" class="visualization"></div>
                <p class="caption">\(y = \arcsin(x)\) is the inverse of \(y = \sin(x)\) restricted to \([-\frac{\pi}{2}, \frac{\pi}{2}]\)</p>
            </div>
        </div>

        <!-- Slide 3: Deriving Arcsin -->
        <div class="slide slide-visual" data-slide="3" data-section="Arcsin" data-title="Deriving d/dx[arcsin]">
            <div class="slide-content">
                <h2>Deriving \(\frac{d}{dx}[\arcsin(x)]\)</h2>
                <div class="derivation-box">
                    <div class="deriv-step">
                        <span class="num">1</span>
                        <span>Let \(y = \arcsin(x)\), so \(\sin(y) = x\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">2</span>
                        <span>Differentiate implicitly: \(\cos(y) \cdot \frac{dy}{dx} = 1\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">3</span>
                        <span>Solve: \(\frac{dy}{dx} = \frac{1}{\cos(y)}\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">4</span>
                        <span>Since \(\cos^2(y) = 1 - \sin^2(y) = 1 - x^2\)...</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">5</span>
                        <span>And \(\cos(y) \geq 0\) on \([-\frac{\pi}{2}, \frac{\pi}{2}]\): \(\cos(y) = \sqrt{1-x^2}\)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Triangle Connection -->
        <div class="slide slide-visual" data-slide="4" data-section="Arcsin" data-title="Pythagorean Connection">
            <div class="slide-content">
                <h2>The Pythagorean Connection</h2>
                <div id="triangle-viz" class="visualization" style="max-height: 350px;"></div>
                <p style="font-size: 1.5rem; margin-top: 1rem;">If \(\sin(y) = x = \frac{x}{1}\), then by Pythagoras, \(\cos(y) = \frac{\sqrt{1-x^2}}{1}\)</p>
            </div>
        </div>

        <!-- Slide 5: Arcsin Result -->
        <div class="slide slide-statement" data-slide="5" data-section="Arcsin" data-title="Arcsin Derivative">
            <div class="slide-content">
                <div class="result-box">
                    <div class="formula">
                        \[\frac{d}{dx}[\arcsin(x)] = \frac{1}{\sqrt{1-x^2}}\]
                    </div>
                </div>
                <p style="margin-top: 2rem; font-size: 1.25rem; color: var(--text-secondary);">
                    Domain: \(-1 < x < 1\) (derivative undefined at endpoints)
                </p>
            </div>
        </div>

        <!-- Slide 6: Deriving Arctan -->
        <div class="slide slide-visual" data-slide="6" data-section="Arctan" data-title="Deriving d/dx[arctan]">
            <div class="slide-content">
                <h2>Deriving \(\frac{d}{dx}[\arctan(x)]\)</h2>
                <div class="derivation-box">
                    <div class="deriv-step">
                        <span class="num">1</span>
                        <span>Let \(y = \arctan(x)\), so \(\tan(y) = x\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">2</span>
                        <span>Differentiate: \(\sec^2(y) \cdot \frac{dy}{dx} = 1\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">3</span>
                        <span>Solve: \(\frac{dy}{dx} = \frac{1}{\sec^2(y)} = \cos^2(y)\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">4</span>
                        <span>Use \(\sec^2(y) = 1 + \tan^2(y) = 1 + x^2\)</span>
                    </div>
                    <div class="deriv-step">
                        <span class="num">5</span>
                        <span style="color: var(--success);">\(\frac{dy}{dx} = \frac{1}{1+x^2}\)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 7: Arctan Result -->
        <div class="slide slide-statement" data-slide="7" data-section="Arctan" data-title="Arctan Derivative">
            <div class="slide-content">
                <div class="result-box">
                    <div class="formula">
                        \[\frac{d}{dx}[\arctan(x)] = \frac{1}{1+x^2}\]
                    </div>
                </div>
                <p style="margin-top: 2rem; font-size: 1.25rem; color: var(--text-secondary);">
                    Domain: all real numbers (nicely behaved!)
                </p>
            </div>
        </div>

        <!-- Slide 8: The Three Key Formulas -->
        <div class="slide slide-visual" data-slide="8" data-section="Summary" data-title="Key Formulas">
            <div class="slide-content">
                <h2>The Three Key Formulas</h2>
                <div class="formula-grid">
                    <div class="formula-card">
                        <div class="function">\(\arcsin(x)\)</div>
                        <div class="derivative">\(\frac{d}{dx} = \frac{1}{\sqrt{1-x^2}}\)</div>
                    </div>
                    <div class="formula-card" style="border-color: #ef4444;">
                        <div class="function" style="color: #ef4444;">\(\arccos(x)\)</div>
                        <div class="derivative">\(\frac{d}{dx} = \frac{-1}{\sqrt{1-x^2}}\)</div>
                    </div>
                    <div class="formula-card" style="border-color: #22c55e;">
                        <div class="function" style="color: #22c55e;">\(\arctan(x)\)</div>
                        <div class="derivative">\(\frac{d}{dx} = \frac{1}{1+x^2}\)</div>
                    </div>
                </div>
                <div class="memory-tip">
                    <span class="label">Memory Tip:</span> arccos is just arcsin with a negative sign. arctan is the "friendly" one - no square roots, no domain restrictions!
                </div>
            </div>
        </div>

        <!-- Slide 9: Visualization -->
        <div class="slide slide-visual" data-slide="9" data-section="Summary" data-title="Graphs">
            <div class="slide-content">
                <h2>Visualizing the Derivatives</h2>
                <div id="all-inverse-viz" class="visualization"></div>
                <p class="caption">Notice how the arctan derivative approaches 0 as x gets large</p>
            </div>
        </div>

        <!-- Slide 10: Chain Rule Example 1 -->
        <div class="slide slide-visual" data-slide="10" data-section="Examples" data-title="Example 1">
            <div class="slide-content">
                <h2>Example 1: Chain Rule</h2>
                <div class="example-solution">
                    <div class="problem">Find \(\frac{d}{dx}[\arcsin(2x)]\)</div>
                    <div class="work">
                        \[\frac{d}{dx}[\arcsin(2x)] = \frac{1}{\sqrt{1-(2x)^2}} \cdot \frac{d}{dx}[2x]\]
                        \[= \frac{1}{\sqrt{1-4x^2}} \cdot 2\]
                    </div>
                    <div class="answer">\(= \frac{2}{\sqrt{1-4x^2}}\)</div>
                </div>
            </div>
        </div>

        <!-- Slide 11: Chain Rule Example 2 -->
        <div class="slide slide-visual" data-slide="11" data-section="Examples" data-title="Example 2">
            <div class="slide-content">
                <h2>Example 2: Chain Rule</h2>
                <div class="example-solution">
                    <div class="problem">Find \(\frac{d}{dx}[\arctan(x^2)]\)</div>
                    <div class="work">
                        \[\frac{d}{dx}[\arctan(x^2)] = \frac{1}{1+(x^2)^2} \cdot \frac{d}{dx}[x^2]\]
                        \[= \frac{1}{1+x^4} \cdot 2x\]
                    </div>
                    <div class="answer">\(= \frac{2x}{1+x^4}\)</div>
                </div>
            </div>
        </div>

        <!-- Slide 12: Product Rule Example -->
        <div class="slide slide-visual" data-slide="12" data-section="Examples" data-title="Example 3">
            <div class="slide-content">
                <h2>Example 3: Product Rule</h2>
                <div class="example-solution">
                    <div class="problem">Find \(\frac{d}{dx}[x \cdot \arctan(x)]\)</div>
                    <div class="work">
                        Using product rule: \(\frac{d}{dx}[uv] = u'v + uv'\)
                        \[= (1) \cdot \arctan(x) + x \cdot \frac{1}{1+x^2}\]
                    </div>
                    <div class="answer">\(= \arctan(x) + \frac{x}{1+x^2}\)</div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Practice Problems -->
        <div class="slide slide-visual" data-slide="13" data-section="Practice" data-title="Practice">
            <div class="slide-content">
                <h2>Practice Problems</h2>
                <div class="practice-list">
                    <div class="practice-item">
                        <span class="num">1</span>
                        <span>\(\frac{d}{dx}[\arcsin(3x)]\)</span>
                    </div>
                    <div class="practice-item">
                        <span class="num">2</span>
                        <span>\(\frac{d}{dx}[\arctan(\sqrt{x})]\)</span>
                    </div>
                    <div class="practice-item">
                        <span class="num">3</span>
                        <span>\(\frac{d}{dx}[\arccos(e^x)]\)</span>
                    </div>
                    <div class="practice-item">
                        <span class="num">4</span>
                        <span>\(\frac{d}{dx}[x^2 \arcsin(x)]\)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 14: Solutions -->
        <div class="slide slide-list" data-slide="14" data-section="Practice" data-title="Solutions">
            <div class="slide-content">
                <h2>Solutions</h2>
                <ul>
                    <li>\(\frac{3}{\sqrt{1-9x^2}}\)</li>
                    <li>\(\frac{1}{1+x} \cdot \frac{1}{2\sqrt{x}} = \frac{1}{2\sqrt{x}(1+x)}\)</li>
                    <li>\(\frac{-e^x}{\sqrt{1-e^{2x}}}\)</li>
                    <li>\(2x\arcsin(x) + \frac{x^2}{\sqrt{1-x^2}}\)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="15" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p>Find the derivative:</p>
                    <p style="font-size: 2.5rem; margin-top: 1.5rem; color: var(--accent-secondary);">
                        \(\frac{d}{dx}[\arctan(2x)]\)
                    </p>
                </div>
            </div>
        </div>

        <!-- Slide 16: Coming Up -->
        <div class="slide slide-statement" data-slide="16" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement" style="font-size: 2.5rem;">Tomorrow: <em>Higher-Order Derivatives</em></p>
                <p style="margin-top: 1.5rem; font-size: 1.5rem; color: var(--text-secondary);">
                    Plus: Unit 3 Review and selecting differentiation procedures
                </p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 17</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>←</kbd> <kbd>→</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlays -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 17: Inverse Trig Derivatives</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">← Back to Course Syllabus</a>
            </div>
        </div>
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">← Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next →</button>
            </div>
        </div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // ===== Arcsin Graph Visualization =====
        function drawArcsinGraph() {
            const container = document.getElementById('arcsin-graph-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 550;
            const height = 350;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const xScale = d3.scaleLinear().domain([-1.5, 1.5]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-2, 2]).range([plotHeight, 0]);

            // Grid
            [-1, 0, 1].forEach(v => {
                g.append('line')
                    .attr('x1', xScale(v)).attr('x2', xScale(v))
                    .attr('y1', 0).attr('y2', plotHeight)
                    .attr('stroke', '#1c2640');
            });

            [-Math.PI/2, 0, Math.PI/2].forEach(v => {
                g.append('line')
                    .attr('x1', 0).attr('x2', plotWidth)
                    .attr('y1', yScale(v)).attr('y2', yScale(v))
                    .attr('stroke', '#1c2640');
            });

            // Axes
            g.append('line')
                .attr('x1', 0).attr('x2', plotWidth)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4a5568').attr('stroke-width', 2);
            g.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', 0).attr('y2', plotHeight)
                .attr('stroke', '#4a5568').attr('stroke-width', 2);

            // arcsin curve
            const arcsinPoints = [];
            for (let x = -0.999; x <= 0.999; x += 0.01) {
                arcsinPoints.push({ x: x, y: Math.asin(x) });
            }

            g.append('path')
                .datum(arcsinPoints)
                .attr('fill', 'none')
                .attr('stroke', '#8b5cf6')
                .attr('stroke-width', 3)
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

            // Domain endpoints
            g.append('circle')
                .attr('cx', xScale(-1)).attr('cy', yScale(-Math.PI/2))
                .attr('r', 6).attr('fill', '#8b5cf6');
            g.append('circle')
                .attr('cx', xScale(1)).attr('cy', yScale(Math.PI/2))
                .attr('r', 6).attr('fill', '#8b5cf6');

            // Labels
            g.append('text')
                .attr('x', xScale(1.1)).attr('y', yScale(Math.PI/2))
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('π/2');
            g.append('text')
                .attr('x', xScale(1.1)).attr('y', yScale(-Math.PI/2))
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('-π/2');

            g.append('text')
                .attr('x', xScale(0.5)).attr('y', yScale(1.2))
                .attr('font-size', '1.25rem').attr('fill', '#8b5cf6')
                .text('y = arcsin(x)');
        }

        // ===== Triangle Visualization =====
        function drawTriangle() {
            const container = document.getElementById('triangle-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 400;
            const height = 300;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const cx = width / 2;
            const cy = height / 2 + 30;
            const baseLen = 200;
            const heightLen = 150;

            // Triangle vertices
            const A = { x: cx - baseLen/2, y: cy };
            const B = { x: cx + baseLen/2, y: cy };
            const C = { x: cx - baseLen/2, y: cy - heightLen };

            // Draw triangle
            svg.append('polygon')
                .attr('points', `${A.x},${A.y} ${B.x},${B.y} ${C.x},${C.y}`)
                .attr('fill', 'none')
                .attr('stroke', '#8b5cf6')
                .attr('stroke-width', 3);

            // Right angle marker
            const markerSize = 15;
            svg.append('path')
                .attr('d', `M${A.x + markerSize},${A.y} L${A.x + markerSize},${A.y - markerSize} L${A.x},${A.y - markerSize}`)
                .attr('fill', 'none')
                .attr('stroke', '#6b7a94')
                .attr('stroke-width', 2);

            // Arc for angle y
            svg.append('path')
                .attr('d', `M${B.x - 40},${B.y} A 40 40 0 0 1 ${B.x - 28},${B.y - 28}`)
                .attr('fill', 'none')
                .attr('stroke', '#d4a028')
                .attr('stroke-width', 2);

            // Labels
            svg.append('text')
                .attr('x', B.x - 50).attr('y', B.y - 10)
                .attr('font-size', '1.25rem').attr('fill', '#d4a028')
                .text('y');

            // Side labels
            svg.append('text')
                .attr('x', (A.x + C.x)/2 - 40).attr('y', (A.y + C.y)/2)
                .attr('font-size', '1.25rem').attr('fill', '#f97316')
                .text('x (opp)');

            svg.append('text')
                .attr('x', (A.x + B.x)/2 - 10).attr('y', A.y + 25)
                .attr('font-size', '1.25rem').attr('fill', '#22c55e')
                .text('√(1-x²)');

            svg.append('text')
                .attr('x', (B.x + C.x)/2 + 10).attr('y', (B.y + C.y)/2)
                .attr('font-size', '1.25rem').attr('fill', '#60a5fa')
                .text('1 (hyp)');

            // sin(y) = x/1, cos(y) = sqrt(1-x²)/1
            svg.append('text')
                .attr('x', 20).attr('y', 30)
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('sin(y) = x');

            svg.append('text')
                .attr('x', 20).attr('y', 55)
                .attr('font-size', '1rem').attr('fill', '#b8c4d6')
                .text('cos(y) = √(1-x²)');
        }

        // ===== All Inverse Trig Visualization =====
        function drawAllInverse() {
            const container = document.getElementById('all-inverse-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 350;
            const margin = { top: 30, right: 100, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const xScale = d3.scaleLinear().domain([-3, 3]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-2, 2]).range([plotHeight, 0]);

            // Grid and axes
            g.append('line')
                .attr('x1', 0).attr('x2', plotWidth)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4a5568').attr('stroke-width', 1);
            g.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', 0).attr('y2', plotHeight)
                .attr('stroke', '#4a5568').attr('stroke-width', 1);

            // arctan(x)
            const arctanPoints = [];
            for (let x = -3; x <= 3; x += 0.05) {
                arctanPoints.push({ x: x, y: Math.atan(x) });
            }

            g.append('path')
                .datum(arctanPoints)
                .attr('fill', 'none')
                .attr('stroke', '#22c55e')
                .attr('stroke-width', 3)
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

            // d/dx[arctan(x)] = 1/(1+x²)
            const arctanDerivPoints = [];
            for (let x = -3; x <= 3; x += 0.05) {
                arctanDerivPoints.push({ x: x, y: 1 / (1 + x * x) });
            }

            g.append('path')
                .datum(arctanDerivPoints)
                .attr('fill', 'none')
                .attr('stroke', '#f97316')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4')
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

            // Asymptotes for arctan
            g.append('line')
                .attr('x1', 0).attr('x2', plotWidth)
                .attr('y1', yScale(Math.PI/2)).attr('y2', yScale(Math.PI/2))
                .attr('stroke', '#22c55e').attr('stroke-width', 1).attr('stroke-dasharray', '4,4').attr('opacity', 0.5);
            g.append('line')
                .attr('x1', 0).attr('x2', plotWidth)
                .attr('y1', yScale(-Math.PI/2)).attr('y2', yScale(-Math.PI/2))
                .attr('stroke', '#22c55e').attr('stroke-width', 1).attr('stroke-dasharray', '4,4').attr('opacity', 0.5);

            // Legend
            const legendY = 20;
            svg.append('line')
                .attr('x1', width - 90).attr('x2', width - 60)
                .attr('y1', legendY).attr('y2', legendY)
                .attr('stroke', '#22c55e').attr('stroke-width', 3);
            svg.append('text')
                .attr('x', width - 55).attr('y', legendY + 5)
                .attr('font-size', '1rem').attr('fill', '#22c55e')
                .text('arctan');

            svg.append('line')
                .attr('x1', width - 90).attr('x2', width - 60)
                .attr('y1', legendY + 25).attr('y2', legendY + 25)
                .attr('stroke', '#f97316').attr('stroke-width', 2).attr('stroke-dasharray', '8,4');
            svg.append('text')
                .attr('x', width - 55).attr('y', legendY + 30)
                .attr('font-size', '1rem').attr('fill', '#f97316')
                .text("arctan'");
        }

        // ===== Trigger Visualizations =====
        const visualizationSlides = {
            2: drawArcsinGraph,
            4: drawTriangle,
            9: drawAllInverse
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;

            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        setInterval(checkAndDrawVisualization, 200);
        window.addEventListener('hashchange', () => setTimeout(checkAndDrawVisualization, 100));

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => setTimeout(checkAndDrawVisualization, 200));
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }
    </script>
</body>
</html>
