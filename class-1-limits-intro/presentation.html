<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 1: Defining Limits | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --theme-color: #356093;
            --theme-color-light: #4a7ab8;
        }

        /* Definition box styling */
        .definition-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--theme-color);
            padding: 2rem;
            border-radius: 0 12px 12px 0;
            margin: 1.5rem auto;
            max-width: 800px;
            text-align: left;
        }

        .definition-box .label {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--theme-color);
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .definition-box .content {
            font-size: 1.5rem;
            line-height: 1.6;
        }

        /* Theorem box */
        .theorem-box {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-secondary);
            padding: 2rem;
            border-radius: 12px;
            margin: 1.5rem auto;
            max-width: 800px;
        }

        .theorem-box .label {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--accent-secondary);
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        /* Notation breakdown */
        .notation-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .notation-main {
            font-size: 3rem;
            font-family: var(--font-mono);
        }

        .notation-labels {
            display: flex;
            gap: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .notation-label {
            text-align: center;
        }

        .notation-label .symbol {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--accent-secondary);
        }

        .notation-label .meaning {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* Three scenarios grid */
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            max-width: 1000px;
            margin: 2rem auto;
        }

        .scenario-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .scenario-card h4 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .scenario-card .graph {
            height: 150px;
            margin-bottom: 1rem;
        }

        .scenario-card.success { border-top: 4px solid var(--success); }
        .scenario-card.warning { border-top: 4px solid var(--warning); }
        .scenario-card.danger { border-top: 4px solid var(--danger); }

        /* Piecewise display */
        .piecewise-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3rem;
            margin: 2rem 0;
        }

        .piecewise-function {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            font-family: var(--font-mono);
            font-size: 1.25rem;
        }

        .piecewise-graph {
            width: 400px;
            height: 300px;
        }

        /* MathJax styling */
        .MathJax {
            font-size: 1.2em !important;
        }

        /* Slider for limit explorer */
        .limit-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .limit-controls label {
            font-size: 1.25rem;
            font-family: var(--font-display);
        }

        .limit-controls button {
            background: var(--theme-color);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-family: var(--font-display);
            font-size: 1rem;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .limit-controls button:hover {
            background: var(--theme-color-light);
        }

        .limit-value-display {
            font-family: var(--font-mono);
            font-size: 1.25rem;
            min-width: 200px;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Defining Limits">
            <div class="slide-content">
                <div class="unit-badge">Unit 1: Limits and Continuity</div>
                <h1>Defining Limits</h1>
                <p class="subtitle">The Language of Calculus</p>
                <p class="meta">Class 1 | February 3, 2026 | CED 1.2</p>
            </div>
        </div>

        <!-- Slide 1: Yesterday's Question -->
        <div class="slide slide-statement" data-slide="1" data-section="Opening" data-title="Yesterday's Question">
            <div class="slide-content">
                <p class="statement" style="font-size: 2.5rem;">Yesterday we asked: How do we make sense of <em>instantaneous</em> change?</p>
                <p class="statement" style="font-size: 2rem; margin-top: 2rem; color: var(--text-secondary);">Today: The notation that makes it precise.</p>
            </div>
        </div>

        <!-- Slide 2: The Word Limit -->
        <div class="slide slide-two-part" data-slide="2" data-section="Opening" data-title="The Word Limit">
            <div class="slide-content">
                <p class="primary">What does "limit" mean in everyday language?</p>
                <p class="secondary" style="margin-top: 2rem;">A boundary that cannot be crossed...</p>
                <p class="secondary">Something you approach but don't necessarily reach.</p>
            </div>
        </div>

        <!-- Slide 3: The Informal Definition -->
        <div class="slide slide-visual" data-slide="3" data-section="The Definition" data-title="Informal Definition">
            <div class="slide-content">
                <h2>The Informal Definition</h2>
                <div class="definition-box">
                    <div class="label">Definition</div>
                    <div class="content">
                        <p>As <em>x</em> gets closer and closer to <em>a</em> (but not equal to <em>a</em>),<br>
                        <em>f(x)</em> gets closer and closer to <em>L</em>.</p>
                    </div>
                </div>
                <p class="caption" style="margin-top: 2rem;">We never actually reach x = a. We only approach it.</p>
            </div>
        </div>

        <!-- Slide 4: The Notation -->
        <div class="slide slide-visual" data-slide="4" data-section="The Definition" data-title="Limit Notation">
            <div class="slide-content">
                <h2>Limit Notation</h2>
                <div class="notation-display">
                    <div class="notation-main">
                        \[\lim_{x \to a} f(x) = L\]
                    </div>
                    <div class="notation-labels">
                        <div class="notation-label">
                            <div class="symbol">lim</div>
                            <div class="meaning">"the limit of"</div>
                        </div>
                        <div class="notation-label">
                            <div class="symbol">x → a</div>
                            <div class="meaning">"as x approaches a"</div>
                        </div>
                        <div class="notation-label">
                            <div class="symbol">f(x)</div>
                            <div class="meaning">"the function value"</div>
                        </div>
                        <div class="notation-label">
                            <div class="symbol">= L</div>
                            <div class="meaning">"equals L"</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5: Interactive Limit Explorer -->
        <div class="slide slide-visual" data-slide="5" data-section="The Definition" data-title="Limit Explorer">
            <div class="slide-content">
                <h2>Exploring: \(\lim_{x \to 2} \frac{x^2 - 4}{x - 2}\)</h2>
                <div id="limit-explorer-viz" class="visualization"></div>
                <div class="limit-controls">
                    <button id="approach-left">Approach from Left</button>
                    <button id="approach-right">Approach from Right</button>
                    <button id="reset-explorer">Reset</button>
                    <div class="limit-value-display">
                        <span id="x-display">x = 1.00</span> |
                        <span id="fx-display">f(x) = 3.00</span>
                    </div>
                </div>
                <p class="caption">What value does f(x) approach as x approaches 2?</p>
            </div>
        </div>

        <!-- Slide 6: Limit vs Value -->
        <div class="slide slide-comparison" data-slide="6" data-section="The Definition" data-title="Limit vs Value">
            <div class="slide-content">
                <h2>The Crucial Distinction</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">\(\lim_{x \to a} f(x)\)</h3>
                        <p style="font-size: 1.5rem; margin-top: 1rem;">Where f(x) is <em>heading</em></p>
                        <p style="color: var(--text-secondary); margin-top: 1rem;">The value we approach</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--accent-secondary);">f(a)</h3>
                        <p style="font-size: 1.5rem; margin-top: 1rem;">The <em>actual</em> value at a</p>
                        <p style="color: var(--text-secondary); margin-top: 1rem;">What we get when we plug in</p>
                    </div>
                </div>
                <p class="caption" style="margin-top: 2rem;">These can be equal, different, or f(a) might not even exist!</p>
            </div>
        </div>

        <!-- Slide 7: Three Scenarios -->
        <div class="slide slide-visual" data-slide="7" data-section="The Definition" data-title="Three Scenarios">
            <div class="slide-content">
                <h2>Three Scenarios</h2>
                <div id="scenarios-viz" class="visualization"></div>
            </div>
        </div>

        <!-- Slide 8: Example 1 - Nice Behavior -->
        <div class="slide slide-visual" data-slide="8" data-section="Examples" data-title="Example 1">
            <div class="slide-content">
                <h2>Example 1: Nice Behavior</h2>
                <p style="font-size: 1.5rem; margin-bottom: 1.5rem;">Find \(\lim_{x \to 3} x^2\)</p>
                <div id="example1-viz" class="visualization" style="height: 300px;"></div>
                <div class="definition-box" style="margin-top: 1.5rem;">
                    <div class="content">
                        <p>As x → 3, x² → <span style="color: var(--success);">9</span></p>
                        <p style="margin-top: 0.5rem;">And f(3) = 9 ✓</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Example 2 - Hole in Graph -->
        <div class="slide slide-visual" data-slide="9" data-section="Examples" data-title="Example 2">
            <div class="slide-content">
                <h2>Example 2: Hole in the Graph</h2>
                <p style="font-size: 1.5rem; margin-bottom: 1rem;">Find \(\lim_{x \to 2} \frac{x^2 - 4}{x - 2}\)</p>
                <p style="color: var(--danger); margin-bottom: 1.5rem;">Note: f(2) is undefined (0/0)</p>
                <div id="example2-viz" class="visualization" style="height: 250px;"></div>
                <div class="definition-box" style="margin-top: 1.5rem;">
                    <div class="content">
                        <p>Simplify: \(\frac{(x-2)(x+2)}{x-2} = x + 2\) (when x ≠ 2)</p>
                        <p style="margin-top: 0.5rem; color: var(--success);">So \(\lim_{x \to 2} = 4\), even though f(2) doesn't exist!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: Example 3 - Limit DNE -->
        <div class="slide slide-visual" data-slide="10" data-section="Examples" data-title="Limit DNE">
            <div class="slide-content">
                <h2>When Limits Don't Exist</h2>
                <p style="font-size: 1.5rem; margin-bottom: 1.5rem;">Consider f(x) = 1/x near x = 0</p>
                <div id="example3-viz" class="visualization" style="height: 300px;"></div>
                <p class="caption">Different behavior from left and right → limit does not exist</p>
            </div>
        </div>

        <!-- Slide 11: One-Sided Limits -->
        <div class="slide slide-two-part" data-slide="11" data-section="Examples" data-title="One-Sided Limits">
            <div class="slide-content">
                <p class="primary" style="color: var(--theme-color);">One-Sided Limits</p>
                <div style="display: flex; gap: 4rem; justify-content: center; margin-top: 2rem;">
                    <div>
                        <p style="font-size: 2rem;">\(\lim_{x \to a^+} f(x)\)</p>
                        <p style="color: var(--text-secondary); margin-top: 0.5rem;">Right-hand limit</p>
                        <p style="color: var(--text-tertiary); font-size: 1.25rem;">(approaching from larger values)</p>
                    </div>
                    <div>
                        <p style="font-size: 2rem;">\(\lim_{x \to a^-} f(x)\)</p>
                        <p style="color: var(--text-secondary); margin-top: 0.5rem;">Left-hand limit</p>
                        <p style="color: var(--text-tertiary); font-size: 1.25rem;">(approaching from smaller values)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 12: Two-Sided Limit Theorem -->
        <div class="slide slide-visual" data-slide="12" data-section="Examples" data-title="Two-Sided Theorem">
            <div class="slide-content">
                <h2>The Two-Sided Limit Theorem</h2>
                <div class="theorem-box">
                    <div class="label">Theorem</div>
                    <div class="content" style="text-align: center;">
                        <p style="font-size: 1.5rem;">\(\lim_{x \to a} f(x) = L\) exists if and only if:</p>
                        <p style="font-size: 1.75rem; margin-top: 1rem; color: var(--accent-secondary);">
                            \(\lim_{x \to a^-} f(x) = L\) AND \(\lim_{x \to a^+} f(x) = L\)
                        </p>
                    </div>
                </div>
                <p class="caption" style="margin-top: 2rem;">Both one-sided limits must exist <em>and</em> be equal.</p>
            </div>
        </div>

        <!-- Slide 13: Piecewise Function -->
        <div class="slide slide-visual" data-slide="13" data-section="Piecewise Example" data-title="Piecewise Function">
            <div class="slide-content">
                <h2>Example: Piecewise Function</h2>
                <div class="piecewise-container">
                    <div class="piecewise-function">
                        \[f(x) = \begin{cases} x + 1 & \text{if } x < 2 \\ 5 & \text{if } x = 2 \\ 3 - x & \text{if } x > 2 \end{cases}\]
                    </div>
                    <div id="piecewise-viz" class="piecewise-graph"></div>
                </div>
            </div>
        </div>

        <!-- Slide 14: Analyzing the Limit -->
        <div class="slide slide-list" data-slide="14" data-section="Piecewise Example" data-title="Analyzing the Limit">
            <div class="slide-content">
                <h2>Finding \(\lim_{x \to 2} f(x)\)</h2>
                <ul>
                    <li><strong>From the left:</strong> \(\lim_{x \to 2^-} f(x) = 2 + 1 = 3\)</li>
                    <li><strong>From the right:</strong> \(\lim_{x \to 2^+} f(x) = 3 - 2 = 1\)</li>
                    <li style="color: var(--danger);"><strong>Left ≠ Right</strong>, so \(\lim_{x \to 2} f(x)\) does NOT exist</li>
                    <li style="color: var(--text-tertiary);">Note: f(2) = 5, but that's irrelevant to the limit!</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: Key Insight -->
        <div class="slide slide-statement" data-slide="15" data-section="Piecewise Example" data-title="Key Insight">
            <div class="slide-content">
                <p class="statement">The limit is about where f(x) is <em>heading</em>, not where it <em>lands</em>.</p>
            </div>
        </div>

        <!-- Slide 16: Practice -->
        <div class="slide slide-exercise" data-slide="16" data-section="Practice" data-title="Practice">
            <div class="slide-content">
                <h2>Practice: Limits from Graphs</h2>
                <div class="prompt">
                    <p>For each graph provided, determine:</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; max-width: 600px; margin: 1.5rem auto 0; text-align: left;">
                    <div style="font-size: 1.25rem;">• \(\lim_{x \to a^-} f(x)\)</div>
                    <div style="font-size: 1.25rem;">• \(\lim_{x \to a^+} f(x)\)</div>
                    <div style="font-size: 1.25rem;">• \(\lim_{x \to a} f(x)\)</div>
                    <div style="font-size: 1.25rem;">• \(f(a)\)</div>
                </div>
                <p style="margin-top: 2rem; color: var(--accent-secondary); font-size: 1.25rem;">Work with a partner for 8 minutes</p>
            </div>
        </div>

        <!-- Slide 17: Summary -->
        <div class="slide slide-list" data-slide="17" data-section="Closing" data-title="Summary">
            <div class="slide-content">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>\(\lim_{x \to a} f(x) = L\) means f(x) approaches L as x approaches a</li>
                    <li>The limit and the function value <em>can be different</em></li>
                    <li>For the two-sided limit to exist, <em>both</em> one-sided limits must agree</li>
                    <li>If left ≠ right, the limit <strong>does not exist</strong></li>
                </ul>
            </div>
        </div>

        <!-- Slide 18: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="18" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p>Write in limit notation:</p>
                    <p style="margin-top: 1.5rem; font-size: 1.75rem; color: var(--accent-secondary);">
                        "As x approaches 5, the value of g(x) approaches 12."
                    </p>
                </div>
            </div>
        </div>

        <!-- Slide 19: Coming Up -->
        <div class="slide slide-statement" data-slide="19" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement" style="font-size: 2.5rem;">Tomorrow: Finding limits from <em>graphs</em> and <em>tables</em></p>
                <p class="statement" style="font-size: 1.75rem; color: var(--text-secondary); margin-top: 1.5rem;">The graphical and numerical perspectives (G and N of G.N.A.W.)</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 20</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>←</kbd> <kbd>→</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 1: Defining Limits</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">← Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">← Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next →</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // ===== Limit Explorer Visualization =====
        function drawLimitExplorer() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawLimitExplorer, 100);
                return;
            }

            const container = document.getElementById('limit-explorer-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 350;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Function: f(x) = (x² - 4)/(x - 2) = x + 2 for x ≠ 2
            const f = x => x + 2;
            const xScale = d3.scaleLinear().domain([-1, 5]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([0, 8]).range([plotHeight, 0]);

            // Grid
            g.selectAll('line.gridH')
                .data(d3.range(0, 9, 1))
                .enter()
                .append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', d => yScale(d))
                .attr('y2', d => yScale(d))
                .attr('stroke', '#1c2640')
                .attr('stroke-width', 1);

            g.selectAll('line.gridV')
                .data(d3.range(-1, 6, 1))
                .enter()
                .append('line')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', '#1c2640')
                .attr('stroke-width', 1);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotHeight})`)
                .call(d3.axisBottom(xScale).ticks(6))
                .selectAll('text')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6');

            g.append('g')
                .call(d3.axisLeft(yScale).ticks(8))
                .selectAll('text')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6');

            // Draw line (y = x + 2)
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)));

            // Left segment (x < 2)
            g.append('path')
                .datum(d3.range(-1, 1.95, 0.05))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Right segment (x > 2)
            g.append('path')
                .datum(d3.range(2.05, 5.1, 0.05))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Hole at x = 2
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(4))
                .attr('r', 8)
                .attr('fill', 'var(--bg-primary)')
                .attr('stroke', '#ef4444')
                .attr('stroke-width', 3);

            // Limit indicator line
            g.append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', yScale(4))
                .attr('y2', yScale(4))
                .attr('stroke', '#22c55e')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4')
                .attr('opacity', 0.5);

            // Label
            g.append('text')
                .attr('x', plotWidth - 10)
                .attr('y', yScale(4) - 10)
                .attr('text-anchor', 'end')
                .attr('font-size', '1.25rem')
                .attr('fill', '#22c55e')
                .text('L = 4');

            // Moving point
            let currentX = 0;
            const point = g.append('circle')
                .attr('r', 10)
                .attr('fill', '#f97316')
                .attr('cx', xScale(currentX))
                .attr('cy', yScale(f(currentX)));

            // Vertical line from point to x-axis
            const vertLine = g.append('line')
                .attr('x1', xScale(currentX))
                .attr('x2', xScale(currentX))
                .attr('y1', yScale(f(currentX)))
                .attr('y2', plotHeight)
                .attr('stroke', '#f97316')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,2')
                .attr('opacity', 0.5);

            // Horizontal line from point to y-axis
            const horzLine = g.append('line')
                .attr('x1', 0)
                .attr('x2', xScale(currentX))
                .attr('y1', yScale(f(currentX)))
                .attr('y2', yScale(f(currentX)))
                .attr('stroke', '#f97316')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,2')
                .attr('opacity', 0.5);

            function updatePoint(x) {
                currentX = x;
                const y = f(x);
                point.attr('cx', xScale(x)).attr('cy', yScale(y));
                vertLine.attr('x1', xScale(x)).attr('x2', xScale(x)).attr('y1', yScale(y));
                horzLine.attr('x2', xScale(x)).attr('y1', yScale(y)).attr('y2', yScale(y));
                document.getElementById('x-display').textContent = `x = ${x.toFixed(3)}`;
                document.getElementById('fx-display').textContent = `f(x) = ${y.toFixed(3)}`;
            }

            // Animation functions
            let animating = false;
            function animateApproach(fromLeft) {
                if (animating) return;
                animating = true;
                const startX = fromLeft ? 0 : 4;
                const endX = fromLeft ? 1.99 : 2.01;
                let x = startX;
                const step = fromLeft ? 0.02 : -0.02;

                function animate() {
                    if ((fromLeft && x < endX) || (!fromLeft && x > endX)) {
                        x += step;
                        // Slow down as we approach 2
                        const distTo2 = Math.abs(x - 2);
                        const delay = Math.max(20, 100 - distTo2 * 50);
                        updatePoint(x);
                        setTimeout(animate, delay);
                    } else {
                        animating = false;
                    }
                }
                animate();
            }

            // Button handlers
            document.getElementById('approach-left').addEventListener('click', () => animateApproach(true));
            document.getElementById('approach-right').addEventListener('click', () => animateApproach(false));
            document.getElementById('reset-explorer').addEventListener('click', () => {
                animating = false;
                updatePoint(0);
            });

            updatePoint(0);
        }

        // ===== Three Scenarios Visualization =====
        function drawScenarios() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawScenarios, 100);
                return;
            }

            const container = document.getElementById('scenarios-viz');
            if (!container || container.querySelector('svg')) return;

            const scenarios = [
                { title: 'Continuous', subtitle: 'Limit = Value', color: '#22c55e' },
                { title: 'Hole', subtitle: 'Limit exists, value doesn\'t', color: '#f59e0b' },
                { title: 'Jump', subtitle: 'Limit doesn\'t exist', color: '#ef4444' }
            ];

            const totalWidth = 900;
            const graphWidth = 260;
            const graphHeight = 200;
            const gap = 30;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${totalWidth} ${graphHeight + 80}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            scenarios.forEach((scenario, i) => {
                const startX = i * (graphWidth + gap) + (totalWidth - 3 * graphWidth - 2 * gap) / 2;
                const g = svg.append('g')
                    .attr('transform', `translate(${startX}, 0)`);

                // Background
                g.append('rect')
                    .attr('width', graphWidth)
                    .attr('height', graphHeight)
                    .attr('fill', 'var(--bg-secondary)')
                    .attr('rx', 8);

                // Border
                g.append('line')
                    .attr('x1', 0)
                    .attr('x2', graphWidth)
                    .attr('y1', 0)
                    .attr('y2', 0)
                    .attr('stroke', scenario.color)
                    .attr('stroke-width', 4);

                const plotMargin = 30;
                const plotWidth = graphWidth - 2 * plotMargin;
                const plotHeight = graphHeight - 2 * plotMargin - 20;
                const plotG = g.append('g')
                    .attr('transform', `translate(${plotMargin}, ${plotMargin})`);

                // Axes
                plotG.append('line')
                    .attr('x1', 0).attr('x2', plotWidth)
                    .attr('y1', plotHeight).attr('y2', plotHeight)
                    .attr('stroke', '#4a5568');
                plotG.append('line')
                    .attr('x1', plotWidth/2).attr('x2', plotWidth/2)
                    .attr('y1', 0).attr('y2', plotHeight)
                    .attr('stroke', '#4a5568')
                    .attr('stroke-dasharray', '4,2');

                // Draw scenario-specific graph
                if (i === 0) { // Continuous
                    const path = d3.line()
                        .x(d => d * plotWidth)
                        .y(d => plotHeight - d * d * plotHeight)
                        .curve(d3.curveCatmullRom);
                    plotG.append('path')
                        .datum(d3.range(0, 1.05, 0.05))
                        .attr('d', path)
                        .attr('fill', 'none')
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 3);
                    plotG.append('circle')
                        .attr('cx', plotWidth/2)
                        .attr('cy', plotHeight - 0.25 * plotHeight)
                        .attr('r', 6)
                        .attr('fill', '#22c55e');
                } else if (i === 1) { // Hole
                    const path = d3.line()
                        .x(d => d * plotWidth)
                        .y(d => plotHeight * 0.7 - d * plotHeight * 0.4)
                        .curve(d3.curveLinear);
                    plotG.append('path')
                        .datum(d3.range(0, 0.48, 0.05))
                        .attr('d', path)
                        .attr('fill', 'none')
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 3);
                    plotG.append('path')
                        .datum(d3.range(0.52, 1.05, 0.05))
                        .attr('d', path)
                        .attr('fill', 'none')
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 3);
                    plotG.append('circle')
                        .attr('cx', plotWidth/2)
                        .attr('cy', plotHeight * 0.5)
                        .attr('r', 6)
                        .attr('fill', 'var(--bg-secondary)')
                        .attr('stroke', '#f59e0b')
                        .attr('stroke-width', 2);
                } else { // Jump
                    plotG.append('line')
                        .attr('x1', 0).attr('x2', plotWidth * 0.48)
                        .attr('y1', plotHeight * 0.7).attr('y2', plotHeight * 0.7)
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 3);
                    plotG.append('line')
                        .attr('x1', plotWidth * 0.52).attr('x2', plotWidth)
                        .attr('y1', plotHeight * 0.3).attr('y2', plotHeight * 0.3)
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 3);
                    plotG.append('circle')
                        .attr('cx', plotWidth/2)
                        .attr('cy', plotHeight * 0.7)
                        .attr('r', 6)
                        .attr('fill', 'var(--bg-secondary)')
                        .attr('stroke', '#60a5fa')
                        .attr('stroke-width', 2);
                    plotG.append('circle')
                        .attr('cx', plotWidth/2)
                        .attr('cy', plotHeight * 0.3)
                        .attr('r', 6)
                        .attr('fill', '#60a5fa');
                }

                // Title
                g.append('text')
                    .attr('x', graphWidth / 2)
                    .attr('y', graphHeight + 25)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1.25rem')
                    .attr('font-weight', '600')
                    .attr('fill', scenario.color)
                    .text(scenario.title);

                // Subtitle
                g.append('text')
                    .attr('x', graphWidth / 2)
                    .attr('y', graphHeight + 50)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1rem')
                    .attr('fill', '#b8c4d6')
                    .text(scenario.subtitle);
            });
        }

        // ===== Example 1 Visualization =====
        function drawExample1() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawExample1, 100);
                return;
            }

            const container = document.getElementById('example1-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 250;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const plotW = width - margin.left - margin.right;
            const plotH = height - margin.top - margin.bottom;
            const xScale = d3.scaleLinear().domain([0, 5]).range([0, plotW]);
            const yScale = d3.scaleLinear().domain([0, 16]).range([plotH, 0]);

            // Draw parabola
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(d * d))
                .curve(d3.curveCatmullRom);

            g.append('path')
                .datum(d3.range(0, 4.1, 0.1))
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Point at x = 3
            g.append('circle')
                .attr('cx', xScale(3))
                .attr('cy', yScale(9))
                .attr('r', 8)
                .attr('fill', '#22c55e');

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotH})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .selectAll('text').attr('font-size', '1rem');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(4))
                .selectAll('text').attr('font-size', '1rem');
        }

        // ===== Example 2 Visualization =====
        function drawExample2() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawExample2, 100);
                return;
            }

            const container = document.getElementById('example2-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 200;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const plotW = width - margin.left - margin.right;
            const plotH = height - margin.top - margin.bottom;
            const xScale = d3.scaleLinear().domain([0, 5]).range([0, plotW]);
            const yScale = d3.scaleLinear().domain([0, 8]).range([plotH, 0]);

            // Draw y = x + 2
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(d + 2));

            g.append('path')
                .datum(d3.range(0, 1.95, 0.05))
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            g.append('path')
                .datum(d3.range(2.05, 5.1, 0.05))
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Hole at x = 2
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(4))
                .attr('r', 8)
                .attr('fill', 'var(--bg-primary)')
                .attr('stroke', '#ef4444')
                .attr('stroke-width', 3);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotH})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .selectAll('text').attr('font-size', '1rem');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(4))
                .selectAll('text').attr('font-size', '1rem');
        }

        // ===== Example 3 Visualization (1/x) =====
        function drawExample3() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawExample3, 100);
                return;
            }

            const container = document.getElementById('example3-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 600;
            const height = 250;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const plotW = width - margin.left - margin.right;
            const plotH = height - margin.top - margin.bottom;
            const xScale = d3.scaleLinear().domain([-3, 3]).range([0, plotW]);
            const yScale = d3.scaleLinear().domain([-5, 5]).range([plotH, 0]);

            // Draw 1/x (positive side)
            const linePos = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(1/d))
                .defined(d => d > 0.1);

            g.append('path')
                .datum(d3.range(0.1, 3.1, 0.05))
                .attr('d', linePos)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Draw 1/x (negative side)
            const lineNeg = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(1/d))
                .defined(d => d < -0.1);

            g.append('path')
                .datum(d3.range(-3, -0.05, 0.05))
                .attr('d', lineNeg)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Asymptote at x = 0
            g.append('line')
                .attr('x1', xScale(0))
                .attr('x2', xScale(0))
                .attr('y1', 0)
                .attr('y2', plotH)
                .attr('stroke', '#ef4444')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4');

            // Arrow annotations
            g.append('text')
                .attr('x', xScale(0.3))
                .attr('y', yScale(4))
                .attr('text-anchor', 'start')
                .attr('font-size', '1.25rem')
                .attr('fill', '#22c55e')
                .text('→ +∞');

            g.append('text')
                .attr('x', xScale(-0.3))
                .attr('y', yScale(-4))
                .attr('text-anchor', 'end')
                .attr('font-size', '1.25rem')
                .attr('fill', '#ef4444')
                .text('→ -∞');

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotH/2})`)
                .call(d3.axisBottom(xScale).ticks(6))
                .selectAll('text').attr('font-size', '1rem');
            g.append('g')
                .attr('transform', `translate(${plotW/2},0)`)
                .call(d3.axisLeft(yScale).ticks(5))
                .selectAll('text').attr('font-size', '1rem');
        }

        // ===== Piecewise Function Visualization =====
        function drawPiecewise() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawPiecewise, 100);
                return;
            }

            const container = document.getElementById('piecewise-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 400;
            const height = 300;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const plotW = width - margin.left - margin.right;
            const plotH = height - margin.top - margin.bottom;
            const xScale = d3.scaleLinear().domain([0, 4]).range([0, plotW]);
            const yScale = d3.scaleLinear().domain([0, 6]).range([plotH, 0]);

            // x + 1 for x < 2
            const line1 = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(d + 1));

            g.append('path')
                .datum(d3.range(0, 1.95, 0.05))
                .attr('d', line1)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Open circle at (2, 3)
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(3))
                .attr('r', 6)
                .attr('fill', 'var(--bg-primary)')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 2);

            // 3 - x for x > 2
            const line2 = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(3 - d));

            g.append('path')
                .datum(d3.range(2.05, 3.5, 0.05))
                .attr('d', line2)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3);

            // Open circle at (2, 1)
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(1))
                .attr('r', 6)
                .attr('fill', 'var(--bg-primary)')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 2);

            // Filled point at (2, 5)
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(5))
                .attr('r', 8)
                .attr('fill', '#f97316');

            // Label for f(2) = 5
            g.append('text')
                .attr('x', xScale(2) + 15)
                .attr('y', yScale(5) + 5)
                .attr('font-size', '1rem')
                .attr('fill', '#f97316')
                .text('f(2) = 5');

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${plotH})`)
                .call(d3.axisBottom(xScale).ticks(4))
                .selectAll('text').attr('font-size', '1rem');
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(6))
                .selectAll('text').attr('font-size', '1rem');
        }

        // ===== Trigger Visualizations on Slide Entry =====
        const visualizationSlides = {
            5: drawLimitExplorer,
            7: drawScenarios,
            8: drawExample1,
            9: drawExample2,
            10: drawExample3,
            13: drawPiecewise
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;

            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        // Check periodically for slide changes
        setInterval(checkAndDrawVisualization, 200);

        // Also check on hash changes
        window.addEventListener('hashchange', () => {
            setTimeout(checkAndDrawVisualization, 100);
        });

        // Initial check after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkAndDrawVisualization, 200);
            });
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }

        // Ensure MathJax re-renders on slide change
        if (window.MathJax) {
            window.MathJax.startup = {
                ready: () => {
                    MathJax.startup.defaultReady();
                }
            };
        }
    </script>
</body>
</html>
