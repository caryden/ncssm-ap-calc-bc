<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Differentiation Rules | Class 12 | NCSSM</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --unit-color: #7c3aed;
        }
        .formula-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(124, 58, 237, 0.05));
            border: 2px solid var(--unit-color);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 1rem auto;
            max-width: 600px;
            text-align: center;
        }
        .formula-box .formula {
            font-size: 2rem;
            color: var(--unit-color);
            margin: 0.5rem 0;
        }
        .formula-box .note {
            font-size: 1.25rem;
            color: #64748b;
            margin-top: 0.5rem;
        }
        .example-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-width: 800px;
            margin: 1rem auto;
        }
        .example-item {
            background: rgba(124, 58, 237, 0.05);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
        }
        .step-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--unit-color);
            padding: 1rem 1.5rem;
            margin: 0.5rem auto;
            max-width: 700px;
            font-size: 1.5rem;
        }
        .warning-box {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 1rem auto;
            max-width: 600px;
            text-align: center;
        }
        .warning-box .title {
            color: #ef4444;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .conversion-table {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            max-width: 600px;
            margin: 1rem auto;
        }
        .conversion-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            background: rgba(124, 58, 237, 0.05);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1.4rem;
        }
        .conversion-item .arrow {
            color: var(--unit-color);
            font-weight: bold;
        }
        .rules-summary {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            max-width: 700px;
            margin: 1rem auto;
        }
        .rule-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(124, 58, 237, 0.05);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1.3rem;
        }
        .rule-item .rule-num {
            background: var(--unit-color);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .pattern-table {
            margin: 1rem auto;
            border-collapse: collapse;
            font-size: 1.4rem;
        }
        .pattern-table th, .pattern-table td {
            padding: 0.75rem 1.5rem;
            border: 1px solid #e2e8f0;
        }
        .pattern-table th {
            background: var(--unit-color);
            color: white;
        }
        .pattern-table tr:nth-child(even) {
            background: rgba(124, 58, 237, 0.05);
        }
        .pattern-table .mystery {
            color: var(--unit-color);
            font-weight: bold;
        }
        .viz-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        .viz-container svg {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="slide-container">
        <!-- Slide 0: Title -->
        <section class="slide slide-title">
            <div class="slide-badge" style="background: var(--unit-color);">Unit 2: Differentiation Fundamentals</div>
            <h1>Basic Differentiation Rules</h1>
            <p class="slide-subtitle">Shortcuts That Replace Limits</p>
            <div class="slide-meta">Class 12 | CED 2.5, 2.6 | NCSSM</div>
        </section>

        <!-- Slide 1: The Problem with Limits -->
        <section class="slide slide-visual">
            <h2>The Old Way</h2>
            <div style="text-align: center; margin: 1rem 0;">
                <p style="font-size: 1.5rem; color: #64748b;">Find using the limit definition:</p>
                <p style="font-size: 2rem; margin: 1rem 0;">$$\frac{d}{dx}[x^5]$$</p>
            </div>
            <div class="step-box" style="background: rgba(239, 68, 68, 0.05); border-color: #ef4444;">
                $$\lim_{h \to 0} \frac{(x+h)^5 - x^5}{h}$$
            </div>
            <p style="text-align: center; color: #ef4444; font-size: 1.4rem; margin-top: 1rem;">
                Expanding (x+h)^5 takes forever...
            </p>
            <p style="text-align: center; color: var(--unit-color); font-size: 1.5rem; font-weight: 600;">
                There must be a better way!
            </p>
        </section>

        <!-- Slide 2: The Pattern Emerges -->
        <section class="slide slide-visual">
            <h2>Do You See the Pattern?</h2>
            <table class="pattern-table">
                <tr>
                    <th>f(x)</th>
                    <th>f'(x)</th>
                </tr>
                <tr>
                    <td>x²</td>
                    <td>2x</td>
                </tr>
                <tr>
                    <td>x³</td>
                    <td>3x²</td>
                </tr>
                <tr>
                    <td>x⁴</td>
                    <td>4x³</td>
                </tr>
                <tr>
                    <td>x⁵</td>
                    <td class="mystery">?</td>
                </tr>
            </table>
            <p style="text-align: center; font-size: 1.5rem; color: var(--unit-color); margin-top: 1.5rem;">
                Multiply by the exponent, reduce the exponent by 1
            </p>
        </section>

        <!-- Slide 3: Constant Rule -->
        <section class="slide slide-visual">
            <h2>Rule 1: The Constant Rule</h2>
            <div class="formula-box">
                <div class="formula">$$\frac{d}{dx}[c] = 0$$</div>
                <div class="note">The derivative of any constant is zero</div>
            </div>
            <div class="viz-container" id="constant-rule-viz"></div>
            <p style="text-align: center; color: #64748b; font-size: 1.3rem;">
                A horizontal line has zero slope everywhere
            </p>
        </section>

        <!-- Slide 4: Constant Rule Examples -->
        <section class="slide slide-list">
            <h2>Constant Rule Examples</h2>
            <div class="example-grid">
                <div class="example-item">$$\frac{d}{dx}[7] = 0$$</div>
                <div class="example-item">$$\frac{d}{dx}[\pi] = 0$$</div>
                <div class="example-item">$$\frac{d}{dx}[-42] = 0$$</div>
                <div class="example-item">$$\frac{d}{dx}[\sqrt{2}] = 0$$</div>
            </div>
            <p style="text-align: center; color: var(--unit-color); font-size: 1.4rem; margin-top: 1.5rem;">
                Any number without an x is a constant!
            </p>
        </section>

        <!-- Slide 5: Power Rule -->
        <section class="slide slide-visual">
            <h2>Rule 2: The Power Rule</h2>
            <div class="formula-box">
                <div class="formula">$$\frac{d}{dx}[x^n] = n \cdot x^{n-1}$$</div>
                <div class="note">Works for ANY real number n</div>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="font-size: 1.5rem; color: var(--unit-color);">
                    <strong>Bring down</strong> the exponent, <strong>reduce</strong> by 1
                </p>
            </div>
        </section>

        <!-- Slide 6: Power Rule Visualization -->
        <section class="slide slide-visual">
            <h2>Seeing the Power Rule</h2>
            <div class="viz-container" id="power-rule-viz"></div>
            <p style="text-align: center; color: #64748b; font-size: 1.3rem;">
                The height on the right equals the slope on the left
            </p>
        </section>

        <!-- Slide 7: Power Rule Integer Examples -->
        <section class="slide slide-visual">
            <h2>Power Rule: Positive Integers</h2>
            <div class="example-grid">
                <div class="example-item">$$\frac{d}{dx}[x^2] = 2x$$</div>
                <div class="example-item">$$\frac{d}{dx}[x^3] = 3x^2$$</div>
                <div class="example-item">$$\frac{d}{dx}[x^7] = 7x^6$$</div>
                <div class="example-item">$$\frac{d}{dx}[x^{100}] = 100x^{99}$$</div>
            </div>
        </section>

        <!-- Slide 8: Special Case n=1 -->
        <section class="slide slide-statement">
            <div class="statement-content">
                <p class="statement-text">When n = 1:</p>
                <p style="font-size: 2.5rem; margin: 1rem 0;">$$\frac{d}{dx}[x] = 1 \cdot x^0 = 1$$</p>
                <p class="statement-secondary">The slope of y = x is always 1</p>
            </div>
        </section>

        <!-- Slide 9: Negative Exponents -->
        <section class="slide slide-visual">
            <h2>Power Rule: Negative Exponents</h2>
            <div class="step-box">
                $$\frac{d}{dx}[x^{-1}] = -1 \cdot x^{-2} = -\frac{1}{x^2}$$
            </div>
            <div class="step-box">
                $$\frac{d}{dx}[x^{-3}] = -3 \cdot x^{-4} = -\frac{3}{x^4}$$
            </div>
            <p style="text-align: center; color: var(--unit-color); font-size: 1.4rem; margin-top: 1.5rem;">
                Rewrite \(\frac{1}{x^n}\) as \(x^{-n}\) first
            </p>
        </section>

        <!-- Slide 10: Fractional Exponents -->
        <section class="slide slide-visual">
            <h2>Power Rule: Fractional Exponents</h2>
            <div class="step-box">
                $$\frac{d}{dx}[x^{1/2}] = \frac{1}{2} x^{-1/2} = \frac{1}{2\sqrt{x}}$$
            </div>
            <div class="step-box">
                $$\frac{d}{dx}[x^{2/3}] = \frac{2}{3} x^{-1/3} = \frac{2}{3\sqrt[3]{x}}$$
            </div>
            <p style="text-align: center; color: var(--unit-color); font-size: 1.4rem; margin-top: 1.5rem;">
                Rewrite \(\sqrt{x}\) as \(x^{1/2}\) first
            </p>
        </section>

        <!-- Slide 11: Radical Rewriting -->
        <section class="slide slide-visual">
            <h2>Radicals to Exponents</h2>
            <div class="conversion-table">
                <div class="conversion-item">
                    <span>\(\sqrt{x}\)</span>
                    <span class="arrow">=</span>
                    <span>\(x^{1/2}\)</span>
                </div>
                <div class="conversion-item">
                    <span>\(\sqrt[3]{x}\)</span>
                    <span class="arrow">=</span>
                    <span>\(x^{1/3}\)</span>
                </div>
                <div class="conversion-item">
                    <span>\(\sqrt{x^3}\)</span>
                    <span class="arrow">=</span>
                    <span>\(x^{3/2}\)</span>
                </div>
                <div class="conversion-item">
                    <span>\(\frac{1}{\sqrt{x}}\)</span>
                    <span class="arrow">=</span>
                    <span>\(x^{-1/2}\)</span>
                </div>
            </div>
            <p style="text-align: center; color: #64748b; font-size: 1.3rem; margin-top: 1rem;">
                Always convert to exponent form before differentiating!
            </p>
        </section>

        <!-- Slide 12: Constant Multiple Rule -->
        <section class="slide slide-visual">
            <h2>Rule 3: Constant Multiple Rule</h2>
            <div class="formula-box">
                <div class="formula">$$\frac{d}{dx}[c \cdot f(x)] = c \cdot f'(x)$$</div>
                <div class="note">Constants "factor out" of derivatives</div>
            </div>
        </section>

        <!-- Slide 13: Constant Multiple Examples -->
        <section class="slide slide-visual">
            <h2>Constant Multiple Examples</h2>
            <div class="step-box">
                $$\frac{d}{dx}[5x^3] = 5 \cdot 3x^2 = 15x^2$$
            </div>
            <div class="step-box">
                $$\frac{d}{dx}[-2x^4] = -2 \cdot 4x^3 = -8x^3$$
            </div>
            <div class="step-box">
                $$\frac{d}{dx}[\pi x^2] = \pi \cdot 2x = 2\pi x$$
            </div>
        </section>

        <!-- Slide 14: Sum and Difference Rules -->
        <section class="slide slide-visual">
            <h2>Rule 4: Sum and Difference Rules</h2>
            <div class="formula-box">
                <div class="formula">$$\frac{d}{dx}[f(x) + g(x)] = f'(x) + g'(x)$$</div>
                <div class="formula">$$\frac{d}{dx}[f(x) - g(x)] = f'(x) - g'(x)$$</div>
                <div class="note">Differentiate term by term</div>
            </div>
        </section>

        <!-- Slide 15: Sum Rule Visualization -->
        <section class="slide slide-visual">
            <h2>Visualizing the Sum Rule</h2>
            <div class="viz-container" id="sum-rule-viz"></div>
            <p style="text-align: center; color: #64748b; font-size: 1.3rem;">
                The slope of the sum = sum of the slopes
            </p>
        </section>

        <!-- Slide 16: All Rules Together -->
        <section class="slide slide-visual">
            <h2>Putting It All Together</h2>
            <div class="rules-summary">
                <div class="rule-item">
                    <span class="rule-num">1</span>
                    <span><strong>Constant:</strong> \(\frac{d}{dx}[c] = 0\)</span>
                </div>
                <div class="rule-item">
                    <span class="rule-num">2</span>
                    <span><strong>Power:</strong> \(\frac{d}{dx}[x^n] = nx^{n-1}\)</span>
                </div>
                <div class="rule-item">
                    <span class="rule-num">3</span>
                    <span><strong>Constant Multiple:</strong> \(\frac{d}{dx}[cf(x)] = c \cdot f'(x)\)</span>
                </div>
                <div class="rule-item">
                    <span class="rule-num">4</span>
                    <span><strong>Sum/Difference:</strong> Differentiate term by term</span>
                </div>
            </div>
        </section>

        <!-- Slide 17: Combined Example 1 -->
        <section class="slide slide-visual">
            <h2>Example: Polynomial</h2>
            <div style="text-align: center; font-size: 1.8rem; margin: 1rem 0;">
                $$f(x) = 3x^4 - 5x^2 + 7x - 2$$
            </div>
            <div class="step-box">
                Step 1: Apply rules to each term
            </div>
            <div class="step-box">
                $$f'(x) = 3(4x^3) - 5(2x) + 7(1) - 0$$
            </div>
            <div class="step-box" style="background: rgba(124, 58, 237, 0.1); border-color: var(--unit-color);">
                $$f'(x) = 12x^3 - 10x + 7$$
            </div>
        </section>

        <!-- Slide 18: Combined Example 2 -->
        <section class="slide slide-visual">
            <h2>Example: Rewrite First</h2>
            <div style="text-align: center; font-size: 1.8rem; margin: 1rem 0;">
                $$g(x) = \frac{4x^3 + 2}{x}$$
            </div>
            <div class="step-box">
                Rewrite: \(g(x) = 4x^2 + 2x^{-1}\)
            </div>
            <div class="step-box">
                $$g'(x) = 8x + 2(-1)x^{-2}$$
            </div>
            <div class="step-box" style="background: rgba(124, 58, 237, 0.1); border-color: var(--unit-color);">
                $$g'(x) = 8x - \frac{2}{x^2}$$
            </div>
        </section>

        <!-- Slide 19: Common Mistake Warning -->
        <section class="slide slide-statement">
            <div class="statement-content">
                <div class="warning-box">
                    <div class="title">WARNING</div>
                    <p style="font-size: 1.5rem;">The power rule is for <strong>x^n</strong>, not <strong>a^x</strong>!</p>
                </div>
                <p style="font-size: 1.8rem; color: #ef4444; margin-top: 1.5rem;">
                    $$\frac{d}{dx}[2^x] \neq x \cdot 2^{x-1}$$
                </p>
                <p class="statement-secondary">We'll learn exponential derivatives later!</p>
            </div>
        </section>

        <!-- Slide 20: Practice Problem 1 -->
        <section class="slide slide-exercise">
            <h2>Practice: Find f'(x)</h2>
            <div style="text-align: center; font-size: 2rem; margin: 2rem 0;">
                $$f(x) = 6x^5 - 4x^3 + 2x - 9$$
            </div>
            <div class="exercise-timer">1 minute</div>
        </section>

        <!-- Slide 21: Practice Problem 2 -->
        <section class="slide slide-exercise">
            <h2>Practice: Find g'(x)</h2>
            <div style="text-align: center; font-size: 2rem; margin: 2rem 0;">
                $$g(x) = \sqrt{x} + \frac{3}{x^2}$$
            </div>
            <p style="text-align: center; color: var(--unit-color); font-size: 1.3rem;">
                Hint: Rewrite as exponents first!
            </p>
            <div class="exercise-timer">2 minutes</div>
        </section>

        <!-- Slide 22: Solutions -->
        <section class="slide slide-visual">
            <h2>Solutions</h2>
            <div class="step-box">
                <strong>Problem 1:</strong> \(f(x) = 6x^5 - 4x^3 + 2x - 9\)
                <br><br>
                \(f'(x) = 30x^4 - 12x^2 + 2\)
            </div>
            <div class="step-box">
                <strong>Problem 2:</strong> \(g(x) = x^{1/2} + 3x^{-2}\)
                <br><br>
                \(g'(x) = \frac{1}{2}x^{-1/2} - 6x^{-3} = \frac{1}{2\sqrt{x}} - \frac{6}{x^3}\)
            </div>
        </section>

        <!-- Slide 23: Key Takeaways -->
        <section class="slide slide-list">
            <h2>Key Takeaways</h2>
            <ul class="styled-list">
                <li>Constant rule: \(\frac{d}{dx}[c] = 0\)</li>
                <li>Power rule: \(\frac{d}{dx}[x^n] = nx^{n-1}\)</li>
                <li>Constant multiple: \(\frac{d}{dx}[cf] = c \cdot f'\)</li>
                <li>Sum/Difference: Differentiate term by term</li>
                <li>Rewrite expressions before differentiating</li>
            </ul>
        </section>

        <!-- Slide 24: Exit Ticket -->
        <section class="slide slide-exercise">
            <h2>Exit Ticket</h2>
            <div style="text-align: center; font-size: 1.8rem; margin: 2rem 0;">
                Find f'(x) for:
                <br><br>
                $$f(x) = 2x^5 - 3x^2 + 4x - 7$$
            </div>
        </section>

        <!-- Slide 25: Coming Up -->
        <section class="slide slide-statement">
            <div class="statement-content">
                <p class="statement-text">Next: The Product Rule</p>
                <p class="statement-secondary">Spoiler: \(\frac{d}{dx}[f \cdot g] \neq f' \cdot g'\)</p>
            </div>
        </section>
    </div>

    <div class="slide-nav">
        <button class="nav-btn" id="prevBtn" aria-label="Previous slide">&#8592;</button>
        <span class="slide-counter"><span id="currentSlide">1</span> / <span id="totalSlides">26</span></span>
        <button class="nav-btn" id="nextBtn" aria-label="Next slide">&#8594;</button>
    </div>

    <script src="../shared/presentation.js"></script>
    <script>
        // D3 Visualization Functions
        const visualizationSlides = {
            3: drawConstantRuleViz,
            6: drawPowerRuleViz,
            15: drawSumRuleViz
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;
            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        setInterval(checkAndDrawVisualization, 200);

        // Constant Rule Visualization
        function drawConstantRuleViz() {
            const container = d3.select('#constant-rule-viz');
            container.selectAll('*').remove();

            const width = 500;
            const height = 280;
            const margin = { top: 30, right: 40, bottom: 40, left: 50 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear().domain([-4, 4]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-1, 5]).range([plotHeight, 0]);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${yScale(0)})`)
                .call(d3.axisBottom(xScale).ticks(8))
                .attr('color', '#64748b');

            g.append('g')
                .attr('transform', `translate(${xScale(0)},0)`)
                .call(d3.axisLeft(yScale).ticks(6))
                .attr('color', '#64748b');

            // Constant line y = 3
            const c = 3;
            g.append('line')
                .attr('x1', xScale(-4))
                .attr('y1', yScale(c))
                .attr('x2', xScale(4))
                .attr('y2', yScale(c))
                .attr('stroke', '#7c3aed')
                .attr('stroke-width', 3);

            // Label
            g.append('text')
                .attr('x', xScale(3.5))
                .attr('y', yScale(c) - 10)
                .attr('fill', '#7c3aed')
                .attr('font-size', '1.25rem')
                .attr('font-weight', 'bold')
                .text('f(x) = 3');

            // Animated tangent lines
            const tangentPoints = [-2, 0, 2];
            const tangentGroup = g.append('g');

            tangentPoints.forEach((x, i) => {
                // Tangent line (horizontal)
                tangentGroup.append('line')
                    .attr('x1', xScale(x - 1))
                    .attr('y1', yScale(c))
                    .attr('x2', xScale(x + 1))
                    .attr('y2', yScale(c))
                    .attr('stroke', '#f97316')
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '5,3')
                    .attr('opacity', 0)
                    .transition()
                    .delay(i * 500)
                    .duration(500)
                    .attr('opacity', 1);

                // Point
                tangentGroup.append('circle')
                    .attr('cx', xScale(x))
                    .attr('cy', yScale(c))
                    .attr('r', 6)
                    .attr('fill', '#f97316')
                    .attr('opacity', 0)
                    .transition()
                    .delay(i * 500)
                    .duration(500)
                    .attr('opacity', 1);

                // Slope label
                tangentGroup.append('text')
                    .attr('x', xScale(x))
                    .attr('y', yScale(c) + 25)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#f97316')
                    .attr('font-size', '1.25rem')
                    .attr('font-weight', 'bold')
                    .text('slope = 0')
                    .attr('opacity', 0)
                    .transition()
                    .delay(i * 500 + 300)
                    .duration(300)
                    .attr('opacity', 1);
            });
        }

        // Power Rule Visualization
        function drawPowerRuleViz() {
            const container = d3.select('#power-rule-viz');
            container.selectAll('*').remove();

            const width = 800;
            const height = 300;
            const margin = { top: 30, right: 30, bottom: 40, left: 50 };
            const plotWidth = (width - margin.left - margin.right - 40) / 2;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Left panel: f(x) = x^3
            const g1 = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Right panel: f'(x) = 3x^2
            const g2 = svg.append('g')
                .attr('transform', `translate(${margin.left + plotWidth + 60},${margin.top})`);

            // Scales for left panel
            const xScale1 = d3.scaleLinear().domain([-2, 2]).range([0, plotWidth]);
            const yScale1 = d3.scaleLinear().domain([-4, 4]).range([plotHeight, 0]);

            // Scales for right panel
            const xScale2 = d3.scaleLinear().domain([-2, 2]).range([0, plotWidth]);
            const yScale2 = d3.scaleLinear().domain([-1, 12]).range([plotHeight, 0]);

            // Draw axes for left panel
            g1.append('g')
                .attr('transform', `translate(0,${yScale1(0)})`)
                .call(d3.axisBottom(xScale1).ticks(4))
                .attr('color', '#64748b');
            g1.append('g')
                .attr('transform', `translate(${xScale1(0)},0)`)
                .call(d3.axisLeft(yScale1).ticks(8))
                .attr('color', '#64748b');

            // Draw axes for right panel
            g2.append('g')
                .attr('transform', `translate(0,${yScale2(0)})`)
                .call(d3.axisBottom(xScale2).ticks(4))
                .attr('color', '#64748b');
            g2.append('g')
                .attr('transform', `translate(${xScale2(0)},0)`)
                .call(d3.axisLeft(yScale2).ticks(6))
                .attr('color', '#64748b');

            // Draw f(x) = x^3
            const line1 = d3.line()
                .x(d => xScale1(d.x))
                .y(d => yScale1(d.y));

            const data1 = d3.range(-2, 2.05, 0.05).map(x => ({ x, y: Math.pow(x, 3) }));

            g1.append('path')
                .datum(data1)
                .attr('d', line1)
                .attr('fill', 'none')
                .attr('stroke', '#7c3aed')
                .attr('stroke-width', 3);

            // Draw f'(x) = 3x^2
            const line2 = d3.line()
                .x(d => xScale2(d.x))
                .y(d => yScale2(d.y));

            const data2 = d3.range(-2, 2.05, 0.05).map(x => ({ x, y: 3 * Math.pow(x, 2) }));

            g2.append('path')
                .datum(data2)
                .attr('d', line2)
                .attr('fill', 'none')
                .attr('stroke', '#f97316')
                .attr('stroke-width', 3);

            // Labels
            g1.append('text')
                .attr('x', plotWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#7c3aed')
                .attr('font-size', '1.25rem')
                .attr('font-weight', 'bold')
                .text('f(x) = x³');

            g2.append('text')
                .attr('x', plotWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f97316')
                .attr('font-size', '1.25rem')
                .attr('font-weight', 'bold')
                .text("f'(x) = 3x²");

            // Interactive point and tangent line
            let currentX = 1;

            const tangentLine = g1.append('line')
                .attr('stroke', '#fbbf24')
                .attr('stroke-width', 2);

            const point1 = g1.append('circle')
                .attr('r', 8)
                .attr('fill', '#f97316')
                .attr('stroke', 'white')
                .attr('stroke-width', 2)
                .attr('cursor', 'ew-resize');

            const point2 = g2.append('circle')
                .attr('r', 8)
                .attr('fill', '#f97316')
                .attr('stroke', 'white')
                .attr('stroke-width', 2);

            // Slope display
            const slopeText = g1.append('text')
                .attr('fill', '#fbbf24')
                .attr('font-size', '1.25rem')
                .attr('font-weight', 'bold');

            function updateViz(x) {
                const y = Math.pow(x, 3);
                const slope = 3 * Math.pow(x, 2);

                // Update point on f
                point1.attr('cx', xScale1(x)).attr('cy', yScale1(y));

                // Update tangent line
                const dx = 0.8;
                tangentLine
                    .attr('x1', xScale1(x - dx))
                    .attr('y1', yScale1(y - slope * dx))
                    .attr('x2', xScale1(x + dx))
                    .attr('y2', yScale1(y + slope * dx));

                // Update point on f'
                point2.attr('cx', xScale2(x)).attr('cy', yScale2(slope));

                // Update slope text
                slopeText
                    .attr('x', xScale1(x) + 15)
                    .attr('y', yScale1(y) - 15)
                    .text(`slope = ${slope.toFixed(1)}`);
            }

            updateViz(currentX);

            // Animation
            let animationTime = 0;
            function animate() {
                animationTime += 0.02;
                const x = 1.5 * Math.sin(animationTime);
                updateViz(x);
                requestAnimationFrame(animate);
            }
            animate();
        }

        // Sum Rule Visualization
        function drawSumRuleViz() {
            const container = d3.select('#sum-rule-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 320;
            const margin = { top: 30, right: 30, bottom: 40, left: 50 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear().domain([-2, 3]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-2, 10]).range([plotHeight, 0]);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${yScale(0)})`)
                .call(d3.axisBottom(xScale).ticks(5))
                .attr('color', '#64748b');
            g.append('g')
                .attr('transform', `translate(${xScale(0)},0)`)
                .call(d3.axisLeft(yScale).ticks(6))
                .attr('color', '#64748b');

            // Functions
            const f = x => x * x;  // f(x) = x^2
            const g_func = x => x;  // g(x) = x
            const sum = x => f(x) + g_func(x);  // f + g

            const fPrime = x => 2 * x;
            const gPrime = x => 1;
            const sumPrime = x => fPrime(x) + gPrime(x);

            // Create line generator
            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y));

            // Generate data
            const xRange = d3.range(-2, 3.05, 0.05);
            const dataF = xRange.map(x => ({ x, y: f(x) }));
            const dataG = xRange.map(x => ({ x, y: g_func(x) }));
            const dataSum = xRange.map(x => ({ x, y: sum(x) }));

            // Draw curves
            g.append('path')
                .datum(dataF)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,3');

            g.append('path')
                .datum(dataG)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#34d399')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,3');

            g.append('path')
                .datum(dataSum)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#7c3aed')
                .attr('stroke-width', 3);

            // Legend
            const legend = g.append('g').attr('transform', `translate(${plotWidth - 180}, 10)`);

            legend.append('line').attr('x1', 0).attr('y1', 0).attr('x2', 25).attr('y2', 0)
                .attr('stroke', '#60a5fa').attr('stroke-width', 2).attr('stroke-dasharray', '5,3');
            legend.append('text').attr('x', 30).attr('y', 5).text('f(x) = x²')
                .attr('fill', '#60a5fa').attr('font-size', '1.25rem');

            legend.append('line').attr('x1', 0).attr('y1', 25).attr('x2', 25).attr('y2', 25)
                .attr('stroke', '#34d399').attr('stroke-width', 2).attr('stroke-dasharray', '5,3');
            legend.append('text').attr('x', 30).attr('y', 30).text('g(x) = x')
                .attr('fill', '#34d399').attr('font-size', '1.25rem');

            legend.append('line').attr('x1', 0).attr('y1', 50).attr('x2', 25).attr('y2', 50)
                .attr('stroke', '#7c3aed').attr('stroke-width', 3);
            legend.append('text').attr('x', 30).attr('y', 55).text('(f+g)(x) = x² + x')
                .attr('fill', '#7c3aed').attr('font-size', '1.25rem');

            // Animated point and tangent lines
            let currentX = 1;

            const pointF = g.append('circle').attr('r', 5).attr('fill', '#60a5fa');
            const pointG = g.append('circle').attr('r', 5).attr('fill', '#34d399');
            const pointSum = g.append('circle').attr('r', 7).attr('fill', '#7c3aed');

            const tangentSum = g.append('line')
                .attr('stroke', '#fbbf24')
                .attr('stroke-width', 2);

            // Slope display
            const slopeBox = g.append('g').attr('transform', `translate(10, ${plotHeight - 60})`);
            slopeBox.append('rect')
                .attr('width', 200)
                .attr('height', 55)
                .attr('fill', 'rgba(124, 58, 237, 0.1)')
                .attr('rx', 5);
            const slopeTextF = slopeBox.append('text').attr('x', 10).attr('y', 18).attr('fill', '#60a5fa').attr('font-size', '1.25rem');
            const slopeTextG = slopeBox.append('text').attr('x', 10).attr('y', 36).attr('fill', '#34d399').attr('font-size', '1.25rem');
            const slopeTextSum = slopeBox.append('text').attr('x', 10).attr('y', 50).attr('fill', '#7c3aed').attr('font-size', '1.25rem').attr('font-weight', 'bold');

            function updateViz(x) {
                pointF.attr('cx', xScale(x)).attr('cy', yScale(f(x)));
                pointG.attr('cx', xScale(x)).attr('cy', yScale(g_func(x)));
                pointSum.attr('cx', xScale(x)).attr('cy', yScale(sum(x)));

                const slope = sumPrime(x);
                const dx = 0.7;
                tangentSum
                    .attr('x1', xScale(x - dx))
                    .attr('y1', yScale(sum(x) - slope * dx))
                    .attr('x2', xScale(x + dx))
                    .attr('y2', yScale(sum(x) + slope * dx));

                slopeTextF.text(`f' = ${fPrime(x).toFixed(1)}`);
                slopeTextG.text(`g' = ${gPrime(x).toFixed(1)}`);
                slopeTextSum.text(`(f+g)' = ${sumPrime(x).toFixed(1)}`);
            }

            updateViz(currentX);

            // Animation
            let animationTime = 0;
            function animate() {
                animationTime += 0.015;
                const x = 0.5 + 1.5 * Math.sin(animationTime);
                updateViz(x);
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
