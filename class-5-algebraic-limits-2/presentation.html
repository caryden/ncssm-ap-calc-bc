<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 5: Algebraic Manipulation for Limits | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --theme-color: #356093;
            --theme-color-light: #4a7ab8;
        }

        /* Solution steps styling */
        .solution-steps {
            text-align: left;
            max-width: 800px;
            margin: 1.5rem auto;
        }

        .solution-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .solution-step .step-num {
            background: var(--theme-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-family: var(--font-display);
            flex-shrink: 0;
        }

        .solution-step .step-content {
            flex: 1;
            font-size: 1.25rem;
        }

        .solution-step .step-annotation {
            color: var(--text-tertiary);
            font-size: 1rem;
            margin-top: 0.25rem;
        }

        .solution-step.success {
            background: rgba(34, 197, 94, 0.2);
        }

        .solution-step.success .step-num {
            background: var(--success);
        }

        /* Conjugate pairs display */
        .conjugate-pairs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 600px;
            margin: 2rem auto;
        }

        .conjugate-pair {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            font-size: 1.75rem;
        }

        .conjugate-arrow {
            color: var(--theme-color);
            font-weight: 700;
            font-size: 2rem;
        }

        /* Factoring patterns grid */
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            max-width: 900px;
            margin: 1.5rem auto;
        }

        .pattern-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--theme-color);
        }

        .pattern-card .name {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--theme-color);
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }

        .pattern-card .formula {
            font-size: 1.25rem;
        }

        /* Flowchart container */
        .flowchart-container {
            width: 100%;
            max-width: 800px;
            margin: 1rem auto;
            min-height: 400px;
        }

        /* Visualization container */
        .visualization {
            width: 100%;
            max-width: 900px;
            margin: 1rem auto;
            min-height: 400px;
        }

        /* Steps list for rationalizing */
        .steps-list {
            text-align: left;
            max-width: 700px;
            margin: 1.5rem auto;
        }

        .steps-list ol {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .steps-list li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 1.25rem;
            counter-increment: step-counter;
        }

        .steps-list li::before {
            content: counter(step-counter);
            background: var(--theme-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-family: var(--font-display);
            flex-shrink: 0;
        }

        /* Key insight box */
        .insight-box {
            background: rgba(53, 96, 147, 0.2);
            border: 2px solid var(--theme-color);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            max-width: 700px;
            margin: 1.5rem auto;
            text-align: center;
            font-size: 1.5rem;
        }

        /* Warning list items */
        .warning-list li {
            color: var(--warning);
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Algebraic Manipulation">
            <div class="slide-content">
                <div class="unit-badge">Unit 1: Limits and Continuity</div>
                <h1>Algebraic Manipulation</h1>
                <p class="subtitle">Techniques for 0/0</p>
                <p class="meta">Class 5 | February 11, 2026 | CED 1.6</p>
            </div>
        </div>

        <!-- Slide 1: The Unsolved Problem -->
        <div class="slide slide-visual" data-slide="1" data-section="Opening" data-title="Remember This?">
            <div class="slide-content">
                <h2>Remember This?</h2>
                <div class="math-display" style="font-size: 2.5rem; margin: 2rem 0;">
                    \[\lim_{x \to 2} \frac{x^2 - 4}{x - 2} = \frac{0}{0}\]
                </div>
                <p class="caption" style="font-size: 1.5rem; color: var(--warning);">Direct substitution failed. Today we fix it.</p>
            </div>
        </div>

        <!-- Slide 2: The Key Insight -->
        <div class="slide slide-statement" data-slide="2" data-section="Opening" data-title="Key Insight">
            <div class="slide-content">
                <p class="statement">When 0/0 appears, <em>simplify first</em>, then substitute.</p>
            </div>
        </div>

        <!-- Slide 3: The Factoring Strategy -->
        <div class="slide slide-two-part" data-slide="3" data-section="Factoring" data-title="Technique 1">
            <div class="slide-content">
                <p class="primary" style="color: var(--theme-color);">Technique 1: Factoring</p>
                <p class="secondary">When both numerator and denominator equal zero, they share a common factor. Cancel it!</p>
            </div>
        </div>

        <!-- Slide 4: Why Canceling Works -->
        <div class="slide slide-visual" data-slide="4" data-section="Factoring" data-title="Why Canceling Works">
            <div class="slide-content">
                <h2>Why Canceling is Valid</h2>
                <div class="visualization" id="viz-equivalent"></div>
                <p class="caption">The limit only cares about <em>approach</em>, not the value at x = 2</p>
            </div>
        </div>

        <!-- Slide 5: Example 1 -->
        <div class="slide slide-example" data-slide="5" data-section="Factoring" data-title="Example 1">
            <div class="slide-content">
                <h2>Example 1</h2>
                <div class="problem">
                    \[\lim_{x \to 2} \frac{x^2 - 4}{x - 2}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Factor: \(\frac{(x-2)(x+2)}{x-2}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Cancel: \(x + 2\)</div>
                            <div class="step-annotation">(valid when x ≠ 2)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Substitute: \(2 + 2\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            = 4
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: Example 2 -->
        <div class="slide slide-example" data-slide="6" data-section="Factoring" data-title="Example 2">
            <div class="slide-content">
                <h2>Example 2</h2>
                <div class="problem">
                    \[\lim_{x \to 3} \frac{x^2 - 9}{x - 3}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Factor: \(\frac{(x-3)(x+3)}{x-3}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Cancel: \(x + 3\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Substitute: \(3 + 3\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            = 6
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 7: Example 3 -->
        <div class="slide slide-example" data-slide="7" data-section="Factoring" data-title="Example 3">
            <div class="slide-content">
                <h2>Example 3: Quadratic Numerator</h2>
                <div class="problem">
                    \[\lim_{x \to -1} \frac{x^2 + 3x + 2}{x + 1}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Factor numerator: \(\frac{(x+1)(x+2)}{x+1}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Cancel: \(x + 2\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Substitute: \(-1 + 2\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            = 1
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 8: Example 4 - Cubic -->
        <div class="slide slide-example" data-slide="8" data-section="Factoring" data-title="Example 4">
            <div class="slide-content">
                <h2>Example 4: Cubic</h2>
                <div class="problem">
                    \[\lim_{x \to 1} \frac{x^3 - 1}{x - 1}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Factor (difference of cubes): \(\frac{(x-1)(x^2+x+1)}{x-1}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Cancel: \(x^2 + x + 1\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Substitute: \(1 + 1 + 1\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            = 3
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Factoring Patterns -->
        <div class="slide slide-visual" data-slide="9" data-section="Factoring" data-title="Patterns">
            <div class="slide-content">
                <h2>Factoring Patterns to Know</h2>
                <div class="patterns-grid">
                    <div class="pattern-card">
                        <div class="name">Difference of Squares</div>
                        <div class="formula">\(a^2 - b^2 = (a-b)(a+b)\)</div>
                    </div>
                    <div class="pattern-card">
                        <div class="name">Difference of Cubes</div>
                        <div class="formula">\(a^3 - b^3 = (a-b)(a^2+ab+b^2)\)</div>
                    </div>
                    <div class="pattern-card">
                        <div class="name">Sum of Cubes</div>
                        <div class="formula">\(a^3 + b^3 = (a+b)(a^2-ab+b^2)\)</div>
                    </div>
                    <div class="pattern-card">
                        <div class="name">Quadratic Trinomial</div>
                        <div class="formula">\(x^2 + bx + c = (x+m)(x+n)\)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: Rationalizing Intro -->
        <div class="slide slide-two-part" data-slide="10" data-section="Rationalizing" data-title="Technique 2">
            <div class="slide-content">
                <p class="primary" style="color: var(--theme-color);">Technique 2: Rationalizing</p>
                <p class="secondary">When square roots cause 0/0, multiply by the conjugate</p>
            </div>
        </div>

        <!-- Slide 11: What's a Conjugate -->
        <div class="slide slide-visual" data-slide="11" data-section="Rationalizing" data-title="Conjugates">
            <div class="slide-content">
                <h2>The Conjugate</h2>
                <div class="conjugate-pairs">
                    <div class="conjugate-pair">
                        <span>\(\sqrt{x} + 3\)</span>
                        <span class="conjugate-arrow">↔</span>
                        <span>\(\sqrt{x} - 3\)</span>
                    </div>
                    <div class="conjugate-pair">
                        <span>\(2 - \sqrt{x+1}\)</span>
                        <span class="conjugate-arrow">↔</span>
                        <span>\(2 + \sqrt{x+1}\)</span>
                    </div>
                </div>
                <div class="insight-box">
                    Key fact: \((a + b)(a - b) = a^2 - b^2\)
                </div>
                <p class="caption">The conjugate changes only the sign between terms</p>
            </div>
        </div>

        <!-- Slide 12: Example 5 -->
        <div class="slide slide-example" data-slide="12" data-section="Rationalizing" data-title="Example 5">
            <div class="slide-content">
                <h2>Example 5</h2>
                <div class="problem">
                    \[\lim_{x \to 0} \frac{\sqrt{x+4} - 2}{x}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Check: \(\frac{\sqrt{4}-2}{0} = \frac{0}{0}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Multiply by conjugate: \(\frac{\sqrt{x+4}-2}{x} \cdot \frac{\sqrt{x+4}+2}{\sqrt{x+4}+2}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Simplify: \(\frac{(x+4)-4}{x(\sqrt{x+4}+2)} = \frac{x}{x(\sqrt{x+4}+2)}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">4</span>
                        <div class="step-content">
                            <div>Cancel: \(\frac{1}{\sqrt{x+4}+2}\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            \(\frac{1}{2+2} = \frac{1}{4}\)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Example 5 Visualization -->
        <div class="slide slide-visual" data-slide="13" data-section="Rationalizing" data-title="Visualization">
            <div class="slide-content">
                <h2>Verifying Example 5</h2>
                <div class="visualization" id="viz-rationalizing"></div>
                <p class="caption">The function approaches \(\frac{1}{4}\) as x approaches 0</p>
            </div>
        </div>

        <!-- Slide 14: Example 6 -->
        <div class="slide slide-example" data-slide="14" data-section="Rationalizing" data-title="Example 6">
            <div class="slide-content">
                <h2>Example 6</h2>
                <div class="problem">
                    \[\lim_{x \to 9} \frac{\sqrt{x} - 3}{x - 9}\]
                </div>
                <div class="solution-steps">
                    <div class="solution-step">
                        <span class="step-num">1</span>
                        <div class="step-content">
                            <div>Multiply by conjugate: \(\frac{\sqrt{x}-3}{x-9} \cdot \frac{\sqrt{x}+3}{\sqrt{x}+3}\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">2</span>
                        <div class="step-content">
                            <div>Numerator becomes: \(x - 9\)</div>
                        </div>
                    </div>
                    <div class="solution-step">
                        <span class="step-num">3</span>
                        <div class="step-content">
                            <div>Result: \(\frac{x-9}{(x-9)(\sqrt{x}+3)} = \frac{1}{\sqrt{x}+3}\)</div>
                        </div>
                    </div>
                    <div class="solution-step success">
                        <span class="step-num">✓</span>
                        <div class="step-content" style="color: var(--success); font-weight: 600; font-size: 1.5rem;">
                            \(\frac{1}{3+3} = \frac{1}{6}\)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 15: Rationalizing Steps -->
        <div class="slide slide-list" data-slide="15" data-section="Rationalizing" data-title="Process">
            <div class="slide-content">
                <h2>Rationalizing Steps</h2>
                <div class="steps-list">
                    <ol>
                        <li>Identify the expression with radicals</li>
                        <li>Find its conjugate</li>
                        <li>Multiply top and bottom by conjugate</li>
                        <li>Simplify (radicals should disappear from one location)</li>
                        <li>Cancel common factors</li>
                        <li>Substitute</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Slide 16: Practice - Rationalizing -->
        <div class="slide slide-exercise" data-slide="16" data-section="Rationalizing" data-title="Your Turn">
            <div class="slide-content">
                <h2>Your Turn</h2>
                <div class="prompt">
                    <p>Evaluate:</p>
                    <div class="math-display" style="font-size: 2.5rem;">
                        \[\lim_{h \to 0} \frac{\sqrt{9+h} - 3}{h}\]
                    </div>
                </div>
                <div class="definition-box" style="margin-top: 2rem; opacity: 0.3;">
                    <div class="content" style="text-align: center;">
                        <p>Answer: \(\frac{1}{6}\)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 17: Choosing Your Technique -->
        <div class="slide slide-visual" data-slide="17" data-section="Strategy" data-title="How to Choose">
            <div class="slide-content">
                <h2>How to Choose</h2>
                <div class="flowchart-container" id="viz-flowchart"></div>
            </div>
        </div>

        <!-- Slide 18: Mixed Practice -->
        <div class="slide slide-exercise" data-slide="18" data-section="Strategy" data-title="Mixed Practice">
            <div class="slide-content">
                <h2>Practice: Choose the Method</h2>
                <div class="prompt" style="text-align: left; max-width: 700px; margin: 0 auto;">
                    <p style="margin-bottom: 1.5rem;">Identify the technique, then solve:</p>
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                        <p>1. \(\displaystyle\lim_{x \to 4} \frac{x^2 - 16}{x - 4}\)</p>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                        <p>2. \(\displaystyle\lim_{x \to 1} \frac{\sqrt{x} - 1}{x - 1}\)</p>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                        <p>3. \(\displaystyle\lim_{x \to -2} \frac{x^2 + 5x + 6}{x + 2}\)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 19: Common Pitfalls -->
        <div class="slide slide-list" data-slide="19" data-section="Strategy" data-title="Watch Out">
            <div class="slide-content">
                <h2>Watch Out For...</h2>
                <ul class="warning-list">
                    <li>Forgetting to check for 0/0 first</li>
                    <li>Canceling incorrectly</li>
                    <li>Multiplying by wrong conjugate</li>
                    <li>Arithmetic errors in simplification</li>
                </ul>
            </div>
        </div>

        <!-- Slide 20: Key Takeaways -->
        <div class="slide slide-list" data-slide="20" data-section="Closing" data-title="Takeaways">
            <div class="slide-content">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>0/0 means simplify, then substitute</li>
                    <li>Factoring: find and cancel common factors</li>
                    <li>Rationalizing: multiply by conjugate</li>
                    <li>Choose technique based on expression form</li>
                </ul>
            </div>
        </div>

        <!-- Slide 21: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="21" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p>Evaluate:</p>
                    <div class="math-display" style="font-size: 2.5rem;">
                        \[\lim_{x \to 5} \frac{x^2 - 25}{x - 5}\]
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 22: Coming Up -->
        <div class="slide slide-statement" data-slide="22" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement">Next: The <em>Squeeze Theorem</em> for tricky limits</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 23</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>←</kbd> <kbd>→</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 5: Algebraic Manipulation for Limits</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">← Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">← Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next →</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // D3 Visualizations for Class 5

        // Visualization mapping
        const visualizationSlides = {
            4: drawEquivalentFunctions,
            13: drawRationalizingGraph,
            17: drawFlowchart
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;
            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        setInterval(checkAndDrawVisualization, 200);

        // Visualization 1: Equivalent Functions (Slide 4)
        function drawEquivalentFunctions() {
            const container = d3.select('#viz-equivalent');
            container.selectAll('*').remove();

            const width = 800;
            const height = 400;
            const margin = { top: 40, right: 60, bottom: 60, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left}, ${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear()
                .domain([-1, 5])
                .range([0, plotWidth]);

            const yScale = d3.scaleLinear()
                .domain([-1, 7])
                .range([plotHeight, 0]);

            // Grid
            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.vertical')
                .data(d3.range(-1, 6))
                .enter()
                .append('line')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', 'rgba(255,255,255,0.1)');

            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.horizontal')
                .data(d3.range(-1, 8))
                .enter()
                .append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', d => yScale(d))
                .attr('y2', d => yScale(d))
                .attr('stroke', 'rgba(255,255,255,0.1)');

            // Axes
            g.append('line')
                .attr('x1', xScale(0))
                .attr('x2', xScale(0))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', 'rgba(255,255,255,0.5)')
                .attr('stroke-width', 1);

            g.append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', yScale(0))
                .attr('y2', yScale(0))
                .attr('stroke', 'rgba(255,255,255,0.5)')
                .attr('stroke-width', 1);

            // Generate data for g(x) = x + 2
            const lineData = [];
            for (let x = -1; x <= 5; x += 0.1) {
                lineData.push({ x: x, y: x + 2 });
            }

            // Line generator
            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y));

            // Draw g(x) = x + 2 (the simplified function)
            g.append('path')
                .datum(lineData)
                .attr('fill', 'none')
                .attr('stroke', '#22c55e')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Draw f(x) = (x^2 - 4)/(x - 2) as dots (same line but different color overlay)
            const fData = [];
            for (let x = -1; x <= 5; x += 0.05) {
                if (Math.abs(x - 2) > 0.05) {
                    fData.push({ x: x, y: (x * x - 4) / (x - 2) });
                }
            }

            g.append('path')
                .datum(fData)
                .attr('fill', 'none')
                .attr('stroke', '#356093')
                .attr('stroke-width', 3)
                .attr('stroke-dasharray', '8,4')
                .attr('d', line);

            // Draw the hole at x = 2
            g.append('circle')
                .attr('cx', xScale(2))
                .attr('cy', yScale(4))
                .attr('r', 8)
                .attr('fill', '#1a1a2e')
                .attr('stroke', '#f59e0b')
                .attr('stroke-width', 3);

            // Labels
            g.append('text')
                .attr('x', xScale(4.5))
                .attr('y', yScale(6.5) + 5)
                .attr('fill', '#22c55e')
                .attr('font-size', '1.25rem')
                .attr('font-family', 'var(--font-display)')
                .text('g(x) = x + 2');

            g.append('text')
                .attr('x', xScale(3.5))
                .attr('y', yScale(3))
                .attr('fill', '#356093')
                .attr('font-size', '1.25rem')
                .attr('font-family', 'var(--font-display)')
                .text('f(x) = (x² - 4)/(x - 2)');

            // Hole annotation
            g.append('text')
                .attr('x', xScale(2.3))
                .attr('y', yScale(4.5))
                .attr('fill', '#f59e0b')
                .attr('font-size', '1rem')
                .attr('font-family', 'var(--font-display)')
                .text('Hole at x = 2');

            // Axis labels
            g.append('text')
                .attr('x', plotWidth)
                .attr('y', yScale(0) - 10)
                .attr('fill', 'white')
                .attr('font-size', '1.25rem')
                .attr('text-anchor', 'end')
                .text('x');

            g.append('text')
                .attr('x', xScale(0) + 10)
                .attr('y', 15)
                .attr('fill', 'white')
                .attr('font-size', '1.25rem')
                .text('y');
        }

        // Visualization 2: Rationalizing Graph (Slide 13)
        function drawRationalizingGraph() {
            const container = d3.select('#viz-rationalizing');
            container.selectAll('*').remove();

            const width = 800;
            const height = 400;
            const margin = { top: 40, right: 60, bottom: 60, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left}, ${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear()
                .domain([-4, 4])
                .range([0, plotWidth]);

            const yScale = d3.scaleLinear()
                .domain([-0.5, 1])
                .range([plotHeight, 0]);

            // Grid
            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.vertical')
                .data(d3.range(-4, 5))
                .enter()
                .append('line')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', 'rgba(255,255,255,0.1)');

            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.horizontal')
                .data(d3.range(-0.5, 1.1, 0.25))
                .enter()
                .append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', d => yScale(d))
                .attr('y2', d => yScale(d))
                .attr('stroke', 'rgba(255,255,255,0.1)');

            // Axes
            g.append('line')
                .attr('x1', xScale(0))
                .attr('x2', xScale(0))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', 'rgba(255,255,255,0.5)')
                .attr('stroke-width', 1);

            g.append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', yScale(0))
                .attr('y2', yScale(0))
                .attr('stroke', 'rgba(255,255,255,0.5)')
                .attr('stroke-width', 1);

            // Function: f(x) = (sqrt(x+4) - 2) / x
            const funcData = [];
            for (let x = -3.9; x <= 4; x += 0.05) {
                if (Math.abs(x) > 0.05) {
                    const y = (Math.sqrt(x + 4) - 2) / x;
                    if (y >= -0.5 && y <= 1) {
                        funcData.push({ x: x, y: y });
                    }
                }
            }

            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y));

            // Split data at x = 0
            const leftData = funcData.filter(d => d.x < 0);
            const rightData = funcData.filter(d => d.x > 0);

            g.append('path')
                .datum(leftData)
                .attr('fill', 'none')
                .attr('stroke', '#356093')
                .attr('stroke-width', 3)
                .attr('d', line);

            g.append('path')
                .datum(rightData)
                .attr('fill', 'none')
                .attr('stroke', '#356093')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Draw the hole at x = 0, y = 1/4
            g.append('circle')
                .attr('cx', xScale(0))
                .attr('cy', yScale(0.25))
                .attr('r', 8)
                .attr('fill', '#1a1a2e')
                .attr('stroke', '#f59e0b')
                .attr('stroke-width', 3);

            // Limit line at y = 1/4
            g.append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', yScale(0.25))
                .attr('y2', yScale(0.25))
                .attr('stroke', '#22c55e')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');

            // Limit label
            g.append('text')
                .attr('x', plotWidth - 10)
                .attr('y', yScale(0.25) - 10)
                .attr('fill', '#22c55e')
                .attr('font-size', '1.25rem')
                .attr('font-family', 'var(--font-display)')
                .attr('text-anchor', 'end')
                .text('L = 1/4');

            // Function label
            g.append('text')
                .attr('x', xScale(2))
                .attr('y', yScale(0.6))
                .attr('fill', '#356093')
                .attr('font-size', '1rem')
                .attr('font-family', 'var(--font-display)')
                .text('f(x) = (sqrt(x+4) - 2)/x');

            // Axis labels
            g.append('text')
                .attr('x', plotWidth)
                .attr('y', yScale(0) - 10)
                .attr('fill', 'white')
                .attr('font-size', '1.25rem')
                .attr('text-anchor', 'end')
                .text('x');

            g.append('text')
                .attr('x', xScale(0) + 10)
                .attr('y', 15)
                .attr('fill', 'white')
                .attr('font-size', '1.25rem')
                .text('y');

            // X tick marks
            [-4, -2, 2, 4].forEach(x => {
                g.append('text')
                    .attr('x', xScale(x))
                    .attr('y', yScale(0) + 25)
                    .attr('fill', 'white')
                    .attr('font-size', '1rem')
                    .attr('text-anchor', 'middle')
                    .text(x);
            });
        }

        // Visualization 3: Decision Flowchart (Slide 17)
        function drawFlowchart() {
            const container = d3.select('#viz-flowchart');
            container.selectAll('*').remove();

            const width = 800;
            const height = 450;

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Define nodes
            const nodes = [
                { id: 'start', label: '0/0 form?', x: 400, y: 50, type: 'diamond' },
                { id: 'no', label: 'Direct\nSubstitution', x: 600, y: 50, type: 'rect' },
                { id: 'continue', label: 'Expression type?', x: 400, y: 150, type: 'diamond' },
                { id: 'poly', label: 'Polynomial\nfraction', x: 200, y: 250, type: 'rect' },
                { id: 'sqrt', label: 'Contains\nsquare root', x: 400, y: 250, type: 'rect' },
                { id: 'complex', label: 'Complex\nfraction', x: 600, y: 250, type: 'rect' },
                { id: 'factor', label: 'FACTORING', x: 200, y: 370, type: 'action' },
                { id: 'rational', label: 'RATIONALIZING', x: 400, y: 370, type: 'action' },
                { id: 'simplify', label: 'SIMPLIFY', x: 600, y: 370, type: 'action' }
            ];

            // Define edges
            const edges = [
                { from: 'start', to: 'no', label: 'No' },
                { from: 'start', to: 'continue', label: 'Yes' },
                { from: 'continue', to: 'poly', label: '' },
                { from: 'continue', to: 'sqrt', label: '' },
                { from: 'continue', to: 'complex', label: '' },
                { from: 'poly', to: 'factor', label: '' },
                { from: 'sqrt', to: 'rational', label: '' },
                { from: 'complex', to: 'simplify', label: '' }
            ];

            // Draw edges
            edges.forEach(edge => {
                const fromNode = nodes.find(n => n.id === edge.from);
                const toNode = nodes.find(n => n.id === edge.to);

                // Create path
                const path = svg.append('path')
                    .attr('d', `M ${fromNode.x} ${fromNode.y + 30} L ${toNode.x} ${toNode.y - 30}`)
                    .attr('fill', 'none')
                    .attr('stroke', 'rgba(255,255,255,0.5)')
                    .attr('stroke-width', 2)
                    .attr('marker-end', 'url(#arrow)');

                // Add edge label
                if (edge.label) {
                    const midX = (fromNode.x + toNode.x) / 2;
                    const midY = (fromNode.y + toNode.y) / 2;
                    svg.append('text')
                        .attr('x', edge.label === 'No' ? midX + 20 : midX - 20)
                        .attr('y', midY)
                        .attr('fill', edge.label === 'Yes' ? '#22c55e' : '#f59e0b')
                        .attr('font-size', '1rem')
                        .attr('font-family', 'var(--font-display)')
                        .text(edge.label);
                }
            });

            // Arrow marker
            svg.append('defs').append('marker')
                .attr('id', 'arrow')
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 5)
                .attr('refY', 5)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', 'rgba(255,255,255,0.5)');

            // Draw nodes
            nodes.forEach(node => {
                const g = svg.append('g')
                    .attr('transform', `translate(${node.x}, ${node.y})`);

                if (node.type === 'diamond') {
                    g.append('polygon')
                        .attr('points', '0,-30 60,0 0,30 -60,0')
                        .attr('fill', '#356093')
                        .attr('stroke', '#4a7ab8')
                        .attr('stroke-width', 2);
                } else if (node.type === 'rect') {
                    g.append('rect')
                        .attr('x', -70)
                        .attr('y', -25)
                        .attr('width', 140)
                        .attr('height', 50)
                        .attr('rx', 8)
                        .attr('fill', 'var(--bg-secondary)')
                        .attr('stroke', 'rgba(255,255,255,0.3)')
                        .attr('stroke-width', 2);
                } else if (node.type === 'action') {
                    g.append('rect')
                        .attr('x', -80)
                        .attr('y', -25)
                        .attr('width', 160)
                        .attr('height', 50)
                        .attr('rx', 25)
                        .attr('fill', '#22c55e')
                        .attr('stroke', '#16a34a')
                        .attr('stroke-width', 2);
                }

                // Node label
                const lines = node.label.split('\n');
                lines.forEach((line, i) => {
                    g.append('text')
                        .attr('x', 0)
                        .attr('y', (i - (lines.length - 1) / 2) * 18 + 5)
                        .attr('fill', node.type === 'action' ? 'white' : 'white')
                        .attr('font-size', node.type === 'action' ? '1.1rem' : '1rem')
                        .attr('font-family', 'var(--font-display)')
                        .attr('font-weight', node.type === 'action' ? '700' : '500')
                        .attr('text-anchor', 'middle')
                        .text(line);
                });
            });
        }
    </script>
</body>
</html>
