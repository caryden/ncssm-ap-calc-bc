<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 54: Area in Polar Coordinates | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --theme-color: #0891b2;
            --theme-color-light: #22d3ee;
            --color-function: #60a5fa;
            --color-sector: #0891b2;
            --color-highlight: #f97316;
            --color-success: #22c55e;
            --color-error: #ef4444;
        }

        .bc-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--theme-color), var(--theme-color-light));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .formula-box {
            background: var(--bg-secondary);
            border: 3px solid var(--theme-color);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 1.5rem auto;
            max-width: 600px;
            text-align: center;
        }

        .formula-box .formula {
            font-size: 2rem;
            color: var(--text-primary);
        }

        .result-box {
            background: linear-gradient(135deg, var(--theme-color), var(--theme-color-light));
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 1rem;
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--color-error);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box p {
            margin: 0.5rem 0;
            font-size: 1.25rem;
        }

        .visualization {
            width: 100%;
            max-width: 800px;
            margin: 1rem auto;
            min-height: 350px;
        }

        .slider-control {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .slider-control label {
            font-size: 1.25rem;
            font-family: var(--font-display);
        }

        .slider-control input[type="range"] {
            width: 200px;
            height: 8px;
            -webkit-appearance: none;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--theme-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .value-display {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--theme-color);
            min-width: 120px;
        }

        .step-box {
            background: var(--bg-secondary);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 0.75rem 0;
            font-size: 1.35rem;
            text-align: left;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .step-box.highlight {
            border-left: 4px solid var(--theme-color);
        }

        .curve-selector {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .curve-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .curve-btn.active {
            border-color: var(--theme-color);
            background: rgba(8, 145, 178, 0.2);
        }

        .curve-btn:hover {
            border-color: var(--theme-color);
        }

        .identity-box {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 1.25rem;
        }

        .identity-box .identity {
            color: var(--theme-color);
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Polar Area">
            <div class="slide-content">
                <div class="unit-badge">Unit 9: Parametric, Polar, and Vector-Valued Functions <span class="bc-badge">BC Only</span></div>
                <h1>Area in Polar Coordinates</h1>
                <p class="subtitle">Sectors Instead of Rectangles</p>
                <p class="meta">Class 54 | CED 9.8, 9.9 | NCSSM</p>
            </div>
        </div>

        <!-- Slide 1: A New Kind of Area Problem -->
        <div class="slide slide-visual" data-slide="1" data-section="Opening" data-title="A New Problem">
            <div class="slide-content">
                <h2>Find the Area Inside...</h2>
                <div id="cardioid-intro-viz" class="visualization"></div>
                <p style="font-size: 1.5rem; color: var(--color-error);">This isn't bounded by vertical lines!</p>
                <p class="caption">We need a different approach for polar geometry</p>
            </div>
        </div>

        <!-- Slide 2: The Key Insight -->
        <div class="slide slide-statement" data-slide="2" data-section="Opening" data-title="Key Insight">
            <div class="slide-content">
                <p class="statement">In polar coordinates, the natural "slices" are <em>SECTORS</em>, not rectangles!</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">Think pie slices, not vertical strips</p>
            </div>
        </div>

        <!-- Slide 3: Sector Area Review -->
        <div class="slide slide-visual" data-slide="3" data-section="Deriving the Formula" data-title="Sector Area">
            <div class="slide-content">
                <h2>Area of a Circular Sector</h2>
                <div id="sector-area-viz" class="visualization"></div>
                <div class="formula-box">
                    <div class="formula">$$A_{sector} = \frac{1}{2}r^2\theta$$</div>
                </div>
                <p class="caption">Fraction of circle: \(\frac{\theta}{2\pi} \times \pi r^2 = \frac{1}{2}r^2\theta\)</p>
            </div>
        </div>

        <!-- Slide 4: Setting Up the Integral -->
        <div class="slide slide-two-part" data-slide="4" data-section="Deriving the Formula" data-title="Setting Up">
            <div class="slide-content">
                <p class="primary">The Setup</p>
                <p class="secondary" style="font-size: 1.4rem; margin-top: 1rem;">
                    Region bounded by \(r = f(\theta)\) from \(\theta = \alpha\) to \(\theta = \beta\)
                </p>
                <p class="secondary" style="font-size: 1.4rem;">
                    Divide angle interval into \(n\) thin sectors, each with angle \(d\theta\)
                </p>
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--bg-tertiary);">
                    <p style="font-size: 1.6rem; color: var(--theme-color); font-weight: 600;">The Infinitesimal Sector</p>
                    <p style="font-size: 1.35rem; margin-top: 1rem;">At angle \(\theta_i\), radius is \(r(\theta_i)\)</p>
                    <p style="font-size: 1.35rem;">Thin sector area: \(dA \approx \frac{1}{2}[r(\theta)]^2 \, d\theta\)</p>
                </div>
            </div>
        </div>

        <!-- Slide 5: Sector Approximation Animation -->
        <div class="slide slide-visual" data-slide="5" data-section="Deriving the Formula" data-title="Sector Approximation">
            <div class="slide-content">
                <h2>Approximating with Sectors</h2>
                <div id="sector-approx-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>n =</label>
                    <input type="range" id="n-slider" min="4" max="50" step="1" value="8">
                    <span class="value-display" id="n-display">n = 8</span>
                    <span class="value-display" id="area-display">Area ≈ 0.00</span>
                </div>
                <p class="caption">As n increases, the approximation converges to the integral</p>
            </div>
        </div>

        <!-- Slide 6: The Polar Area Formula -->
        <div class="slide slide-visual" data-slide="6" data-section="Deriving the Formula" data-title="Polar Area Formula">
            <div class="slide-content">
                <h2>The Polar Area Formula</h2>
                <div class="step-box">
                    Total area ≈ \(\sum \frac{1}{2}r^2 \, \Delta\theta\)
                </div>
                <div class="step-box">
                    As \(\Delta\theta \to 0\), sum becomes integral
                </div>
                <div class="formula-box">
                    <div class="formula">$$A = \frac{1}{2}\int_{\alpha}^{\beta} [r(\theta)]^2\, d\theta$$</div>
                </div>
                <p class="caption" style="color: var(--color-highlight); font-weight: 600;">Remember: SQUARE the r, include the 1/2</p>
            </div>
        </div>

        <!-- Slide 7: Three Critical Points -->
        <div class="slide slide-list" data-slide="7" data-section="Deriving the Formula" data-title="Don't Forget">
            <div class="slide-content">
                <h2>Don't Forget!</h2>
                <ul>
                    <li>The <strong style="color: var(--theme-color);">1/2 factor</strong> is ESSENTIAL (from sector formula)</li>
                    <li><strong style="color: var(--color-highlight);">SQUARE r(θ)</strong> — the most common error is forgetting this!</li>
                    <li>Bounds are <strong style="color: var(--color-success);">ANGLES</strong> (θ values), not radii</li>
                </ul>
            </div>
        </div>

        <!-- Slide 8: Example 1 - Circle Verification -->
        <div class="slide slide-example" data-slide="8" data-section="Examples" data-title="Circle Verification">
            <div class="slide-content">
                <h2>Verifying with a Circle</h2>
                <p style="font-size: 1.4rem; margin-bottom: 1rem;">Given: \(r = a\) (constant), \(\theta\) from \(0\) to \(2\pi\)</p>
                <div class="step-box">
                    \(A = \frac{1}{2}\int_0^{2\pi} a^2 \, d\theta\)
                </div>
                <div class="step-box">
                    \(= \frac{1}{2} \cdot a^2 \cdot [\theta]_0^{2\pi}\)
                </div>
                <div class="step-box">
                    \(= \frac{1}{2} \cdot a^2 \cdot 2\pi = \pi a^2\)
                </div>
                <div class="result-box">Circle area = πa². It works!</div>
            </div>
        </div>

        <!-- Slide 9: Example 2 - Cardioid Setup -->
        <div class="slide slide-visual" data-slide="9" data-section="Examples" data-title="Cardioid Setup">
            <div class="slide-content">
                <h2>Area Inside a Cardioid</h2>
                <div id="cardioid-area-viz" class="visualization"></div>
                <p style="font-size: 1.4rem;">Given: \(r = 1 + \cos\theta\)</p>
                <p style="font-size: 1.3rem; color: var(--text-secondary);">Bounds: \(\theta\) from \(0\) to \(2\pi\) (curve traced once)</p>
                <div class="step-box highlight">
                    \(A = \frac{1}{2}\int_0^{2\pi} (1 + \cos\theta)^2 \, d\theta\)
                </div>
                <p class="caption">First step: expand the integrand</p>
            </div>
        </div>

        <!-- Slide 10: Cardioid Calculation -->
        <div class="slide slide-example" data-slide="10" data-section="Examples" data-title="Cardioid Calculation">
            <div class="slide-content">
                <h2>Cardioid Area: The Calculation</h2>
                <div class="step-box">
                    Expand: \((1 + \cos\theta)^2 = 1 + 2\cos\theta + \cos^2\theta\)
                </div>
                <div class="identity-box">
                    Use identity: <span class="identity">\(\cos^2\theta = \frac{1 + \cos(2\theta)}{2}\)</span>
                </div>
                <div class="step-box">
                    \(= \frac{3}{2} + 2\cos\theta + \frac{1}{2}\cos(2\theta)\)
                </div>
                <div class="step-box">
                    Integrate: \(\left[\frac{3\theta}{2} + 2\sin\theta + \frac{1}{4}\sin(2\theta)\right]_0^{2\pi} = 3\pi\)
                </div>
                <div class="result-box">A = (1/2)(3π) = 3π/2</div>
            </div>
        </div>

        <!-- Slide 11: Cardioid Visualization -->
        <div class="slide slide-visual" data-slide="11" data-section="Examples" data-title="Cardioid Animation">
            <div class="slide-content">
                <h2>Cardioid Area = 3π/2</h2>
                <div id="cardioid-fill-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>θ =</label>
                    <input type="range" id="theta-cardioid-slider" min="0" max="6.28" step="0.05" value="0">
                    <span class="value-display" id="theta-cardioid-display">θ = 0</span>
                    <span class="value-display" id="cardioid-area-display">Area = 0.00</span>
                </div>
                <p class="caption">Watch the area accumulate sector by sector</p>
            </div>
        </div>

        <!-- Slide 12: Example 3 - Rose Petal -->
        <div class="slide slide-visual" data-slide="12" data-section="Examples" data-title="Rose Petal">
            <div class="slide-content">
                <h2>Area of ONE Rose Petal</h2>
                <div id="rose-petal-viz" class="visualization"></div>
                <p style="font-size: 1.4rem;">Given: \(r = \sin(2\theta)\)</p>
                <p style="font-size: 1.25rem; color: var(--text-secondary);">
                    \(r = 0\) when \(\sin(2\theta) = 0\), so \(\theta = 0, \frac{\pi}{2}, \pi, ...\)
                </p>
                <p style="font-size: 1.25rem; color: var(--theme-color);">First petal: \(\theta\) from \(0\) to \(\frac{\pi}{2}\)</p>
            </div>
        </div>

        <!-- Slide 13: Rose Petal Calculation -->
        <div class="slide slide-example" data-slide="13" data-section="Examples" data-title="Rose Calculation">
            <div class="slide-content">
                <h2>Rose Petal Area</h2>
                <div class="step-box">
                    \(A = \frac{1}{2}\int_0^{\pi/2} \sin^2(2\theta) \, d\theta\)
                </div>
                <div class="identity-box">
                    Use identity: <span class="identity">\(\sin^2(u) = \frac{1 - \cos(2u)}{2}\)</span>
                </div>
                <div class="step-box">
                    \(= \frac{1}{4}\int_0^{\pi/2} (1 - \cos(4\theta)) \, d\theta\)
                </div>
                <div class="step-box">
                    \(= \frac{1}{4}\left[\theta - \frac{1}{4}\sin(4\theta)\right]_0^{\pi/2} = \frac{1}{4} \cdot \frac{\pi}{2} = \frac{\pi}{8}\)
                </div>
                <div class="result-box">One petal = π/8 &nbsp;|&nbsp; Total rose (4 petals) = π/2</div>
            </div>
        </div>

        <!-- Slide 14: Why Not 0 to 2π -->
        <div class="slide slide-statement" data-slide="14" data-section="Examples" data-title="Warning">
            <div class="slide-content">
                <p class="statement" style="color: var(--color-error);">Warning: Don't always integrate from 0 to 2π!</p>
                <div class="warning-box" style="max-width: 600px; margin: 2rem auto;">
                    <p>For roses, this may overcount or undercount</p>
                    <p>Find where one petal is traced, multiply by number of petals</p>
                    <p>Check: does negative r affect the region?</p>
                </div>
            </div>
        </div>

        <!-- Slide 15: Area Between Two Curves -->
        <div class="slide slide-statement" data-slide="15" data-section="Area Between Curves" data-title="Between Curves">
            <div class="slide-content">
                <p class="statement">What about the area <em>BETWEEN</em> two polar curves?</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.5rem;">Subtract inner from outer — but which is which?</p>
            </div>
        </div>

        <!-- Slide 16: Between Curves Formula -->
        <div class="slide slide-two-part" data-slide="16" data-section="Area Between Curves" data-title="Between Formula">
            <div class="slide-content">
                <p class="primary">The Formula</p>
                <p class="secondary" style="font-size: 1.3rem;">Outer curve: \(r_{outer}\) &nbsp;|&nbsp; Inner curve: \(r_{inner}\)</p>
                <div class="formula-box" style="margin: 1.5rem auto;">
                    <div class="formula">$$A = \frac{1}{2}\int_{\alpha}^{\beta} \left([r_{outer}]^2 - [r_{inner}]^2\right)\, d\theta$$</div>
                </div>
                <div style="margin-top: 1.5rem; border-top: 2px solid var(--bg-tertiary); padding-top: 1.5rem;">
                    <p style="font-size: 1.5rem; color: var(--theme-color); font-weight: 600;">Key Considerations</p>
                    <p style="font-size: 1.25rem; margin-top: 0.5rem;">Which curve is outer? Check at each θ!</p>
                    <p style="font-size: 1.25rem;">Find bounds: usually intersection points</p>
                    <p style="font-size: 1.25rem;">Curves may switch outer/inner roles</p>
                </div>
            </div>
        </div>

        <!-- Slide 17: Finding Intersections -->
        <div class="slide slide-two-part" data-slide="17" data-section="Area Between Curves" data-title="Intersections">
            <div class="slide-content">
                <p class="primary">Standard Method</p>
                <p class="secondary" style="font-size: 1.35rem; margin-top: 1rem;">Set \(r_1(\theta) = r_2(\theta)\)</p>
                <p class="secondary" style="font-size: 1.35rem;">Solve for θ values</p>
                <p class="secondary" style="font-size: 1.35rem;">These are the integration bounds</p>
                <div style="margin-top: 2rem; border-top: 2px solid var(--bg-tertiary); padding-top: 1.5rem;">
                    <p style="font-size: 1.5rem; color: var(--color-highlight); font-weight: 600;">Don't Forget the Origin!</p>
                    <p style="font-size: 1.25rem; margin-top: 0.5rem;">Both curves may pass through origin at DIFFERENT θ values</p>
                    <p style="font-size: 1.25rem;">Check: does either curve have r = 0?</p>
                    <p style="font-size: 1.25rem;">Origin intersections need special attention</p>
                </div>
            </div>
        </div>

        <!-- Slide 18: Between Curves Example Setup -->
        <div class="slide slide-visual" data-slide="18" data-section="Area Between Curves" data-title="Example Setup">
            <div class="slide-content">
                <h2>Example: Area Inside Circle, Outside Cardioid</h2>
                <div id="between-curves-viz" class="visualization"></div>
                <p style="font-size: 1.3rem;">Circle: \(r = 2\) &nbsp;|&nbsp; Cardioid: \(r = 2(1 - \cos\theta)\)</p>
                <p style="font-size: 1.25rem; color: var(--text-secondary);">
                    Intersections: \(2 = 2(1 - \cos\theta) \Rightarrow \cos\theta = 0 \Rightarrow \theta = \frac{\pi}{2}, \frac{3\pi}{2}\)
                </p>
            </div>
        </div>

        <!-- Slide 19: Determining Inner/Outer -->
        <div class="slide slide-visual" data-slide="19" data-section="Area Between Curves" data-title="Inner/Outer">
            <div class="slide-content">
                <h2>Which is Outer?</h2>
                <div id="inner-outer-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>θ =</label>
                    <input type="range" id="theta-check-slider" min="0" max="6.28" step="0.05" value="0">
                    <span class="value-display" id="theta-check-display">θ = 0</span>
                </div>
                <p style="font-size: 1.25rem; margin-top: 0.5rem;">
                    At θ = 0: circle r = 2, cardioid r = 0 → <span style="color: var(--color-function);">circle is outer</span>
                </p>
            </div>
        </div>

        <!-- Slide 20: Between Curves Calculation -->
        <div class="slide slide-example" data-slide="20" data-section="Area Between Curves" data-title="Between Calculation">
            <div class="slide-content">
                <h2>Setting Up the Integral</h2>
                <p style="font-size: 1.3rem; margin-bottom: 1rem;">Region: \(\theta \in [-\frac{\pi}{2}, \frac{\pi}{2}]\), circle outer, cardioid inner</p>
                <div class="step-box">
                    \(A = \frac{1}{2}\int_{-\pi/2}^{\pi/2} \left[4 - 4(1 - \cos\theta)^2\right] d\theta\)
                </div>
                <div class="step-box">
                    Use symmetry: integrand is even
                </div>
                <div class="step-box highlight">
                    \(A = 2 \cdot \frac{1}{2}\int_0^{\pi/2} \left[4 - 4(1 - \cos\theta)^2\right] d\theta\)
                </div>
                <p class="caption" style="color: var(--theme-color);">Complete this calculation for practice!</p>
            </div>
        </div>

        <!-- Slide 21: Area Accumulation Visualization -->
        <div class="slide slide-visual" data-slide="21" data-section="Visualization" data-title="Accumulation">
            <div class="slide-content">
                <h2>Watching Area Accumulate</h2>
                <div class="curve-selector">
                    <button class="curve-btn active" data-curve="circle">Circle</button>
                    <button class="curve-btn" data-curve="cardioid">Cardioid</button>
                    <button class="curve-btn" data-curve="rose">Rose (4)</button>
                    <button class="curve-btn" data-curve="limacon">Limaçon</button>
                </div>
                <div id="accumulator-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>θ =</label>
                    <input type="range" id="theta-accum-slider" min="0" max="6.28" step="0.02" value="0">
                    <span class="value-display" id="theta-accum-display">θ = 0</span>
                    <span class="value-display" id="accum-area-display">Area = 0.00</span>
                </div>
            </div>
        </div>

        <!-- Slide 22: Common Errors -->
        <div class="slide slide-list" data-slide="22" data-section="Summary" data-title="Common Errors">
            <div class="slide-content">
                <h2>Common Errors on AP Exam</h2>
                <ul>
                    <li>Forgetting the <strong style="color: var(--theme-color);">1/2 factor</strong></li>
                    <li>Forgetting to <strong style="color: var(--color-highlight);">square r</strong></li>
                    <li>Using <strong>r values</strong> as bounds instead of <strong style="color: var(--color-success);">θ values</strong></li>
                    <li>Integrating 0 to 2π for a rose (overcounting)</li>
                    <li>Not checking which curve is outer/inner</li>
                    <li>Missing intersection at origin</li>
                </ul>
            </div>
        </div>

        <!-- Slide 23: Practice Problem -->
        <div class="slide slide-exercise" data-slide="23" data-section="Practice" data-title="Practice">
            <div class="slide-content">
                <h2>Your Turn</h2>
                <div class="prompt">
                    <p style="font-size: 1.5rem;">Set up (don't evaluate) the integral for the area inside \(r = \sin\theta\)</p>
                </div>
                <div class="instructions" style="text-align: left; max-width: 600px; margin: 1.5rem auto;">
                    <p style="font-size: 1.35rem; padding: 0.5rem 0;">a) Sketch the curve</p>
                    <p style="font-size: 1.35rem; padding: 0.5rem 0;">b) Determine the correct bounds</p>
                    <p style="font-size: 1.35rem; padding: 0.5rem 0;">c) Write the complete integral</p>
                </div>
                <p style="font-size: 1.25rem; color: var(--text-tertiary); margin-top: 1rem;">Time: 3 minutes</p>
                <p style="font-size: 1.25rem; color: var(--theme-color);">Hint: This is a circle of diameter 1</p>
            </div>
        </div>

        <!-- Slide 24: Practice Solution -->
        <div class="slide slide-example" data-slide="24" data-section="Practice" data-title="Solution">
            <div class="slide-content">
                <h2>Solution</h2>
                <div class="step-box">
                    a) Circle through origin, center at \((0, \frac{1}{2})\), diameter 1
                </div>
                <div class="step-box">
                    b) \(r = \sin\theta = 0\) at \(\theta = 0\) and \(\theta = \pi\)
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;Curve traced for \(\theta \in [0, \pi]\)
                </div>
                <div class="step-box highlight">
                    c) \(A = \frac{1}{2}\int_0^{\pi} \sin^2\theta \, d\theta\)
                </div>
                <p style="font-size: 1.25rem; color: var(--color-success); margin-top: 1rem;">
                    Verification: This equals \(\frac{\pi}{4}\), which is \(\pi \cdot (\frac{1}{2})^2\) for a circle of radius \(\frac{1}{2}\)
                </p>
            </div>
        </div>

        <!-- Slide 25: Key Formulas Summary -->
        <div class="slide slide-comparison" data-slide="25" data-section="Summary" data-title="Formulas">
            <div class="slide-content">
                <h2>Polar Area Formulas</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">Single Curve</h3>
                        <div style="font-size: 1.5rem; margin: 1rem 0;">$$A = \frac{1}{2}\int_{\alpha}^{\beta} r^2\, d\theta$$</div>
                        <p style="font-size: 1.25rem;">Bounds are angles</p>
                        <p style="font-size: 1.25rem;">Don't forget 1/2 and r²</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--color-highlight);">Between Two Curves</h3>
                        <div style="font-size: 1.4rem; margin: 1rem 0;">$$A = \frac{1}{2}\int_{\alpha}^{\beta} \left(r_{out}^2 - r_{in}^2\right) d\theta$$</div>
                        <p style="font-size: 1.25rem;">Identify outer and inner at each θ</p>
                        <p style="font-size: 1.25rem;">Find intersections for bounds</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 26: Key Takeaways -->
        <div class="slide slide-list" data-slide="26" data-section="Summary" data-title="Takeaways">
            <div class="slide-content">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Polar area uses <strong style="color: var(--theme-color);">SECTORS</strong>, not rectangles: \(dA = \frac{1}{2}r^2 \, d\theta\)</li>
                    <li>The formula: \(A = \frac{1}{2}\int r^2 \, d\theta\)</li>
                    <li>Bounds are <strong style="color: var(--color-success);">ANGLE values</strong> (where region starts/ends)</li>
                    <li>Between curves: \(\frac{1}{2}\int (r_{outer}^2 - r_{inner}^2) \, d\theta\)</li>
                    <li>Check intersections at \(r_1 = r_2\) AND at origin</li>
                    <li>Use symmetry to simplify calculations</li>
                </ul>
            </div>
        </div>

        <!-- Slide 27: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="27" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p style="font-size: 1.5rem;">Find the area of one petal of \(r = \cos(2\theta)\)</p>
                </div>
                <div class="instructions" style="text-align: left; max-width: 600px; margin: 1.5rem auto;">
                    <p style="font-size: 1.3rem; padding: 0.5rem 0;">1. Identify the bounds for one petal</p>
                    <p style="font-size: 1.3rem; padding: 0.5rem 0;">2. Set up the integral</p>
                    <p style="font-size: 1.3rem; padding: 0.5rem 0;">3. Use the identity \(\cos^2(u) = \frac{1 + \cos(2u)}{2}\)</p>
                    <p style="font-size: 1.3rem; padding: 0.5rem 0;">4. Evaluate</p>
                </div>
            </div>
        </div>

        <!-- Slide 28: Unit 9 Complete -->
        <div class="slide slide-statement" data-slide="28" data-section="Closing" data-title="Unit Complete">
            <div class="slide-content">
                <p class="statement" style="color: var(--theme-color);">Unit 9 Complete!</p>
                <p class="secondary" style="margin-top: 1rem; font-size: 1.6rem;">Parametric, Polar, and Vector-Valued Functions</p>
                <p class="secondary" style="margin-top: 2rem; font-size: 1.4rem; color: var(--text-tertiary);">Next: Unit 10 — Infinite Series</p>
                <p class="secondary" style="font-size: 1.3rem; color: var(--color-highlight);">"Sums that go on forever... yet can have finite values"</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 29</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>←</kbd> <kbd>→</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 54: Area in Polar Coordinates</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">← Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">← Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next →</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // ===== Polar Utility Functions =====
        function polarToCartesian(r, theta) {
            return {
                x: r * Math.cos(theta),
                y: r * Math.sin(theta)
            };
        }

        function generatePolarPath(rFunc, thetaStart, thetaEnd, steps = 200) {
            const points = [];
            const dTheta = (thetaEnd - thetaStart) / steps;
            for (let i = 0; i <= steps; i++) {
                const theta = thetaStart + i * dTheta;
                const r = rFunc(theta);
                if (r >= 0) {
                    const pt = polarToCartesian(r, theta);
                    points.push(pt);
                }
            }
            return points;
        }

        // ===== Visualization 1: Cardioid Introduction =====
        function drawCardioidIntro() {
            const container = document.getElementById('cardioid-intro-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 350;
            const cx = width / 2 + 50;
            const cy = height / 2;
            const scale = 80;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Draw axes
            svg.append('line')
                .attr('x1', 50).attr('y1', cy)
                .attr('x2', width - 30).attr('y2', cy)
                .attr('stroke', '#475569').attr('stroke-width', 1);
            svg.append('line')
                .attr('x1', cx).attr('y1', 30)
                .attr('x2', cx).attr('y2', height - 30)
                .attr('stroke', '#475569').attr('stroke-width', 1);

            // Cardioid: r = 1 + cos(theta)
            const cardioidFunc = theta => 1 + Math.cos(theta);
            const points = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);

            // Draw filled region
            const areaPath = d3.line()
                .x(d => cx + d.x * scale)
                .y(d => cy - d.y * scale)
                .curve(d3.curveLinearClosed);

            svg.append('path')
                .datum(points)
                .attr('d', areaPath)
                .attr('fill', 'rgba(8, 145, 178, 0.3)')
                .attr('stroke', '#0891b2')
                .attr('stroke-width', 3);

            // Label
            svg.append('text')
                .attr('x', cx + 1.5 * scale)
                .attr('y', cy - 60)
                .attr('font-size', '1.25rem')
                .attr('fill', '#0891b2')
                .text('r = 1 + cos θ');

            // Question mark for area
            svg.append('text')
                .attr('x', cx - 0.5 * scale)
                .attr('y', cy)
                .attr('font-size', '2rem')
                .attr('fill', '#f97316')
                .attr('text-anchor', 'middle')
                .text('A = ?');
        }

        // ===== Visualization 2: Sector Area Demo =====
        function drawSectorArea() {
            const container = document.getElementById('sector-area-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 450;
            const height = 300;
            const cx = width / 2;
            const cy = height / 2;
            const radius = 100;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            // Full circle outline
            svg.append('circle')
                .attr('cx', cx).attr('cy', cy)
                .attr('r', radius)
                .attr('fill', 'none')
                .attr('stroke', '#475569')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');

            // Sector (example: θ = π/3)
            const theta = Math.PI / 3;
            const arcGen = d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
                .startAngle(-Math.PI / 2)
                .endAngle(-Math.PI / 2 + theta);

            svg.append('path')
                .attr('d', arcGen)
                .attr('transform', `translate(${cx}, ${cy})`)
                .attr('fill', 'rgba(8, 145, 178, 0.4)')
                .attr('stroke', '#0891b2')
                .attr('stroke-width', 2);

            // Radius lines
            svg.append('line')
                .attr('x1', cx).attr('y1', cy)
                .attr('x2', cx).attr('y2', cy - radius)
                .attr('stroke', '#0891b2').attr('stroke-width', 2);

            const endX = cx + radius * Math.sin(theta);
            const endY = cy - radius * Math.cos(theta);
            svg.append('line')
                .attr('x1', cx).attr('y1', cy)
                .attr('x2', endX).attr('y2', endY)
                .attr('stroke', '#0891b2').attr('stroke-width', 2);

            // Labels
            svg.append('text')
                .attr('x', cx + 30)
                .attr('y', cy - radius / 2 - 10)
                .attr('font-size', '1.25rem')
                .attr('fill', '#60a5fa')
                .text('r');

            svg.append('text')
                .attr('x', cx + 15)
                .attr('y', cy - 30)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .text('θ');

            // Arc indicator
            const arcIndicator = d3.arc()
                .innerRadius(30)
                .outerRadius(32)
                .startAngle(-Math.PI / 2)
                .endAngle(-Math.PI / 2 + theta);

            svg.append('path')
                .attr('d', arcIndicator)
                .attr('transform', `translate(${cx}, ${cy})`)
                .attr('fill', '#f97316');
        }

        // ===== Visualization 3: Sector Approximation =====
        function drawSectorApprox() {
            const container = document.getElementById('sector-approx-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 350;
            const cx = width / 2 + 50;
            const cy = height / 2;
            const scale = 70;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const cardioidFunc = theta => 1 + Math.cos(theta);
            const trueArea = 3 * Math.PI / 2;

            function update(n) {
                svg.selectAll('.sector').remove();
                svg.selectAll('.curve').remove();
                svg.selectAll('.axis').remove();

                // Draw axes
                svg.append('line').attr('class', 'axis')
                    .attr('x1', 30).attr('y1', cy)
                    .attr('x2', width - 30).attr('y2', cy)
                    .attr('stroke', '#475569').attr('stroke-width', 1);

                // Draw sectors
                const dTheta = 2 * Math.PI / n;
                let totalArea = 0;

                for (let i = 0; i < n; i++) {
                    const theta = i * dTheta;
                    const r = cardioidFunc(theta + dTheta / 2);
                    const sectorArea = 0.5 * r * r * dTheta;
                    totalArea += sectorArea;

                    const arcGen = d3.arc()
                        .innerRadius(0)
                        .outerRadius(r * scale)
                        .startAngle(theta - Math.PI / 2)
                        .endAngle(theta + dTheta - Math.PI / 2);

                    svg.append('path')
                        .attr('class', 'sector')
                        .attr('d', arcGen)
                        .attr('transform', `translate(${cx}, ${cy})`)
                        .attr('fill', i % 2 === 0 ? 'rgba(8, 145, 178, 0.5)' : 'rgba(8, 145, 178, 0.3)')
                        .attr('stroke', '#0891b2')
                        .attr('stroke-width', 1);
                }

                // Draw actual curve
                const points = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);
                const linePath = d3.line()
                    .x(d => cx + d.x * scale)
                    .y(d => cy - d.y * scale);

                svg.append('path')
                    .attr('class', 'curve')
                    .datum(points)
                    .attr('d', linePath)
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 2);

                // Update displays
                document.getElementById('n-display').textContent = `n = ${n}`;
                document.getElementById('area-display').textContent = `Area ≈ ${totalArea.toFixed(3)} (True: ${trueArea.toFixed(3)})`;
            }

            update(8);

            document.getElementById('n-slider').addEventListener('input', function(e) {
                update(parseInt(e.target.value));
            });
        }

        // ===== Visualization 4: Cardioid Area with shading =====
        function drawCardioidArea() {
            const container = document.getElementById('cardioid-area-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 450;
            const height = 300;
            const cx = width / 2 + 40;
            const cy = height / 2;
            const scale = 70;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const cardioidFunc = theta => 1 + Math.cos(theta);
            const points = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);

            const areaPath = d3.line()
                .x(d => cx + d.x * scale)
                .y(d => cy - d.y * scale)
                .curve(d3.curveLinearClosed);

            svg.append('path')
                .datum(points)
                .attr('d', areaPath)
                .attr('fill', 'rgba(8, 145, 178, 0.4)')
                .attr('stroke', '#0891b2')
                .attr('stroke-width', 3);

            // Mark bounds
            svg.append('text')
                .attr('x', cx + 2.2 * scale)
                .attr('y', cy + 5)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .text('θ = 0');

            svg.append('text')
                .attr('x', cx - 20)
                .attr('y', cy - 10)
                .attr('font-size', '1.25rem')
                .attr('fill', '#0891b2')
                .text('Origin');
        }

        // ===== Visualization 5: Cardioid Fill Animation =====
        function drawCardioidFill() {
            const container = document.getElementById('cardioid-fill-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 300;
            const cx = width / 2 + 50;
            const cy = height / 2;
            const scale = 60;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const cardioidFunc = theta => 1 + Math.cos(theta);

            function update(maxTheta) {
                svg.selectAll('*').remove();

                // Draw axes
                svg.append('line')
                    .attr('x1', 30).attr('y1', cy)
                    .attr('x2', width - 30).attr('y2', cy)
                    .attr('stroke', '#475569').attr('stroke-width', 1);

                // Draw filled region up to maxTheta
                if (maxTheta > 0.01) {
                    const fillPoints = [{x: 0, y: 0}];
                    const steps = Math.max(50, Math.floor(maxTheta * 30));
                    for (let i = 0; i <= steps; i++) {
                        const theta = (i / steps) * maxTheta;
                        const r = cardioidFunc(theta);
                        fillPoints.push(polarToCartesian(r, theta));
                    }
                    fillPoints.push({x: 0, y: 0});

                    const fillPath = d3.line()
                        .x(d => cx + d.x * scale)
                        .y(d => cy - d.y * scale);

                    svg.append('path')
                        .datum(fillPoints)
                        .attr('d', fillPath)
                        .attr('fill', 'rgba(8, 145, 178, 0.5)')
                        .attr('stroke', 'none');
                }

                // Draw full curve outline
                const curvePoints = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);
                const curvePath = d3.line()
                    .x(d => cx + d.x * scale)
                    .y(d => cy - d.y * scale);

                svg.append('path')
                    .datum(curvePoints)
                    .attr('d', curvePath)
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 2);

                // Current radius line
                const currentR = cardioidFunc(maxTheta);
                const endPt = polarToCartesian(currentR, maxTheta);
                svg.append('line')
                    .attr('x1', cx).attr('y1', cy)
                    .attr('x2', cx + endPt.x * scale).attr('y2', cy - endPt.y * scale)
                    .attr('stroke', '#f97316')
                    .attr('stroke-width', 2);

                // Calculate area
                const area = 0.5 * integrate(theta => Math.pow(cardioidFunc(theta), 2), 0, maxTheta, 100);

                document.getElementById('theta-cardioid-display').textContent = `θ = ${maxTheta.toFixed(2)}`;
                document.getElementById('cardioid-area-display').textContent = `Area = ${area.toFixed(3)}`;
            }

            function integrate(f, a, b, n) {
                const dx = (b - a) / n;
                let sum = 0;
                for (let i = 0; i < n; i++) {
                    sum += f(a + (i + 0.5) * dx) * dx;
                }
                return sum;
            }

            update(0);

            document.getElementById('theta-cardioid-slider').addEventListener('input', function(e) {
                update(parseFloat(e.target.value));
            });
        }

        // ===== Visualization 6: Rose Petal =====
        function drawRosePetal() {
            const container = document.getElementById('rose-petal-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 450;
            const height = 300;
            const cx = width / 2;
            const cy = height / 2;
            const scale = 120;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const roseFunc = theta => Math.sin(2 * theta);

            // Draw axes
            svg.append('line')
                .attr('x1', 30).attr('y1', cy)
                .attr('x2', width - 30).attr('y2', cy)
                .attr('stroke', '#475569').attr('stroke-width', 1);
            svg.append('line')
                .attr('x1', cx).attr('y1', 30)
                .attr('x2', cx).attr('y2', height - 30)
                .attr('stroke', '#475569').attr('stroke-width', 1);

            // Draw first petal (highlighted)
            const petalPoints = [{x: 0, y: 0}];
            for (let theta = 0; theta <= Math.PI / 2; theta += 0.02) {
                const r = Math.max(0, roseFunc(theta));
                petalPoints.push(polarToCartesian(r, theta));
            }
            petalPoints.push({x: 0, y: 0});

            const petalPath = d3.line()
                .x(d => cx + d.x * scale)
                .y(d => cy - d.y * scale);

            svg.append('path')
                .datum(petalPoints)
                .attr('d', petalPath)
                .attr('fill', 'rgba(8, 145, 178, 0.5)')
                .attr('stroke', '#0891b2')
                .attr('stroke-width', 2);

            // Draw full rose (outline only for other petals)
            for (let petal = 1; petal < 4; petal++) {
                const startTheta = petal * Math.PI / 2;
                const otherPoints = [];
                for (let i = 0; i <= 50; i++) {
                    const theta = startTheta + (i / 50) * Math.PI / 2;
                    const r = Math.abs(roseFunc(theta));
                    otherPoints.push(polarToCartesian(r, theta));
                }

                svg.append('path')
                    .datum(otherPoints)
                    .attr('d', d3.line().x(d => cx + d.x * scale).y(d => cy - d.y * scale))
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '4,4');
            }

            // Bound markers
            svg.append('text')
                .attr('x', cx + scale + 10)
                .attr('y', cy + 20)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .text('θ = 0');

            svg.append('text')
                .attr('x', cx + 10)
                .attr('y', cy - scale - 10)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .text('θ = π/2');
        }

        // ===== Visualization 7: Between Curves =====
        function drawBetweenCurves() {
            const container = document.getElementById('between-curves-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 350;
            const cx = width / 2;
            const cy = height / 2;
            const scale = 50;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const circleFunc = theta => 2;
            const cardioidFunc = theta => 2 * (1 - Math.cos(theta));

            // Draw axes
            svg.append('line')
                .attr('x1', 30).attr('y1', cy)
                .attr('x2', width - 30).attr('y2', cy)
                .attr('stroke', '#475569').attr('stroke-width', 1);
            svg.append('line')
                .attr('x1', cx).attr('y1', 30)
                .attr('x2', cx).attr('y2', height - 30)
                .attr('stroke', '#475569').attr('stroke-width', 1);

            // Shaded region (between curves from -π/2 to π/2)
            const regionPoints = [];
            // Outer (circle) from -π/2 to π/2
            for (let theta = -Math.PI / 2; theta <= Math.PI / 2; theta += 0.05) {
                regionPoints.push(polarToCartesian(circleFunc(theta), theta));
            }
            // Inner (cardioid) from π/2 to -π/2
            for (let theta = Math.PI / 2; theta >= -Math.PI / 2; theta -= 0.05) {
                regionPoints.push(polarToCartesian(cardioidFunc(theta), theta));
            }

            const regionPath = d3.line()
                .x(d => cx + d.x * scale)
                .y(d => cy - d.y * scale)
                .curve(d3.curveLinearClosed);

            svg.append('path')
                .datum(regionPoints)
                .attr('d', regionPath)
                .attr('fill', 'rgba(8, 145, 178, 0.4)')
                .attr('stroke', 'none');

            // Draw circle
            svg.append('circle')
                .attr('cx', cx).attr('cy', cy)
                .attr('r', 2 * scale)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 2);

            // Draw cardioid
            const cardioidPoints = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);
            const curvePath = d3.line()
                .x(d => cx + d.x * scale)
                .y(d => cy - d.y * scale);

            svg.append('path')
                .datum(cardioidPoints)
                .attr('d', curvePath)
                .attr('fill', 'none')
                .attr('stroke', '#a855f7')
                .attr('stroke-width', 2);

            // Intersection points
            const int1 = polarToCartesian(2, Math.PI / 2);
            const int2 = polarToCartesian(2, -Math.PI / 2);

            svg.append('circle')
                .attr('cx', cx + int1.x * scale).attr('cy', cy - int1.y * scale)
                .attr('r', 6).attr('fill', '#f97316');
            svg.append('circle')
                .attr('cx', cx + int2.x * scale).attr('cy', cy - int2.y * scale)
                .attr('r', 6).attr('fill', '#f97316');

            // Labels
            svg.append('text')
                .attr('x', cx + 2.2 * scale)
                .attr('y', cy - 20)
                .attr('font-size', '1.25rem')
                .attr('fill', '#60a5fa')
                .text('r = 2');

            svg.append('text')
                .attr('x', cx - 3 * scale)
                .attr('y', cy + 20)
                .attr('font-size', '1.1rem')
                .attr('fill', '#a855f7')
                .text('r = 2(1-cosθ)');
        }

        // ===== Visualization 8: Inner/Outer Check =====
        function drawInnerOuter() {
            const container = document.getElementById('inner-outer-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 300;
            const cx = width / 2;
            const cy = height / 2;
            const scale = 45;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const circleFunc = theta => 2;
            const cardioidFunc = theta => 2 * (1 - Math.cos(theta));

            function update(theta) {
                svg.selectAll('*').remove();

                // Draw axes
                svg.append('line')
                    .attr('x1', 30).attr('y1', cy)
                    .attr('x2', width - 30).attr('y2', cy)
                    .attr('stroke', '#475569').attr('stroke-width', 1);
                svg.append('line')
                    .attr('x1', cx).attr('y1', 30)
                    .attr('x2', cx).attr('y2', height - 30)
                    .attr('stroke', '#475569').attr('stroke-width', 1);

                // Draw circle
                svg.append('circle')
                    .attr('cx', cx).attr('cy', cy)
                    .attr('r', 2 * scale)
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 2);

                // Draw cardioid
                const cardioidPoints = generatePolarPath(cardioidFunc, 0, 2 * Math.PI);
                svg.append('path')
                    .datum(cardioidPoints)
                    .attr('d', d3.line().x(d => cx + d.x * scale).y(d => cy - d.y * scale))
                    .attr('fill', 'none')
                    .attr('stroke', '#a855f7')
                    .attr('stroke-width', 2);

                // Current angle ray
                const rCircle = circleFunc(theta);
                const rCardioid = cardioidFunc(theta);
                const ptCircle = polarToCartesian(rCircle, theta);
                const ptCardioid = polarToCartesian(rCardioid, theta);

                // Ray from origin
                svg.append('line')
                    .attr('x1', cx).attr('y1', cy)
                    .attr('x2', cx + Math.max(rCircle, rCardioid) * 1.1 * scale * Math.cos(theta))
                    .attr('y2', cy - Math.max(rCircle, rCardioid) * 1.1 * scale * Math.sin(theta))
                    .attr('stroke', '#f97316')
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '5,5');

                // Points on curves
                svg.append('circle')
                    .attr('cx', cx + ptCircle.x * scale)
                    .attr('cy', cy - ptCircle.y * scale)
                    .attr('r', 6)
                    .attr('fill', '#60a5fa');

                svg.append('circle')
                    .attr('cx', cx + ptCardioid.x * scale)
                    .attr('cy', cy - ptCardioid.y * scale)
                    .attr('r', 6)
                    .attr('fill', '#a855f7');

                // Labels showing which is outer
                const isCircleOuter = rCircle > rCardioid;
                svg.append('text')
                    .attr('x', 20)
                    .attr('y', 30)
                    .attr('font-size', '1.25rem')
                    .attr('fill', '#60a5fa')
                    .text(`Circle r = ${rCircle.toFixed(2)}`);

                svg.append('text')
                    .attr('x', 20)
                    .attr('y', 55)
                    .attr('font-size', '1.25rem')
                    .attr('fill', '#a855f7')
                    .text(`Cardioid r = ${rCardioid.toFixed(2)}`);

                svg.append('text')
                    .attr('x', 20)
                    .attr('y', 85)
                    .attr('font-size', '1.25rem')
                    .attr('fill', isCircleOuter ? '#60a5fa' : '#a855f7')
                    .attr('font-weight', '600')
                    .text(`Outer: ${isCircleOuter ? 'Circle' : 'Cardioid'}`);

                document.getElementById('theta-check-display').textContent = `θ = ${theta.toFixed(2)}`;
            }

            update(0);

            document.getElementById('theta-check-slider').addEventListener('input', function(e) {
                update(parseFloat(e.target.value));
            });
        }

        // ===== Visualization 9: Area Accumulator =====
        function drawAccumulator() {
            const container = document.getElementById('accumulator-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 500;
            const height = 300;
            const cx = width / 2;
            const cy = height / 2;
            const scale = 80;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const curves = {
                circle: { func: theta => 1, maxTheta: 2 * Math.PI, name: 'Circle' },
                cardioid: { func: theta => 1 + Math.cos(theta), maxTheta: 2 * Math.PI, name: 'Cardioid' },
                rose: { func: theta => Math.sin(2 * theta), maxTheta: 2 * Math.PI, name: 'Rose' },
                limacon: { func: theta => 1 + 0.5 * Math.cos(theta), maxTheta: 2 * Math.PI, name: 'Limaçon' }
            };

            let currentCurve = 'circle';

            function integrate(f, a, b, n) {
                if (b <= a) return 0;
                const dx = (b - a) / n;
                let sum = 0;
                for (let i = 0; i < n; i++) {
                    const r = f(a + (i + 0.5) * dx);
                    sum += r * r * dx;
                }
                return 0.5 * sum;
            }

            function update(maxTheta) {
                svg.selectAll('*').remove();

                const curve = curves[currentCurve];
                const rFunc = curve.func;

                // Draw axes
                svg.append('line')
                    .attr('x1', 30).attr('y1', cy)
                    .attr('x2', width - 30).attr('y2', cy)
                    .attr('stroke', '#475569').attr('stroke-width', 1);
                svg.append('line')
                    .attr('x1', cx).attr('y1', 30)
                    .attr('x2', cx).attr('y2', height - 30)
                    .attr('stroke', '#475569').attr('stroke-width', 1);

                // Draw filled region
                if (maxTheta > 0.01) {
                    const fillPoints = [{x: 0, y: 0}];
                    const steps = Math.max(50, Math.floor(maxTheta * 30));
                    for (let i = 0; i <= steps; i++) {
                        const theta = (i / steps) * maxTheta;
                        const r = Math.abs(rFunc(theta));
                        fillPoints.push(polarToCartesian(r, theta));
                    }
                    fillPoints.push({x: 0, y: 0});

                    svg.append('path')
                        .datum(fillPoints)
                        .attr('d', d3.line().x(d => cx + d.x * scale).y(d => cy - d.y * scale))
                        .attr('fill', 'rgba(8, 145, 178, 0.5)')
                        .attr('stroke', 'none');
                }

                // Draw full curve
                const curvePoints = [];
                for (let theta = 0; theta <= curve.maxTheta; theta += 0.02) {
                    const r = Math.abs(rFunc(theta));
                    curvePoints.push(polarToCartesian(r, theta));
                }

                svg.append('path')
                    .datum(curvePoints)
                    .attr('d', d3.line().x(d => cx + d.x * scale).y(d => cy - d.y * scale))
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 2);

                // Current radius
                const currentR = Math.abs(rFunc(maxTheta));
                const endPt = polarToCartesian(currentR, maxTheta);
                svg.append('line')
                    .attr('x1', cx).attr('y1', cy)
                    .attr('x2', cx + endPt.x * scale).attr('y2', cy - endPt.y * scale)
                    .attr('stroke', '#f97316')
                    .attr('stroke-width', 2);

                // Calculate area
                const area = integrate(theta => Math.abs(rFunc(theta)), 0, maxTheta, 200);

                document.getElementById('theta-accum-display').textContent = `θ = ${maxTheta.toFixed(2)}`;
                document.getElementById('accum-area-display').textContent = `Area = ${area.toFixed(3)}`;
            }

            // Curve selector buttons
            document.querySelectorAll('.curve-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.curve-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCurve = this.dataset.curve;
                    update(parseFloat(document.getElementById('theta-accum-slider').value));
                });
            });

            update(0);

            document.getElementById('theta-accum-slider').addEventListener('input', function(e) {
                update(parseFloat(e.target.value));
            });
        }

        // ===== Trigger Visualizations on Slide Entry =====
        const visualizationSlides = {
            1: drawCardioidIntro,
            3: drawSectorArea,
            5: drawSectorApprox,
            9: drawCardioidArea,
            11: drawCardioidFill,
            12: drawRosePetal,
            18: drawBetweenCurves,
            19: drawInnerOuter,
            21: drawAccumulator
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;

            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        // Check periodically for slide changes (polling pattern)
        setInterval(checkAndDrawVisualization, 200);

        // Also check on hash changes
        window.addEventListener('hashchange', () => {
            setTimeout(checkAndDrawVisualization, 100);
        });

        // Initial check after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkAndDrawVisualization, 200);
            });
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }
    </script>
</body>
</html>
