<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class 0: Course Introduction | AP Calculus BC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <style>
        :root {
            --theme-color: #356093;
            --theme-color-light: #4a7ab8;
        }

        /* Custom styles for this presentation */
        .speed-trap-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin: 1rem 0;
        }

        .camera {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .camera-icon {
            width: 60px;
            height: 60px;
            background: var(--theme-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .road {
            flex: 1;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            position: relative;
        }

        .road::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 4px;
            background: repeating-linear-gradient(90deg, #fbbf24 0, #fbbf24 20px, transparent 20px, transparent 40px);
            transform: translateY(-50%);
        }

        .car {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
        }

        .big-ideas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .big-idea-card {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            border-top: 4px solid var(--theme-color);
        }

        .big-idea-card.change { border-color: #f97316; }
        .big-idea-card.limits { border-color: #356093; }
        .big-idea-card.analysis { border-color: #22c55e; }

        .big-idea-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .big-idea-card p {
            font-size: 1.25rem;
            color: var(--text-secondary);
        }

        .math-fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.5rem;
        }

        .math-fraction .numerator,
        .math-fraction .denominator {
            padding: 0.25rem 0.5rem;
        }

        .math-fraction .bar {
            width: 100%;
            height: 2px;
            background: var(--text-primary);
        }

        .slider-control {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .slider-control label {
            font-size: 1.25rem;
            font-family: var(--font-display);
        }

        .slider-control input[type="range"] {
            width: 300px;
            height: 8px;
            -webkit-appearance: none;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--theme-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .slope-display {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--accent-secondary);
            min-width: 150px;
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border-collapse: collapse;
            font-size: 1.25rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .data-table th {
            background: var(--bg-secondary);
            font-family: var(--font-display);
            font-weight: 600;
        }

        .data-table .highlight {
            color: var(--accent-secondary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 0: Title -->
        <div class="slide slide-title" data-slide="0" data-section="Opening" data-title="Course Introduction">
            <div class="slide-content">
                <div class="unit-badge">Unit 1: Limits and Continuity</div>
                <h1>AP Calculus BC</h1>
                <p class="subtitle">The Mathematics of Change</p>
                <p class="meta">Class 0 | February 2, 2026 | NCSSM</p>
            </div>
        </div>

        <!-- Slide 1: Central Question -->
        <div class="slide slide-statement" data-slide="1" data-section="Opening" data-title="The Central Question">
            <div class="slide-content">
                <p class="statement">Can change occur at an <em>instant</em>?</p>
            </div>
        </div>

        <!-- Slide 2: Speed Trap -->
        <div class="slide slide-visual" data-slide="2" data-section="The Problem" data-title="The Speed Trap">
            <div class="slide-content">
                <h2>The Speed Trap Problem</h2>
                <div class="speed-trap-diagram">
                    <div class="camera">
                        <div class="camera-icon">üì∑</div>
                        <span style="font-size: 1.25rem;">Camera A</span>
                        <span style="color: var(--text-tertiary);">10:00:00 AM</span>
                    </div>
                    <div class="road">
                        <span class="car">üöó</span>
                    </div>
                    <div class="camera">
                        <div class="camera-icon">üì∑</div>
                        <span style="font-size: 1.25rem;">Camera B</span>
                        <span style="color: var(--text-tertiary);">10:02:00 AM</span>
                    </div>
                </div>
                <p style="font-size: 1.5rem; margin-top: 1.5rem;">Distance: 2 miles | Time: 2 minutes | Speed limit: 25 mph</p>
                <p class="caption" style="font-size: 1.5rem; color: var(--accent-secondary); margin-top: 1rem;">Can we ticket this driver for speeding?</p>
            </div>
        </div>

        <!-- Slide 3: Average vs Instantaneous -->
        <div class="slide slide-comparison" data-slide="3" data-section="The Problem" data-title="Average vs Instantaneous">
            <div class="slide-content">
                <h2>Average Speed vs. Speed at an Instant</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--success);">Average Speed</h3>
                        <p style="font-size: 2rem; font-family: var(--font-mono); color: var(--success);">60 mph</p>
                        <p>2 miles √∑ 2 minutes = 60 mph</p>
                        <p style="margin-top: 1rem;">We can calculate this!</p>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--accent-secondary);">Speed at 10:01:00 AM</h3>
                        <p style="font-size: 2rem; font-family: var(--font-mono); color: var(--accent-secondary);">???</p>
                        <p>How do we find the speed at exactly one instant?</p>
                        <p style="margin-top: 1rem;">This is harder...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: The Definition Problem -->
        <div class="slide slide-two-part" data-slide="4" data-section="The Problem" data-title="The Definition Problem">
            <div class="slide-content">
                <p class="primary">Speed = Distance √∑ Time</p>
                <p class="secondary" style="margin-top: 2rem;">But at an instant...</p>
                <p class="secondary" style="margin-top: 1rem; color: var(--danger);">Distance traveled = 0</p>
                <p class="secondary">Time elapsed = 0</p>
            </div>
        </div>

        <!-- Slide 5: Division by Zero -->
        <div class="slide slide-statement" data-slide="5" data-section="The Problem" data-title="Division by Zero">
            <div class="slide-content">
                <div class="math-display" style="font-size: 3rem;">
                    Speed = <span class="math-fraction">
                        <span class="numerator">0</span>
                        <span class="bar"></span>
                        <span class="denominator">0</span>
                    </span> = <span style="color: var(--danger);">undefined</span>
                </div>
                <p class="statement" style="font-size: 2rem; margin-top: 2rem;">At an instant, we get 0/0. This is <em>undefined</em>.</p>
            </div>
        </div>

        <!-- Slide 6: The Solution -->
        <div class="slide slide-statement" data-slide="6" data-section="The Problem" data-title="The Solution">
            <div class="slide-content">
                <p class="statement">Calculus gives us a way to make sense of <em>instantaneous</em> change.</p>
            </div>
        </div>

        <!-- Slide 7: Interactive Secant to Tangent -->
        <div class="slide slide-visual" data-slide="7" data-section="The Problem" data-title="Secant to Tangent">
            <div class="slide-content">
                <h2>Approaching the Tangent Line</h2>
                <div id="secant-tangent-viz" class="visualization"></div>
                <div class="slider-control">
                    <label>Œîx =</label>
                    <input type="range" id="delta-slider" min="-1.5" max="1.5" step="0.01" value="1">
                    <span class="slope-display" id="slope-display">Slope: 3.00</span>
                </div>
                <p class="caption">Drag the slider to see how the secant line approaches the tangent line as Œîx ‚Üí 0</p>
            </div>
        </div>

        <!-- Slide 8: The Word Limit -->
        <div class="slide slide-two-part" data-slide="8" data-section="Big Ideas" data-title="The Limit">
            <div class="slide-content">
                <p class="primary" style="color: var(--theme-color);">The Limit</p>
                <p class="secondary">A mathematical way to describe <em>approaching</em> a value<br>without actually reaching it</p>
                <p class="secondary" style="margin-top: 2rem; color: var(--text-tertiary);">Limits let us handle "infinitely close" rigorously.</p>
            </div>
        </div>

        <!-- Slide 9: Big Ideas Overview -->
        <div class="slide slide-visual" data-slide="9" data-section="Big Ideas" data-title="The Three Big Ideas">
            <div class="slide-content">
                <h2>The Three Big Ideas of AP Calculus</h2>
                <div class="big-ideas-grid" style="margin-top: 2rem;">
                    <div class="big-idea-card change">
                        <h3 style="color: #f97316;">Change (CHA)</h3>
                        <p>Derivatives measure instantaneous rates; integrals measure accumulation</p>
                    </div>
                    <div class="big-idea-card limits">
                        <h3 style="color: #356093;">Limits (LIM)</h3>
                        <p>The foundation that makes derivatives and integrals mathematically precise</p>
                    </div>
                    <div class="big-idea-card analysis">
                        <h3 style="color: #22c55e;">Analysis (FUN)</h3>
                        <p>Using calculus to understand and draw conclusions about functions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: How It Connects -->
        <div class="slide slide-visual" data-slide="10" data-section="Big Ideas" data-title="How It Connects">
            <div class="slide-content">
                <h2>How It All Connects</h2>
                <div id="connections-viz" class="visualization"></div>
                <p class="caption">Limits are the foundation. Everything else builds on them.</p>
            </div>
        </div>

        <!-- Slide 11: The Journey -->
        <div class="slide slide-visual" data-slide="11" data-section="Course Overview" data-title="Your Journey">
            <div class="slide-content">
                <h2>Your Calculus Journey</h2>
                <div id="journey-viz" class="visualization"></div>
                <p class="caption">10 units, 64 classes, one powerful framework</p>
            </div>
        </div>

        <!-- Slide 12: BC vs AB -->
        <div class="slide slide-comparison" data-slide="12" data-section="Course Overview" data-title="BC vs AB">
            <div class="slide-content">
                <h2>AP Calculus BC = AB + More</h2>
                <div class="columns">
                    <div class="column">
                        <h3 style="color: var(--theme-color);">AB Topics (Units 1-8)</h3>
                        <ul style="list-style: none; margin-top: 1rem;">
                            <li style="padding: 0.5rem 0;">‚Ä¢ Limits and Continuity</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Derivatives and Applications</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Basic Integration</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Differential Equations</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Applications of Integration</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h3 style="color: var(--accent-secondary);">BC-Only (Units 9-10)</h3>
                        <ul style="list-style: none; margin-top: 1rem;">
                            <li style="padding: 0.5rem 0;">‚Ä¢ Advanced Integration Techniques</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Parametric Equations</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Polar Coordinates</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Vector-Valued Functions</li>
                            <li style="padding: 0.5rem 0;">‚Ä¢ Infinite Series</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Rule of Four -->
        <div class="slide slide-gnaw" data-slide="13" data-section="Course Overview" data-title="Rule of Four">
            <div class="slide-content">
                <h2>G.N.A.W. ‚Äî The Rule of Four</h2>
                <div class="quadrants">
                    <div class="quadrant graphical">
                        <h3>Graphically</h3>
                        <p style="color: var(--text-secondary); font-size: 1.25rem;">Visual representations, graphs, diagrams</p>
                    </div>
                    <div class="quadrant numerical">
                        <h3>Numerically</h3>
                        <p style="color: var(--text-secondary); font-size: 1.25rem;">Tables, calculations, approximations</p>
                    </div>
                    <div class="quadrant analytical">
                        <h3>Analytically</h3>
                        <p style="color: var(--text-secondary); font-size: 1.25rem;">Algebraic expressions, formulas, proofs</p>
                    </div>
                    <div class="quadrant verbal">
                        <h3>Verbally</h3>
                        <p style="color: var(--text-secondary); font-size: 1.25rem;">Written and spoken descriptions</p>
                    </div>
                </div>
                <p class="caption" style="margin-top: 1.5rem;">Every concept, four ways. This is how you truly understand.</p>
            </div>
        </div>

        <!-- Slide 14: AP Exam -->
        <div class="slide slide-list" data-slide="14" data-section="Course Overview" data-title="The AP Exam">
            <div class="slide-content">
                <h2>The AP Calculus BC Exam</h2>
                <ul>
                    <li><strong>Date:</strong> May 12, 2026</li>
                    <li><strong>Format:</strong> 45 Multiple Choice + 6 Free Response</li>
                    <li><strong>Duration:</strong> 3 hours 15 minutes</li>
                    <li><strong>Calculator:</strong> Some sections require, some prohibit</li>
                    <li><strong>Goal:</strong> Score of 4 or 5 ‚Üí 6-8 college credits</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: Resources -->
        <div class="slide slide-list" data-slide="15" data-section="Course Overview" data-title="Resources">
            <div class="slide-content">
                <h2>Your Resources</h2>
                <ul>
                    <li>Interactive presentations with visualizations</li>
                    <li>AP Classroom (practice questions & progress checks)</li>
                    <li>Desmos & GeoGebra (graphing & exploration)</li>
                    <li>3Blue1Brown, Professor Leonard, Khan Academy</li>
                    <li>Paul's Online Math Notes</li>
                </ul>
            </div>
        </div>

        <!-- Slide 16: Exploration -->
        <div class="slide slide-exercise" data-slide="16" data-section="Activity" data-title="Exploration">
            <div class="slide-content">
                <h2>Explore: The Secant Line Slope</h2>
                <div class="prompt">
                    <p>Open <strong>Desmos</strong> and investigate what happens to the secant line slope as Œîx approaches 0.</p>
                </div>
                <div class="instructions" style="text-align: left; max-width: 700px; margin: 1.5rem auto 0;">
                    <ol style="list-style-position: inside; font-size: 1.25rem;">
                        <li style="padding: 0.5rem 0;">Graph y = x¬≤</li>
                        <li style="padding: 0.5rem 0;">Create a slider for h (call it the "step size")</li>
                        <li style="padding: 0.5rem 0;">Calculate the slope between (1, 1) and (1+h, (1+h)¬≤)</li>
                        <li style="padding: 0.5rem 0;">Try different values of h: 1, 0.1, 0.01, 0.001</li>
                        <li style="padding: 0.5rem 0;">What pattern do you notice?</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Slide 17: Results -->
        <div class="slide slide-visual" data-slide="17" data-section="Activity" data-title="The Pattern">
            <div class="slide-content">
                <h2>What Did You Find?</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>h (Œîx)</th>
                                <th>Secant Slope</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1</td><td>3</td></tr>
                            <tr><td>0.1</td><td>2.1</td></tr>
                            <tr><td>0.01</td><td>2.01</td></tr>
                            <tr><td>0.001</td><td>2.001</td></tr>
                            <tr><td>0.0001</td><td>2.0001</td></tr>
                            <tr class="highlight"><td>‚Üí 0</td><td class="highlight">‚Üí 2</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="caption" style="margin-top: 1.5rem;">The slope approaches <strong style="color: var(--accent-secondary);">2</strong> as h approaches 0.<br>This is the <em>derivative</em> of f(x) = x¬≤ at x = 1.</p>
            </div>
        </div>

        <!-- Slide 18: Exit Ticket -->
        <div class="slide slide-exercise" data-slide="18" data-section="Closing" data-title="Exit Ticket">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="prompt">
                    <p>In your own words:</p>
                    <p style="margin-top: 1rem; font-size: 1.75rem; color: var(--accent-secondary);">Why can't we simply substitute t = 0 to find instantaneous velocity?</p>
                </div>
            </div>
        </div>

        <!-- Slide 19: Coming Up -->
        <div class="slide slide-statement" data-slide="19" data-section="Closing" data-title="Coming Up">
            <div class="slide-content">
                <p class="statement" style="font-size: 2.5rem;">Tomorrow: The formal definition of <em>limits</em> and the notation that makes all of this precise.</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <!-- Slide Counter -->
        <div class="slide-counter">1 / 20</div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> Navigate | <kbd>T</kbd> TOC | <kbd>S</kbd> Syllabus | <kbd>F</kbd> Fullscreen
        </div>

        <!-- Overlay Backdrop -->
        <div id="overlay-backdrop" class="overlay-backdrop"></div>

        <!-- TOC Overlay -->
        <div id="toc-overlay" class="toc-overlay">
            <button id="toc-close" class="toc-close">&times;</button>
            <div class="toc-header">
                <h3>Table of Contents</h3>
                <div class="class-info">Class 0: Course Introduction</div>
            </div>
            <div id="toc-content" class="toc-content"></div>
            <div class="toc-footer">
                <a href="../index.html">‚Üê Back to Course Syllabus</a>
            </div>
        </div>

        <!-- Appendix Overlay -->
        <div id="appendix-overlay" class="appendix-overlay">
            <div class="appendix-header">
                <h3>Appendix</h3>
                <button id="appendix-close" class="appendix-close">&times;</button>
            </div>
            <div id="appendix-content" class="appendix-content"></div>
            <div class="appendix-nav">
                <button id="appendix-prev" class="appendix-nav-btn">‚Üê Prev</button>
                <span id="appendix-counter" class="appendix-counter">1 / 1</span>
                <button id="appendix-next" class="appendix-nav-btn">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../shared/presentation.js"></script>
    <script>
        // ===== Secant to Tangent Visualization =====
        function drawSecantTangent() {
            const container = document.getElementById('secant-tangent-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 700;
            const height = 400;
            const margin = { top: 30, right: 40, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear().domain([-1, 4]).range([0, plotWidth]);
            const yScale = d3.scaleLinear().domain([-1, 10]).range([plotHeight, 0]);

            // Function
            const f = x => x * x;

            // Grid
            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.h')
                .data(d3.range(-1, 11, 1))
                .enter()
                .append('line')
                .attr('x1', 0)
                .attr('x2', plotWidth)
                .attr('y1', d => yScale(d))
                .attr('y2', d => yScale(d))
                .attr('stroke', '#1c2640')
                .attr('stroke-width', 1);

            g.append('g')
                .attr('class', 'grid')
                .selectAll('line.v')
                .data(d3.range(-1, 5, 1))
                .enter()
                .append('line')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', 0)
                .attr('y2', plotHeight)
                .attr('stroke', '#1c2640')
                .attr('stroke-width', 1);

            // Axes
            const xAxis = d3.axisBottom(xScale).tickSize(-plotHeight).ticks(5);
            const yAxis = d3.axisLeft(yScale).tickSize(-plotWidth).ticks(5);

            g.append('g')
                .attr('transform', `translate(0,${plotHeight})`)
                .call(xAxis)
                .selectAll('text')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6');

            g.append('g')
                .call(yAxis)
                .selectAll('text')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6');

            // Axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 5)
                .attr('text-anchor', 'middle')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6')
                .text('x');

            svg.append('text')
                .attr('x', 15)
                .attr('y', height / 2)
                .attr('text-anchor', 'middle')
                .attr('font-size', '1.25rem')
                .attr('fill', '#b8c4d6')
                .attr('transform', `rotate(-90, 15, ${height/2})`)
                .text('y');

            // Draw parabola
            const line = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(f(d)))
                .curve(d3.curveCatmullRom);

            const xValues = d3.range(-1, 4.1, 0.1);

            g.append('path')
                .datum(xValues)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Function label
            g.append('text')
                .attr('x', xScale(3.5))
                .attr('y', yScale(f(3.5)) - 15)
                .attr('font-size', '1.25rem')
                .attr('fill', '#60a5fa')
                .text('f(x) = x¬≤');

            // Fixed point A
            const pointA = { x: 1, y: f(1) };
            const pointACircle = g.append('circle')
                .attr('cx', xScale(pointA.x))
                .attr('cy', yScale(pointA.y))
                .attr('r', 8)
                .attr('fill', '#f97316');

            g.append('text')
                .attr('x', xScale(pointA.x) - 25)
                .attr('y', yScale(pointA.y) - 15)
                .attr('font-size', '1.25rem')
                .attr('fill', '#f97316')
                .text('A(1, 1)');

            // Moveable point B
            const pointBCircle = g.append('circle')
                .attr('r', 8)
                .attr('fill', '#a78bfa');

            const pointBLabel = g.append('text')
                .attr('font-size', '1.25rem')
                .attr('fill', '#a78bfa');

            // Secant line
            const secantLine = g.append('line')
                .attr('stroke', '#a78bfa')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '8,4');

            // Tangent line (visible when delta is small)
            const tangentLine = g.append('line')
                .attr('stroke', '#fbbf24')
                .attr('stroke-width', 3)
                .attr('opacity', 0);

            // Update function
            function update(deltaX) {
                if (Math.abs(deltaX) < 0.05) {
                    deltaX = deltaX >= 0 ? 0.05 : -0.05;
                }

                const bX = pointA.x + deltaX;
                const bY = f(bX);

                // Update point B
                pointBCircle
                    .attr('cx', xScale(bX))
                    .attr('cy', yScale(bY));

                pointBLabel
                    .attr('x', xScale(bX) + 10)
                    .attr('y', yScale(bY) - 10)
                    .text(`B(${bX.toFixed(2)}, ${bY.toFixed(2)})`);

                // Calculate slope
                const slope = (bY - pointA.y) / (bX - pointA.x);

                // Update slope display
                document.getElementById('slope-display').textContent = `Slope: ${slope.toFixed(3)}`;

                // Calculate line endpoints (extend beyond points)
                const lineXMin = -1;
                const lineXMax = 4;
                const lineYAtMin = pointA.y + slope * (lineXMin - pointA.x);
                const lineYAtMax = pointA.y + slope * (lineXMax - pointA.x);

                // Update secant line
                secantLine
                    .attr('x1', xScale(lineXMin))
                    .attr('y1', yScale(lineYAtMin))
                    .attr('x2', xScale(lineXMax))
                    .attr('y2', yScale(lineYAtMax));

                // Show tangent line when delta is small
                const tangentSlope = 2 * pointA.x; // Derivative of x¬≤ at x=1 is 2
                const tangentYMin = pointA.y + tangentSlope * (lineXMin - pointA.x);
                const tangentYMax = pointA.y + tangentSlope * (lineXMax - pointA.x);

                tangentLine
                    .attr('x1', xScale(lineXMin))
                    .attr('y1', yScale(tangentYMin))
                    .attr('x2', xScale(lineXMax))
                    .attr('y2', yScale(tangentYMax))
                    .attr('opacity', Math.abs(deltaX) < 0.3 ? 0.5 : 0);
            }

            // Initialize
            update(1);

            // Slider event
            document.getElementById('delta-slider').addEventListener('input', function(e) {
                update(parseFloat(e.target.value));
            });
        }

        // ===== Connections Visualization =====
        function drawConnections() {
            if (typeof d3 === 'undefined') {
                setTimeout(drawConnections, 100);
                return;
            }

            const container = document.getElementById('connections-viz');
            if (!container) return;
            if (container.querySelector('svg')) return;

            const width = 600;
            const height = 320;
            const nodeRadius = 55;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet')
                .style('width', '100%')
                .style('height', 'auto');

            // Define arrow markers
            const defs = svg.append('defs');

            // Arrow for upward paths (from Limits)
            defs.append('marker')
                .attr('id', 'arrow-up')
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 10)
                .attr('refY', 0)
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,-4L10,0L0,4')
                .attr('fill', '#60a5fa');

            // Double-headed arrow for FTC
            defs.append('marker')
                .attr('id', 'arrow-left')
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 0)
                .attr('refY', 0)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M10,-4L0,0L10,4')
                .attr('fill', '#d4a028');

            defs.append('marker')
                .attr('id', 'arrow-right')
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 10)
                .attr('refY', 0)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,-4L10,0L0,4')
                .attr('fill', '#d4a028');

            // Node positions - Limits at bottom center, Derivatives/Integrals at top
            const limits = { x: width / 2, y: height - 70, color: '#356093', label: 'Limits' };
            const derivatives = { x: width * 0.22, y: 80, color: '#f97316', label: 'Derivatives' };
            const integrals = { x: width * 0.78, y: 80, color: '#22c55e', label: 'Integrals' };

            // Draw arrows FROM Limits TO Derivatives/Integrals
            // Arrow to Derivatives
            const pathToDerivatives = svg.append('path')
                .attr('d', `M${limits.x - 20},${limits.y - nodeRadius}
                            Q${limits.x - 80},${height / 2 - 20}
                            ${derivatives.x + 15},${derivatives.y + nodeRadius}`)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('marker-end', 'url(#arrow-up)');

            // Arrow to Integrals
            const pathToIntegrals = svg.append('path')
                .attr('d', `M${limits.x + 20},${limits.y - nodeRadius}
                            Q${limits.x + 80},${height / 2 - 20}
                            ${integrals.x - 15},${integrals.y + nodeRadius}`)
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('marker-end', 'url(#arrow-up)');

            // Bidirectional arrow between Derivatives and Integrals (Fundamental Theorem)
            const ftcPath = svg.append('path')
                .attr('d', `M${derivatives.x + nodeRadius + 5},${derivatives.y}
                            L${integrals.x - nodeRadius - 5},${integrals.y}`)
                .attr('fill', 'none')
                .attr('stroke', '#d4a028')
                .attr('stroke-width', 3)
                .attr('marker-start', 'url(#arrow-left)')
                .attr('marker-end', 'url(#arrow-right)');

            // FTC Label above the bidirectional arrow
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', 25)
                .attr('text-anchor', 'middle')
                .attr('font-size', '1.1rem')
                .attr('font-family', 'Montserrat, sans-serif')
                .attr('font-style', 'italic')
                .attr('fill', '#d4a028')
                .text('Fundamental Theorem of Calculus');

            // Draw nodes
            [limits, derivatives, integrals].forEach((node, i) => {
                const g = svg.append('g')
                    .attr('transform', `translate(${node.x},${node.y})`);

                // Circle with glow effect
                g.append('circle')
                    .attr('r', nodeRadius + 3)
                    .attr('fill', 'none')
                    .attr('stroke', node.color)
                    .attr('stroke-width', 2)
                    .attr('opacity', 0.3);

                g.append('circle')
                    .attr('r', nodeRadius)
                    .attr('fill', node.color);

                g.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dy', '0.35em')
                    .attr('font-size', '1.2rem')
                    .attr('font-family', 'Montserrat, sans-serif')
                    .attr('font-weight', '600')
                    .attr('fill', 'white')
                    .text(node.label);
            });

            // Add small labels explaining the arrows
            svg.append('text')
                .attr('x', limits.x - 100)
                .attr('y', height / 2 + 15)
                .attr('text-anchor', 'middle')
                .attr('font-size', '0.9rem')
                .attr('fill', '#6b7a94')
                .text('defines');

            svg.append('text')
                .attr('x', limits.x + 100)
                .attr('y', height / 2 + 15)
                .attr('text-anchor', 'middle')
                .attr('font-size', '0.9rem')
                .attr('fill', '#6b7a94')
                .text('defines');
        }

        // ===== Journey Timeline Visualization =====
        function drawJourney() {
            const container = document.getElementById('journey-viz');
            if (!container || container.querySelector('svg')) return;

            const width = 900;
            const height = 250;

            const svg = d3.select(container)
                .append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const units = [
                { num: 1, name: 'Limits', color: '#356093', bc: false },
                { num: 2, name: 'Diff I', color: '#7c3aed', bc: false },
                { num: 3, name: 'Diff II', color: '#8b5cf6', bc: false },
                { num: 4, name: 'Context', color: '#059669', bc: false },
                { num: 5, name: 'Analysis', color: '#0d9488', bc: false },
                { num: 6, name: 'Integration', color: '#d4a028', bc: false },
                { num: 7, name: 'Diff Eq', color: '#ea580c', bc: false },
                { num: 8, name: 'Int Apps', color: '#e11d48', bc: false },
                { num: 9, name: 'Param/Polar', color: '#0891b2', bc: true },
                { num: 10, name: 'Series', color: '#4f46e5', bc: true }
            ];

            const spacing = (width - 100) / (units.length - 1);
            const startX = 50;
            const y = height / 2;

            // Timeline line
            svg.append('line')
                .attr('x1', startX - 20)
                .attr('y1', y)
                .attr('x2', width - startX + 20)
                .attr('y2', y)
                .attr('stroke', '#1c2640')
                .attr('stroke-width', 4);

            // Draw units
            units.forEach((unit, i) => {
                const x = startX + i * spacing;
                const g = svg.append('g')
                    .attr('transform', `translate(${x},${y})`);

                // Circle
                g.append('circle')
                    .attr('r', 0)
                    .attr('fill', unit.color)
                    .attr('stroke', unit.bc ? '#d4a028' : 'none')
                    .attr('stroke-width', unit.bc ? 3 : 0)
                    .transition()
                    .delay(i * 100)
                    .duration(400)
                    .attr('r', 25);

                // Number
                g.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dy', '0.35em')
                    .attr('font-size', '1.25rem')
                    .attr('font-weight', '700')
                    .attr('fill', 'white')
                    .text(unit.num)
                    .attr('opacity', 0)
                    .transition()
                    .delay(i * 100 + 200)
                    .duration(300)
                    .attr('opacity', 1);

                // Label
                g.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('y', 45)
                    .attr('font-size', '1rem')
                    .attr('fill', unit.bc ? '#d4a028' : '#b8c4d6')
                    .text(unit.name)
                    .attr('opacity', 0)
                    .transition()
                    .delay(i * 100 + 300)
                    .duration(300)
                    .attr('opacity', 1);
            });

            // Legend
            svg.append('circle').attr('cx', width - 150).attr('cy', 30).attr('r', 8).attr('fill', '#356093');
            svg.append('text').attr('x', width - 135).attr('y', 35).attr('font-size', '1rem').attr('fill', '#b8c4d6').text('AB Topics');

            svg.append('circle').attr('cx', width - 150).attr('cy', 55).attr('r', 8).attr('fill', '#0891b2').attr('stroke', '#d4a028').attr('stroke-width', 2);
            svg.append('text').attr('x', width - 135).attr('y', 60).attr('font-size', '1rem').attr('fill', '#d4a028').text('BC Only');
        }

        // ===== Trigger Visualizations on Slide Entry =====
        const visualizationSlides = {
            7: drawSecantTangent,
            10: drawConnections,
            11: drawJourney
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;

            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        // Check periodically for slide changes
        setInterval(checkAndDrawVisualization, 200);

        // Also check on hash changes
        window.addEventListener('hashchange', () => {
            setTimeout(checkAndDrawVisualization, 100);
        });

        // Initial check after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkAndDrawVisualization, 200);
            });
        } else {
            setTimeout(checkAndDrawVisualization, 200);
        }
    </script>
</body>
</html>
