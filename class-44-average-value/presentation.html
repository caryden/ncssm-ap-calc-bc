<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Average Value and Accumulation Functions | AP Calculus BC</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <style>
        :root {
            --theme-color: #f43f5e;
            --theme-color-light: #fb7185;
            --theme-color-dark: #e11d48;
            --function-color: #60a5fa;
            --avg-color: #f43f5e;
            --area-color: rgba(244, 63, 94, 0.3);
            --accum-color: #22c55e;
        }

        .unit-badge {
            background: var(--theme-color);
        }

        .slide-title h1 {
            color: var(--theme-color);
        }

        .viz-container {
            width: 100%;
            height: 450px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .viz-container svg {
            max-width: 100%;
            max-height: 100%;
        }

        .formula-box {
            background: var(--bg-secondary);
            border: 2px solid var(--theme-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem auto;
            max-width: 800px;
        }

        .formula-box .formula-title {
            color: var(--theme-color);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .concept-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--theme-color);
        }

        .concept-card h3 {
            color: var(--theme-color);
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .concept-card p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .step-list {
            text-align: left;
            max-width: 800px;
            margin: 0 auto;
        }

        .step-list .step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .step-list .step-num {
            background: var(--theme-color);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            font-size: 1.1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 24px;
            height: 4px;
            border-radius: 2px;
        }

        .controls-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .slider {
            width: 150px;
            accent-color: var(--theme-color);
        }

        .slider-value {
            font-family: var(--font-mono);
            color: var(--theme-color);
            min-width: 3rem;
        }

        .interpretation-box {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem auto;
            max-width: 900px;
        }

        .interpretation-box h3 {
            color: var(--theme-color);
            margin-bottom: 1rem;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }

        .example-box {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: left;
        }

        .example-box .problem {
            border-left: 3px solid var(--theme-color);
            padding-left: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="presentation-container">

        <!-- Slide 0: Title -->
        <section class="slide slide-title">
            <div class="slide-content">
                <span class="unit-badge">Unit 8: Applications of Integration</span>
                <h1>Average Value & Accumulation Functions</h1>
                <p class="subtitle">Finding the "Typical" Value and Accumulating Change</p>
                <p class="meta">Class 44 | CED Topics 8.1, 8.3</p>
            </div>
        </section>

        <!-- Slide 1: Warm-Up -->
        <section class="slide slide-exercise">
            <div class="slide-content">
                <h2>Warm-Up</h2>
                <div class="exercise-box">
                    <p>Consider \(f(x) = x^2\) on \([0, 3]\).</p>
                    <p style="margin-top: 1rem;"><strong>1.</strong> What is the average of \(f(0)\), \(f(1)\), \(f(2)\), and \(f(3)\)?</p>
                    <p style="margin-top: 0.5rem;"><strong>2.</strong> Is this a good estimate for the "average height" of the curve?</p>
                    <p style="margin-top: 0.5rem;"><strong>3.</strong> How could we get a better estimate?</p>
                </div>
            </div>
        </section>

        <!-- Slide 2: The Problem with Discrete Averages -->
        <section class="slide slide-statement">
            <div class="slide-content">
                <h2>The Problem with Discrete Averages</h2>
                <div class="statement-box">
                    <p>For discrete data: \(\bar{x} = \dfrac{x_1 + x_2 + \cdots + x_n}{n}\)</p>
                </div>
                <div style="margin-top: 2rem;">
                    <p style="font-size: 1.5rem;">But a continuous function has <em>infinitely many</em> values!</p>
                    <p style="font-size: 1.25rem; color: var(--text-secondary); margin-top: 1rem;">
                        We need integration to "average" over an infinite set of values.
                    </p>
                </div>
            </div>
        </section>

        <!-- Slide 3: Average Value Formula -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Average Value of a Function</h2>
                <div class="formula-box">
                    <div class="formula-title">Definition</div>
                    <p class="math-display">\[f_{avg} = \frac{1}{b-a} \int_a^b f(x) \, dx\]</p>
                </div>
                <div class="interpretation-box">
                    <h3>Interpretation</h3>
                    <p style="font-size: 1.25rem;">The average value is the <strong>height of a rectangle</strong> with the same area as the region under the curve.</p>
                </div>
            </div>
        </section>

        <!-- Slide 4: Visualization -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Visualizing Average Value</h2>
                <div id="avg-value-viz" class="viz-container"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--function-color);"></div>
                        <span>\(f(x) = x^2\)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--avg-color);"></div>
                        <span>\(f_{avg}\) line</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 5: Example 1 -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Example 1: Polynomial</h2>
                <div class="example-box">
                    <div class="problem">
                        <p>Find the average value of \(f(x) = x^2\) on \([0, 3]\).</p>
                    </div>
                    <div class="solution">
                        <p>\[f_{avg} = \frac{1}{3-0} \int_0^3 x^2 \, dx = \frac{1}{3} \left[ \frac{x^3}{3} \right]_0^3\]</p>
                        <p>\[= \frac{1}{3} \cdot \frac{27}{3} = \frac{9}{3} = 3\]</p>
                    </div>
                </div>
                <p style="color: var(--text-secondary); margin-top: 1rem;">
                    Compare: The discrete average of \(f(0), f(1), f(2), f(3)\) was \(\frac{0+1+4+9}{4} = 3.5\)
                </p>
            </div>
        </section>

        <!-- Slide 6: Example 2 -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Example 2: Trigonometric</h2>
                <div class="example-box">
                    <div class="problem">
                        <p>Find the average value of \(f(x) = \sin(x)\) on \([0, \pi]\).</p>
                    </div>
                    <div class="solution">
                        <p>\[f_{avg} = \frac{1}{\pi - 0} \int_0^{\pi} \sin(x) \, dx = \frac{1}{\pi} \left[ -\cos(x) \right]_0^{\pi}\]</p>
                        <p>\[= \frac{1}{\pi} \left[ -\cos(\pi) + \cos(0) \right] = \frac{1}{\pi}(1 + 1) = \frac{2}{\pi}\]</p>
                    </div>
                </div>
                <p style="color: var(--accent-secondary); margin-top: 1rem;">
                    Note: \(\frac{2}{\pi} \approx 0.637\), which is less than the maximum value of 1.
                </p>
            </div>
        </section>

        <!-- Slide 7: Interactive Average Value -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Explore Average Value</h2>
                <div id="interactive-avg-viz" class="viz-container"></div>
                <div class="controls-container">
                    <div class="control-group">
                        <label>a:</label>
                        <input type="range" class="slider" id="slider-a" min="0" max="2" step="0.1" value="0">
                        <span class="slider-value" id="value-a">0</span>
                    </div>
                    <div class="control-group">
                        <label>b:</label>
                        <input type="range" class="slider" id="slider-b" min="1" max="4" step="0.1" value="3">
                        <span class="slider-value" id="value-b">3</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 8: Mean Value Theorem for Integrals -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Mean Value Theorem for Integrals</h2>
                <div class="theorem-box">
                    <div class="theorem-name">MVT for Integrals</div>
                    <div class="theorem-statement">
                        <p>If \(f\) is continuous on \([a, b]\), then there exists \(c \in (a, b)\) such that:</p>
                        <p class="math-display">\[f(c) = \frac{1}{b-a} \int_a^b f(x) \, dx = f_{avg}\]</p>
                    </div>
                </div>
                <p style="margin-top: 1.5rem; font-size: 1.25rem; color: var(--text-secondary);">
                    The function actually attains its average value somewhere in the interval!
                </p>
            </div>
        </section>

        <!-- Slide 9: MVT Visualization -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>MVT for Integrals: Visualization</h2>
                <div id="mvt-viz" class="viz-container"></div>
                <p style="text-align: center; font-size: 1.1rem; color: var(--text-secondary);">
                    The point \(c\) where \(f(c) = f_{avg}\) is guaranteed to exist
                </p>
            </div>
        </section>

        <!-- Slide 10: Accumulation Functions Intro -->
        <section class="slide slide-statement">
            <div class="slide-content">
                <h2>Accumulation Functions</h2>
                <div class="statement-box">
                    <p><strong>Big Idea:</strong> The integral can itself be a <em>function</em>!</p>
                    <p class="math-display">\[F(x) = \int_a^x f(t) \, dt\]</p>
                </div>
                <div style="margin-top: 2rem;">
                    <p style="font-size: 1.35rem;">This measures the <strong>accumulated area</strong> from \(a\) to \(x\).</p>
                </div>
            </div>
        </section>

        <!-- Slide 11: Accumulation Interpretation -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>What Does \(F(x)\) Measure?</h2>
                <div class="concept-grid">
                    <div class="concept-card">
                        <h3>Physical Context</h3>
                        <p>If \(v(t)\) is velocity, then \(\int_0^x v(t)\, dt\) is the <strong>displacement</strong> from time 0 to time \(x\).</p>
                    </div>
                    <div class="concept-card">
                        <h3>Rate of Change</h3>
                        <p>If \(r(t)\) is rate, then \(\int_a^x r(t)\, dt\) is the <strong>total change</strong> from \(a\) to \(x\).</p>
                    </div>
                    <div class="concept-card">
                        <h3>Area Perspective</h3>
                        <p>For positive \(f\), this represents the <strong>signed area</strong> under the curve from \(a\) to \(x\).</p>
                    </div>
                    <div class="concept-card">
                        <h3>FTC Connection</h3>
                        <p>By FTC Part 1: \(F'(x) = f(x)\). The accumulation function is an antiderivative!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 12: Accumulation Visualization -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Visualizing Accumulation</h2>
                <div id="accum-viz" class="viz-container"></div>
                <div class="controls-container">
                    <div class="control-group">
                        <label>x:</label>
                        <input type="range" class="slider" id="slider-x" min="0" max="4" step="0.1" value="2">
                        <span class="slider-value" id="value-x">2</span>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--function-color);"></div>
                        <span>\(f(t)\)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--accum-color);"></div>
                        <span>\(F(x) = \int_0^x f(t)\,dt\)</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 13: Example 3 -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>Example 3: Building an Accumulation Function</h2>
                <div class="example-box">
                    <div class="problem">
                        <p>Let \(F(x) = \int_1^x t^2 \, dt\). Find \(F(x)\) and \(F'(x)\).</p>
                    </div>
                    <div class="solution">
                        <p><strong>Finding F(x):</strong></p>
                        <p>\[F(x) = \left[ \frac{t^3}{3} \right]_1^x = \frac{x^3}{3} - \frac{1}{3}\]</p>
                        <p style="margin-top: 1rem;"><strong>Finding F'(x):</strong></p>
                        <p>\[F'(x) = x^2\]</p>
                        <p style="margin-top: 0.5rem; color: var(--accent-secondary);">Notice: \(F'(x) = f(x)\) by FTC Part 1!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 14: FTC Part 1 Connection -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>FTC Part 1: The Key Connection</h2>
                <div class="formula-box">
                    <div class="formula-title">Fundamental Theorem of Calculus, Part 1</div>
                    <p class="math-display">\[\frac{d}{dx} \int_a^x f(t) \, dt = f(x)\]</p>
                </div>
                <div class="interpretation-box">
                    <h3>In Words</h3>
                    <p style="font-size: 1.25rem;">The <strong>rate of change</strong> of the accumulated area equals the <strong>height of the function</strong> at that point.</p>
                </div>
            </div>
        </section>

        <!-- Slide 15: Chain Rule Extension -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>FTC with Chain Rule</h2>
                <div class="formula-box">
                    <div class="formula-title">Extended Version</div>
                    <p class="math-display">\[\frac{d}{dx} \int_a^{g(x)} f(t) \, dt = f(g(x)) \cdot g'(x)\]</p>
                </div>
                <div class="example-box" style="margin-top: 1.5rem;">
                    <div class="problem">
                        <p>Find \(\frac{d}{dx} \int_1^{x^2} \cos(t) \, dt\)</p>
                    </div>
                    <div class="solution">
                        <p>\[= \cos(x^2) \cdot 2x = 2x\cos(x^2)\]</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 16: Both Limits Variable -->
        <section class="slide slide-visual">
            <div class="slide-content">
                <h2>When Both Limits are Variable</h2>
                <div class="formula-box">
                    <div class="formula-title">Split the Integral</div>
                    <p class="math-display">\[\frac{d}{dx} \int_{h(x)}^{g(x)} f(t) \, dt = f(g(x)) \cdot g'(x) - f(h(x)) \cdot h'(x)\]</p>
                </div>
                <div class="example-box" style="margin-top: 1.5rem;">
                    <div class="problem">
                        <p>Find \(\frac{d}{dx} \int_x^{x^3} e^{t^2} \, dt\)</p>
                    </div>
                    <div class="solution">
                        <p>\[= e^{(x^3)^2} \cdot 3x^2 - e^{x^2} \cdot 1 = 3x^2 e^{x^6} - e^{x^2}\]</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 17: Practice Problems -->
        <section class="slide slide-exercise">
            <div class="slide-content">
                <h2>Practice Problems</h2>
                <div class="exercise-box">
                    <ol style="font-size: 1.25rem; line-height: 2.2; text-align: left; max-width: 800px; margin: 0 auto;">
                        <li>Find the average value of \(f(x) = e^x\) on \([0, 2]\).</li>
                        <li>Find \(\frac{d}{dx} \int_0^x \sqrt{1 + t^3} \, dt\)</li>
                        <li>Find \(\frac{d}{dx} \int_2^{\sin x} t^4 \, dt\)</li>
                        <li>If \(f(x) = 3x^2 - 2\), find the value \(c\) guaranteed by MVT for Integrals on \([0, 3]\).</li>
                        <li>Find \(\frac{d}{dx} \int_x^{2x} \ln(t) \, dt\)</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- Slide 18: Solutions -->
        <section class="slide slide-list">
            <div class="slide-content">
                <h2>Solutions</h2>
                <ol style="font-size: 1.15rem; line-height: 2.2; text-align: left; max-width: 900px; margin: 0 auto;">
                    <li>\(f_{avg} = \frac{1}{2}\int_0^2 e^x dx = \frac{1}{2}(e^2 - 1) \approx 3.19\)</li>
                    <li>\(\sqrt{1 + x^3}\) (direct FTC Part 1)</li>
                    <li>\(\sin^4(x) \cdot \cos(x)\) (chain rule: inner derivative is \(\cos x\))</li>
                    <li>\(f_{avg} = \frac{1}{3}\int_0^3 (3x^2-2)dx = 7\); solve \(3c^2 - 2 = 7 \Rightarrow c = \sqrt{3}\)</li>
                    <li>\(\ln(2x) \cdot 2 - \ln(x) \cdot 1 = 2\ln(2x) - \ln(x) = \ln(4x)\)</li>
                </ol>
            </div>
        </section>

        <!-- Slide 19: Exit Ticket -->
        <section class="slide slide-exercise">
            <div class="slide-content">
                <h2>Exit Ticket</h2>
                <div class="exercise-box">
                    <p><strong>1.</strong> Find the average value of \(f(x) = x^3\) on \([0, 2]\).</p>
                    <div style="height: 2rem;"></div>
                    <p><strong>2.</strong> If \(F(x) = \int_1^{x^2} \frac{1}{t} \, dt\), find \(F'(x)\).</p>
                    <div style="height: 2rem;"></div>
                    <p><strong>3.</strong> Explain in your own words what \(\int_0^x v(t)\,dt\) represents if \(v(t)\) is velocity.</p>
                </div>
            </div>
        </section>

        <!-- Slide 20: Looking Ahead -->
        <section class="slide slide-title">
            <div class="slide-content">
                <h2>Looking Ahead</h2>
                <div style="margin-top: 2rem;">
                    <h3 style="color: var(--theme-color);">Next: Area Between Curves</h3>
                    <ul style="font-size: 1.35rem; line-height: 2; list-style: none; padding: 0; margin-top: 1.5rem;">
                        <li>Setting up "top minus bottom"</li>
                        <li>Finding intersection points</li>
                        <li>Horizontal vs. vertical slicing</li>
                    </ul>
                </div>
            </div>
        </section>

    </div>

    <!-- Navigation -->
    <nav class="slide-nav">
        <button id="prevBtn" aria-label="Previous slide">&#8592;</button>
        <span id="slideCounter">1 / 20</span>
        <button id="nextBtn" aria-label="Next slide">&#8594;</button>
        <button id="tocBtn" aria-label="Table of contents">&#9776;</button>
    </nav>

    <!-- Table of Contents -->
    <div id="toc" class="toc-overlay">
        <div class="toc-content">
            <h3>Contents</h3>
            <ul id="tocList"></ul>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <script src="../shared/presentation.js"></script>

    <script>
        // Visualization slides mapping
        const visualizationSlides = {
            4: drawAvgValueViz,
            7: drawInteractiveAvgViz,
            9: drawMVTViz,
            12: drawAccumViz
        };

        let lastSlide = -1;

        function checkAndDrawVisualization() {
            if (!window.Presentation) return;
            const currentSlide = window.Presentation.getCurrentSlide();
            if (currentSlide !== lastSlide) {
                lastSlide = currentSlide;
                if (visualizationSlides[currentSlide]) {
                    setTimeout(visualizationSlides[currentSlide], 100);
                }
            }
        }

        setInterval(checkAndDrawVisualization, 200);

        // Visualization 1: Average Value Basic
        function drawAvgValueViz() {
            const container = d3.select('#avg-value-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 400;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-0.5, 4]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-0.5, 10]).range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g').selectAll('line')
                .data(d3.range(0, 11, 2))
                .enter().append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))
                .attr('stroke', '#1c2640').attr('stroke-width', 1);

            // Axes
            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            // f(x) = x^2
            const f = x => x * x;
            const xVals = d3.range(0, 3.01, 0.05);
            const avgValue = 3; // Calculated: (1/3) * integral from 0 to 3 of x^2 = 3

            // Shaded area under curve
            const areaData = xVals.map(x => ({ x, y: f(x) }));
            areaData.push({ x: 3, y: 0 });
            areaData.unshift({ x: 0, y: 0 });

            svg.append('path')
                .datum(areaData)
                .attr('fill', 'rgba(96, 165, 250, 0.3)')
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

            // Rectangle with same area
            svg.append('rect')
                .attr('x', xScale(0))
                .attr('y', yScale(avgValue))
                .attr('width', xScale(3) - xScale(0))
                .attr('height', yScale(0) - yScale(avgValue))
                .attr('fill', 'rgba(244, 63, 94, 0.2)')
                .attr('stroke', '#f43f5e')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');

            // Function curve
            const line = d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural);
            svg.append('path')
                .datum(xVals.map(x => ({ x, y: f(x) })))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', line);

            // Average value line
            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(3))
                .attr('y1', yScale(avgValue)).attr('y2', yScale(avgValue))
                .attr('stroke', '#f43f5e')
                .attr('stroke-width', 3);

            // Labels
            svg.append('text')
                .attr('x', xScale(3.2)).attr('y', yScale(avgValue))
                .attr('fill', '#f43f5e').attr('font-size', '1.1rem')
                .text('f_avg = 3');

            svg.append('text')
                .attr('x', xScale(3)).attr('y', yScale(0) + 25)
                .attr('fill', '#9ca3af').attr('text-anchor', 'middle')
                .text('3');

            svg.append('text')
                .attr('x', width - margin.right).attr('y', yScale(0) - 10)
                .attr('fill', '#9ca3af').attr('text-anchor', 'end')
                .text('x');
        }

        // Visualization 2: Interactive Average Value
        function drawInteractiveAvgViz() {
            const container = d3.select('#interactive-avg-viz');
            container.selectAll('svg').remove();

            const width = 700;
            const height = 350;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-0.5, 5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-1, 20]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            const f = x => x * x;

            function update() {
                const a = parseFloat(document.getElementById('slider-a').value);
                const b = parseFloat(document.getElementById('slider-b').value);

                document.getElementById('value-a').textContent = a.toFixed(1);
                document.getElementById('value-b').textContent = b.toFixed(1);

                // Calculate average value
                const integral = (b * b * b - a * a * a) / 3;
                const avgValue = integral / (b - a);

                svg.selectAll('.dynamic').remove();

                const xVals = d3.range(a, b + 0.05, 0.05);

                // Shaded area
                const areaData = xVals.map(x => ({ x, y: f(x) }));
                areaData.push({ x: b, y: 0 });
                areaData.unshift({ x: a, y: 0 });

                svg.append('path')
                    .attr('class', 'dynamic')
                    .datum(areaData)
                    .attr('fill', 'rgba(96, 165, 250, 0.3)')
                    .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

                // Rectangle
                svg.append('rect')
                    .attr('class', 'dynamic')
                    .attr('x', xScale(a))
                    .attr('y', yScale(avgValue))
                    .attr('width', xScale(b) - xScale(a))
                    .attr('height', yScale(0) - yScale(avgValue))
                    .attr('fill', 'rgba(244, 63, 94, 0.2)')
                    .attr('stroke', '#f43f5e')
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '5,5');

                // Function curve (full)
                const fullXVals = d3.range(0, 4.5, 0.05);
                svg.append('path')
                    .attr('class', 'dynamic')
                    .datum(fullXVals.map(x => ({ x, y: f(x) })))
                    .attr('fill', 'none')
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 3)
                    .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural));

                // Average line
                svg.append('line')
                    .attr('class', 'dynamic')
                    .attr('x1', xScale(a)).attr('x2', xScale(b))
                    .attr('y1', yScale(avgValue)).attr('y2', yScale(avgValue))
                    .attr('stroke', '#f43f5e')
                    .attr('stroke-width', 3);

                // Label
                svg.append('text')
                    .attr('class', 'dynamic')
                    .attr('x', xScale((a + b) / 2)).attr('y', yScale(avgValue) - 10)
                    .attr('fill', '#f43f5e').attr('font-size', '1rem').attr('text-anchor', 'middle')
                    .text(`f_avg = ${avgValue.toFixed(2)}`);
            }

            document.getElementById('slider-a').oninput = update;
            document.getElementById('slider-b').oninput = update;

            update();
        }

        // Visualization 3: MVT for Integrals
        function drawMVTViz() {
            const container = d3.select('#mvt-viz');
            container.selectAll('*').remove();

            const width = 700;
            const height = 400;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-0.5, 4]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-0.5, 10]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            const f = x => x * x;
            const a = 0, b = 3;
            const avgValue = 3;
            const c = Math.sqrt(3); // f(c) = c^2 = 3

            // Shaded area
            const xVals = d3.range(a, b + 0.05, 0.05);
            const areaData = xVals.map(x => ({ x, y: f(x) }));
            areaData.push({ x: b, y: 0 });
            areaData.unshift({ x: a, y: 0 });

            svg.append('path')
                .datum(areaData)
                .attr('fill', 'rgba(96, 165, 250, 0.3)')
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

            // Function curve
            svg.append('path')
                .datum(xVals.map(x => ({ x, y: f(x) })))
                .attr('fill', 'none')
                .attr('stroke', '#60a5fa')
                .attr('stroke-width', 3)
                .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural));

            // Average line
            svg.append('line')
                .attr('x1', xScale(a)).attr('x2', xScale(b))
                .attr('y1', yScale(avgValue)).attr('y2', yScale(avgValue))
                .attr('stroke', '#f43f5e')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');

            // Point c where f(c) = f_avg
            svg.append('circle')
                .attr('cx', xScale(c)).attr('cy', yScale(avgValue))
                .attr('r', 8)
                .attr('fill', '#f43f5e')
                .attr('stroke', 'white')
                .attr('stroke-width', 2);

            // Vertical line at c
            svg.append('line')
                .attr('x1', xScale(c)).attr('x2', xScale(c))
                .attr('y1', yScale(0)).attr('y2', yScale(avgValue))
                .attr('stroke', '#f43f5e')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '3,3');

            // Labels
            svg.append('text')
                .attr('x', xScale(c)).attr('y', yScale(0) + 20)
                .attr('fill', '#f43f5e').attr('text-anchor', 'middle').attr('font-size', '1rem')
                .text(`c = sqrt(3)`);

            svg.append('text')
                .attr('x', xScale(b) + 10).attr('y', yScale(avgValue))
                .attr('fill', '#f43f5e').attr('font-size', '1rem')
                .text('f_avg = 3');

            svg.append('text')
                .attr('x', xScale(c) + 15).attr('y', yScale(avgValue) - 15)
                .attr('fill', 'white').attr('font-size', '0.9rem')
                .text('f(c) = f_avg');
        }

        // Visualization 4: Accumulation Function
        function drawAccumViz() {
            const container = d3.select('#accum-viz');
            container.selectAll('svg').remove();

            const width = 700;
            const height = 350;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };

            const svg = container.append('svg')
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');

            const xScale = d3.scaleLinear().domain([-0.5, 5]).range([margin.left, width - margin.right]);
            const yScale = d3.scaleLinear().domain([-2, 12]).range([height - margin.bottom, margin.top]);

            // Axes
            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(0)).attr('y2', yScale(0))
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            svg.append('line')
                .attr('x1', xScale(0)).attr('x2', xScale(0))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#4b5563').attr('stroke-width', 2);

            // f(t) = t (simple linear for visualization)
            const f = t => t;
            const F = x => x * x / 2; // Antiderivative from 0

            function update() {
                const x = parseFloat(document.getElementById('slider-x').value);
                document.getElementById('value-x').textContent = x.toFixed(1);

                svg.selectAll('.dynamic').remove();

                // Shaded area from 0 to x
                const xVals = d3.range(0, x + 0.05, 0.05);
                const areaData = xVals.map(t => ({ x: t, y: f(t) }));
                areaData.push({ x: x, y: 0 });
                areaData.unshift({ x: 0, y: 0 });

                svg.append('path')
                    .attr('class', 'dynamic')
                    .datum(areaData)
                    .attr('fill', 'rgba(34, 197, 94, 0.3)')
                    .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)));

                // f(t) = t line
                svg.append('line')
                    .attr('class', 'dynamic')
                    .attr('x1', xScale(0)).attr('x2', xScale(4.5))
                    .attr('y1', yScale(0)).attr('y2', yScale(4.5))
                    .attr('stroke', '#60a5fa')
                    .attr('stroke-width', 3);

                // F(x) = x^2/2 curve
                const accumData = d3.range(0, 4.5, 0.05).map(t => ({ x: t, y: F(t) }));
                svg.append('path')
                    .attr('class', 'dynamic')
                    .datum(accumData)
                    .attr('fill', 'none')
                    .attr('stroke', '#22c55e')
                    .attr('stroke-width', 3)
                    .attr('d', d3.line().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveNatural));

                // Point on F(x)
                svg.append('circle')
                    .attr('class', 'dynamic')
                    .attr('cx', xScale(x)).attr('cy', yScale(F(x)))
                    .attr('r', 8)
                    .attr('fill', '#22c55e')
                    .attr('stroke', 'white')
                    .attr('stroke-width', 2);

                // Vertical line
                svg.append('line')
                    .attr('class', 'dynamic')
                    .attr('x1', xScale(x)).attr('x2', xScale(x))
                    .attr('y1', yScale(0)).attr('y2', yScale(f(x)))
                    .attr('stroke', '#f43f5e')
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '3,3');

                // Labels
                svg.append('text')
                    .attr('class', 'dynamic')
                    .attr('x', xScale(x) + 10).attr('y', yScale(F(x)))
                    .attr('fill', '#22c55e').attr('font-size', '0.95rem')
                    .text(`F(${x.toFixed(1)}) = ${F(x).toFixed(2)}`);
            }

            document.getElementById('slider-x').oninput = update;
            update();
        }
    </script>
</body>
</html>
